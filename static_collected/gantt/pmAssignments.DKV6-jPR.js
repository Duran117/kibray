import{r,j as t,c as f,R as x}from"./index.3v2dhZMc.js";function y(){const[l,p]=r.useState([]),[m,a]=r.useState(!1),[g,o]=r.useState(null),[u,c]=r.useState(!1),[s,i]=r.useState({project:"",pm:"",role:"project_manager"}),h=()=>{var e;return((e=document.querySelector('meta[name="csrf-token"]'))==null?void 0:e.getAttribute("content"))||""},d=async()=>{a(!0),o(null);try{const e=await fetch("/api/v1/project-manager-assignments/",{headers:{Accept:"application/json"},credentials:"include"});if(!e.ok)throw new Error(`HTTP ${e.status}`);const n=await e.json();p(n.results||n)}catch(e){o(e.message||"Error loading assignments")}finally{a(!1)}};r.useEffect(()=>{d()},[]);const j=async e=>{e.preventDefault(),a(!0),o(null);try{const n=await fetch("/api/v1/project-manager-assignments/assign/",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":h()},credentials:"include",body:JSON.stringify(s)});if(!n.ok)throw new Error(`HTTP ${n.status}`);c(!1),i({project:"",pm:"",role:"project_manager"}),d()}catch(n){o(n.message||"Error creating assignment")}finally{a(!1)}};return r.useEffect(()=>{const e=document.getElementById("pm-assignments-root");e&&(e.setAttribute("data-mounted","1"),console.log("[PMAssignments] mounted, count:",l.length))},[l.length]),t.jsxs("div",{className:"pm-assignments",style:{padding:20},children:[t.jsx("h2",{children:"Project Manager Assignments"}),t.jsxs("div",{style:{marginBottom:16,display:"flex",gap:8,alignItems:"center"},children:[t.jsx("button",{onClick:d,disabled:m,children:"Refresh"}),t.jsx("button",{onClick:()=>c(!u),style:{marginLeft:"auto"},children:"+ Assign PM"})]}),g&&t.jsx("div",{style:{color:"red",marginBottom:12},children:g}),u&&t.jsxs("form",{onSubmit:j,style:{background:"#f9f9f9",padding:12,borderRadius:8,marginBottom:16},children:[t.jsx("h3",{children:"New PM Assignment"}),t.jsxs("div",{style:{display:"grid",gap:8},children:[t.jsx("input",{placeholder:"Project ID",value:s.project,onChange:e=>i({...s,project:e.target.value}),required:!0}),t.jsx("input",{placeholder:"PM User ID",value:s.pm,onChange:e=>i({...s,pm:e.target.value}),required:!0}),t.jsx("input",{placeholder:"Role (default: project_manager)",value:s.role,onChange:e=>i({...s,role:e.target.value})}),t.jsxs("div",{style:{display:"flex",gap:8},children:[t.jsx("button",{type:"submit",disabled:m,children:"Assign"}),t.jsx("button",{type:"button",onClick:()=>c(!1),children:"Cancel"})]})]})]}),t.jsx("div",{style:{display:"grid",gap:12},children:l.map(e=>t.jsxs("div",{style:{border:"1px solid #ddd",borderRadius:8,padding:12,background:"#fff"},children:[t.jsxs("div",{children:[t.jsx("strong",{children:"PM:"})," ",e.pm_username||`User ${e.pm}`," â†’ ",t.jsx("strong",{children:"Project:"})," ",e.project_name||`#${e.project}`]}),t.jsxs("div",{style:{fontSize:12,color:"#666"},children:["Role: ",e.role," | Created: ",new Date(e.created_at).toLocaleString()]})]},e.id))})]})}f.createRoot(document.getElementById("pm-assignments-root")).render(t.jsx(x.StrictMode,{children:t.jsx(y,{})}));
