import{r as i,j as t,c as v,R as b}from"./index.3v2dhZMc.js";function w(){const[d,a]=i.useState([]),[c,r]=i.useState(0),[l,f]=i.useState(!1),[p,h]=i.useState(null),[n,x]=i.useState(!1),g=async()=>{f(!0),h(null);try{const e=await fetch("/api/v1/notifications/",{headers:{Accept:"application/json"},credentials:"include"});if(!e.ok)throw new Error(`HTTP ${e.status}`);const o=await e.json();a(o.results||o)}catch(e){h(e.message||"Error loading notifications")}finally{f(!1)}},u=async()=>{try{const e=await fetch("/api/v1/notifications/count_unread/",{headers:{Accept:"application/json"},credentials:"include"});if(!e.ok)throw new Error(`HTTP ${e.status}`);const o=await e.json();r(o.unread_count||0)}catch(e){console.error("Error fetching unread count:",e)}};i.useEffect(()=>{u();const e=setInterval(u,3e4);return()=>clearInterval(e)},[]);const y=async e=>{try{await fetch(`/api/v1/notifications/${e}/mark_read/`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include"}),a(o=>o.map(s=>s.id===e?{...s,is_read:!0}:s)),r(o=>Math.max(0,o-1))}catch(o){console.error("Error marking as read:",o)}},j=async()=>{try{await fetch("/api/v1/notifications/mark_all_read/",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include"}),a(e=>e.map(o=>({...o,is_read:!0}))),r(0)}catch(e){console.error("Error marking all as read:",e)}},m=()=>{n||g(),x(!n)};return t.jsxs("div",{style:{position:"relative",display:"inline-block"},children:[t.jsxs("button",{onClick:m,style:{position:"relative",background:"#fff",border:"1px solid #ddd",borderRadius:8,padding:"8px 12px",cursor:"pointer"},children:["ðŸ””",c>0&&t.jsx("span",{style:{position:"absolute",top:-4,right:-4,background:"red",color:"#fff",borderRadius:"50%",padding:"2px 6px",fontSize:10,fontWeight:"bold"},children:c})]}),n&&t.jsxs("div",{style:{position:"absolute",top:40,right:0,width:400,maxHeight:500,background:"#fff",border:"1px solid #ddd",borderRadius:8,boxShadow:"0 4px 12px rgba(0,0,0,0.15)",zIndex:1e3,overflow:"hidden"},children:[t.jsxs("div",{style:{padding:12,borderBottom:"1px solid #ddd",display:"flex",justifyContent:"space-between"},children:[t.jsx("strong",{children:"Notifications"}),t.jsx("button",{onClick:j,style:{fontSize:12},children:"Mark all read"})]}),p&&t.jsx("div",{style:{padding:12,color:"red"},children:p}),t.jsxs("div",{style:{maxHeight:440,overflowY:"auto"},children:[l&&t.jsx("div",{style:{padding:12},children:"Loading..."}),!l&&d.length===0&&t.jsx("div",{style:{padding:12,color:"#999"},children:"No notifications"}),d.map(e=>t.jsxs("div",{style:{padding:12,borderBottom:"1px solid #eee",background:e.is_read?"#fff":"#f0f8ff",cursor:"pointer"},onClick:()=>!e.is_read&&y(e.id),children:[t.jsx("div",{style:{fontWeight:e.is_read?"normal":"bold",fontSize:14},children:e.title}),t.jsx("div",{style:{fontSize:12,color:"#666",marginTop:4},children:e.message}),t.jsx("div",{style:{fontSize:11,color:"#999",marginTop:4},children:new Date(e.created_at).toLocaleString()})]},e.id))]})]})]})}v.createRoot(document.getElementById("notification-root")).render(t.jsx(b.StrictMode,{children:t.jsx(w,{})}));
