import{r as c,j as t,c as S,R}from"./index.3v2dhZMc.js";function E(){const[u,v]=c.useState([]),[j,n]=c.useState(!1),[f,l]=c.useState(null),[s,p]=c.useState({project:"",status:"",brand:""}),[x,h]=c.useState(!1),[r,i]=c.useState({project:"",color_name:"",color_code:"",brand:"",location:"",notes:""}),g=()=>{var e;return((e=document.querySelector('meta[name="csrf-token"]'))==null?void 0:e.getAttribute("content"))||""},d=async()=>{n(!0),l(null);try{const e=new URLSearchParams;s.project&&e.set("project",s.project),s.status&&e.set("status",s.status),s.brand&&e.set("brand",s.brand);const o=await fetch(`/api/v1/color-approvals/?${e}`,{headers:{Accept:"application/json"},credentials:"include"});if(!o.ok)throw new Error(`HTTP ${o.status}`);const a=await o.json();v(a.results||a)}catch(e){l(e.message||"Error loading approvals")}finally{n(!1)}};c.useEffect(()=>{d()},[s]);const y=async e=>{e.preventDefault(),n(!0),l(null);try{const o=await fetch("/api/v1/color-approvals/",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":g()},credentials:"include",body:JSON.stringify(r)});if(!o.ok)throw new Error(`HTTP ${o.status}`);h(!1),i({project:"",color_name:"",color_code:"",brand:"",location:"",notes:""}),d()}catch(o){l(o.message||"Error creating approval request")}finally{n(!1)}},b=async(e,o)=>{n(!0),l(null);try{const a=new FormData,m=await fetch(`/api/v1/color-approvals/${e}/approve/`,{method:"POST",headers:{"X-CSRFToken":g()},credentials:"include",body:a});if(!m.ok)throw new Error(`HTTP ${m.status}`);d()}catch(a){l(a.message||"Error approving")}finally{n(!1)}},C=async(e,o)=>{n(!0),l(null);try{const a=await fetch(`/api/v1/color-approvals/${e}/reject/`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":g()},credentials:"include",body:JSON.stringify({reason:o})});if(!a.ok)throw new Error(`HTTP ${a.status}`);d()}catch(a){l(a.message||"Error rejecting")}finally{n(!1)}};return c.useEffect(()=>{const e=document.getElementById("color-approvals-root");e&&(e.setAttribute("data-mounted","1"),console.log("[ColorApprovals] mounted, approvals length:",u.length))},[u.length]),t.jsxs("div",{className:"color-approvals",style:{padding:20},children:[t.jsx("h2",{children:"Color Approvals"}),t.jsxs("div",{style:{marginBottom:16,display:"flex",gap:8,alignItems:"center"},children:[t.jsx("input",{placeholder:"Project ID",value:s.project,onChange:e=>p({...s,project:e.target.value}),style:{padding:"6px 8px"}}),t.jsxs("select",{value:s.status,onChange:e=>p({...s,status:e.target.value}),style:{padding:"6px 8px"},children:[t.jsx("option",{value:"",children:"All statuses"}),t.jsx("option",{value:"PENDING",children:"Pending"}),t.jsx("option",{value:"APPROVED",children:"Approved"}),t.jsx("option",{value:"REJECTED",children:"Rejected"})]}),t.jsx("input",{placeholder:"Brand",value:s.brand,onChange:e=>p({...s,brand:e.target.value}),style:{padding:"6px 8px"}}),t.jsx("button",{onClick:d,disabled:j,children:"Refresh"}),t.jsx("button",{onClick:()=>h(!x),style:{marginLeft:"auto"},children:"+ Request Approval"})]}),f&&t.jsx("div",{style:{color:"red",marginBottom:12},children:f}),x&&t.jsxs("form",{onSubmit:y,style:{background:"#f9f9f9",padding:12,borderRadius:8,marginBottom:16},children:[t.jsx("h3",{children:"New Approval Request"}),t.jsxs("div",{style:{display:"grid",gap:8},children:[t.jsx("input",{placeholder:"Project ID",value:r.project,onChange:e=>i({...r,project:e.target.value}),required:!0}),t.jsx("input",{placeholder:"Color Name",value:r.color_name,onChange:e=>i({...r,color_name:e.target.value}),required:!0}),t.jsx("input",{placeholder:"Color Code",value:r.color_code,onChange:e=>i({...r,color_code:e.target.value})}),t.jsx("input",{placeholder:"Brand",value:r.brand,onChange:e=>i({...r,brand:e.target.value})}),t.jsx("input",{placeholder:"Location",value:r.location,onChange:e=>i({...r,location:e.target.value})}),t.jsx("textarea",{placeholder:"Notes",value:r.notes,onChange:e=>i({...r,notes:e.target.value})}),t.jsxs("div",{style:{display:"flex",gap:8},children:[t.jsx("button",{type:"submit",disabled:j,children:"Submit"}),t.jsx("button",{type:"button",onClick:()=>h(!1),children:"Cancel"})]})]})]}),t.jsx("div",{style:{display:"grid",gap:12},children:u.map(e=>t.jsx("div",{style:{border:"1px solid #ddd",borderRadius:8,padding:12,background:"#fff"},children:t.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[t.jsxs("div",{children:[t.jsxs("strong",{children:[e.color_name," (",e.color_code,")"]})," ","- ",e.brand,t.jsxs("div",{style:{fontSize:12,color:"#666"},children:["Location: ",e.location," | Status: ",t.jsx("strong",{children:e.status})]}),t.jsxs("div",{style:{fontSize:12,color:"#666"},children:["Created: ",new Date(e.created_at).toLocaleString()]}),e.notes&&t.jsx("div",{style:{fontSize:12,marginTop:4},children:e.notes})]}),t.jsx("div",{style:{display:"flex",gap:8,alignItems:"flex-start"},children:e.status==="PENDING"&&t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:()=>{b(e.id)},style:{fontSize:12},children:"Approve"}),t.jsx("button",{onClick:()=>{const o=prompt("Rejection reason:");o&&C(e.id,o)},style:{fontSize:12},children:"Reject"})]})})]})},e.id))})]})}S.createRoot(document.getElementById("color-approvals-root")).render(t.jsx(R.StrictMode,{children:t.jsx(E,{})}));
