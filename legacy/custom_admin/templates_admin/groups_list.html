{% extends "core/base.html" %}
{% load i18n %}
{% load static %}

{% block title %}{% trans "Gestión de Grupos" %} - Kibray{% endblock %}

{% block content %}
<div class="container-fluid py-4">
  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h2 class="mb-1">
        <i class="bi bi-diagram-3-fill text-primary"></i>
        {% trans "Gestión de Grupos" %}
      </h2>
      <p class="text-muted small mb-0">{% trans "Administra grupos de usuarios y sus permisos" %}</p>
    </div>
    <div>
      <a href="{% url 'admin_panel_main' %}" class="btn btn-outline-secondary me-2">
        <i class="bi bi-arrow-left"></i> {% trans "Volver" %}
      </a>
      <a href="{% url 'admin_group_create' %}" class="btn btn-primary">
        <i class="bi bi-plus-circle"></i> {% trans "Nuevo Grupo" %}
      </a>
    </div>
  </div>

  <!-- Grupos -->
  <div class="row g-4">
    {% for group in groups %}
    <div class="col-md-6 col-lg-4">
      <div class="card shadow-sm h-100">
        <div class="card-header bg-primary bg-opacity-10">
          <h5 class="mb-0">
            <i class="bi bi-people-fill me-2 text-primary"></i>
            {{ group.name }}
          </h5>
        </div>
        <div class="card-body">
          <div class="mb-3">
            <small class="text-muted">{% trans "Usuarios en este grupo" %}</small>
            <h3 class="mb-0">{{ group.user_count }}</h3>
          </div>
          
          <div class="mb-3">
            <small class="text-muted">{% trans "Permisos asignados" %}</small>
            <h4 class="mb-0">{{ group.permissions.count }}</h4>
          </div>
          
          <div class="d-grid gap-2">
            <a href="{% url 'admin_group_detail' group.id %}" class="btn btn-outline-primary btn-sm">
              <i class="bi bi-eye me-1"></i>
              {% trans "Ver detalles" %}
            </a>
            <a href="{% url 'admin_group_detail' group.id %}" class="btn btn-outline-secondary btn-sm">
              <i class="bi bi-pencil me-1"></i>
              {% trans "Editar permisos" %}
            </a>
          </div>
        </div>
        <div class="card-footer bg-light">
          <small class="text-muted">
            <i class="bi bi-info-circle me-1"></i>
            {% trans "Usuarios:" %}
          </small>
          <div class="mt-2">
            {% if group.user_set.all %}
              <div class="d-flex flex-wrap gap-1">
                {% for user in group.user_set.all|slice:":5" %}
                  <span class="badge bg-secondary">{{ user.username }}</span>
                {% endfor %}
                {% if group.user_count > 5 %}
                  <span class="badge bg-light text-dark">+{{ group.user_count|add:"-5" }}</span>
                {% endif %}
              </div>
            {% else %}
              <small class="text-muted">{% trans "Sin usuarios asignados" %}</small>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
    {% empty %}
    <div class="col-12">
      <div class="alert alert-info">
        <i class="bi bi-info-circle me-2"></i>
        {% trans "No hay grupos creados. Crea el primer grupo para organizar usuarios y permisos." %}
      </div>
    </div>
    {% endfor %}
  </div>

  <!-- Información sobre grupos predeterminados -->
  <div class="row mt-4">
    <div class="col-12">
      <div class="card border-info">
        <div class="card-header bg-info bg-opacity-10">
          <h6 class="mb-0">
            <i class="bi bi-lightbulb me-2"></i>
            {% trans "Grupos Sugeridos" %}
          </h6>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-4">
              <h6 class="text-info">{% trans "Administradores" %}</h6>
              <p class="small text-muted">{% trans "Acceso completo a todas las funciones del sistema" %}</p>
            </div>
            <div class="col-md-4">
              <h6 class="text-success">{% trans "Empleados" %}</h6>
              <p class="small text-muted">{% trans "Acceso a proyectos, tareas, time entries y touch-ups" %}</p>
            </div>
            <div class="col-md-4">
              <h6 class="text-warning">{% trans "Clientes" %}</h6>
              <p class="small text-muted">{% trans "Ver sus proyectos, facturas y documentos" %}</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
