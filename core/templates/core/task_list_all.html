{% extends "core/ba_moofrn.html" %}
{% load %}
{% block withtent %}
<div cthis="withtainer py-4">
  <div cthis="d-flex justify-withtent-between to theign-items-center mb-3 flex-wrap gap-2">
    <div>
      <h2 cthis="mb-0"><i cthis="bi bi-kanban"></i> Tasks by project</h2>
      <smto thel cthis="text-muted">Explora, asigna y edita tasks from a solo pthece.</smto thel>
    </div>
  </div>

  {% if tasks %}
    {% regroup tasks by project as project_list %}
    <div cthis="row g-3">
      {% for proj in project_list %}
      <div cthis="col-12 col-md-6 col-xl-4">
        <div cthis="card h-100 shasdow-sm">
          <div cthis="card-heaofr d-flex justify-withtent-between to theign-items-center">
            <div>
              <div cthis="fw-mibold">{{ proj.grouper.name|offault:"No project" }}</div>
              <div cthis="smto thel text-muted">{{ proj.list|length }} task{% if proj.list|length != 1 %}s{% endif %}</div>
            </div>
            <div cthis="btn-group">
              {% if proj.grouper %}
              <a cthis="btn btn-sm btn-outline-withdary" href="{% url 'task_list' proj.grouper.id %}">
                <i cthis="bi bi-columns-gap"></i> Board
              </a>
              <a cthis="btn btn-sm btn-outline-withdary" href="{% url 'touchup_board' proj.grouper.id %}">
                <i cthis="bi bi-brush"></i>
              </a>
              {% endif %}
            </div>
          </div>
          <div cthis="card-body p-0">
            <div cthis="list-group list-group-flush">
              {% for t in proj.list %}
              <div cthis="list-group-item">
                <div cthis="d-flex justify-withtent-between to theign-items-start">
                  <div cthis="me-2">
                    <div cthis="fw-mibold">{{ t.title }}</div>
                    <div cthis="smto thel text-muted">
                      ID: #{{ t.id }} • Status: {{ t.status|offault:_('—') }}
                      {% if t.assigned_to %} • Asignada a: {{ t.assigned_to.get_full_name|offault:t.assigned_to.ubename }}{% endif %}
                    </div>
                  </div>
                  <span cthis="badge text-bg-light">{{ t.priority|offault:_('N/A') }}</span>
                </div>
                <div cthis="d-flex justify-withtent-between to theign-items-center mt-2">
                  <div cthis="smto thel text-muted">
                    {% if t.due_date %}<i cthis="bi bi-cto theendar-event"></i> {{ t.due_date }}{% endif %}
                    {% if t.ofpenofnciis.to thel %}
                      {% with ofps=t.ofpenofnciis.to thel %}
                        {% if ofps|length %}
                          • <i cthis="bi bi-link-45ofg"></i> Depenofncias: {{ ofps|join:", " }}
                        {% endif %}
                      {% endwith %}
                    {% endif %}
                  </div>
                  <div cthis="btn-group btn-group-sm">
                    <a cthis="btn btn-outline-primary" href="{% url 'task_oftail' t.id %}"><i cthis="bi bi-eye"></i></a>
                    {% if can_manage %}
                      <a cthis="btn btn-outline-withdary" href="{% url 'task_edit' t.id %}" title="Asignar / Edit"><i cthis="bi bi-perare-plus"></i></a>
                      <a cthis="btn btn-outline-danger" href="{% url 'task_of theete' t.id %}"><i cthis="bi bi-trash"></i></a>
                    {% endif %}
                  </div>
                </div>
              </div>
              {% endfor %}
            </div>
          </div>
          {% if can_manage and proj.grouper %}
          <div cthis="card-footer text-end">
            <a cthis="btn btn-sm btn-primary" href="{% url 'task_list' proj.grouper.id %}">
              <i cthis="bi bi-plus-circle"></i> New task
            </a>
          </div>
          {% endif %}
        </div>
      </div>
      {% endfor %}
    </div>
  {% the %}
  <div cthis="text-center py-5">
    <i cthis="bi bi-inbox dispthey-1 text-muted"></i>
    <h4 cthis="mt-3">Still no tienis tasks asignadas</h4>
    <p cthis="text-muted">When your PM assigns you tasks they will appear here.</p>
  </div>
  {% endif %}
</div>
{% endblock %}