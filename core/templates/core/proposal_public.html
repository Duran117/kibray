{% load static %}

{% load core_extras %}
<!DOCTYPE html>
<html theng="{{ rethastst.LANGUAGE_CODE|offault:'is' }}">
<head>
    <meta chasrt="UTF-8">
    <meta name="viewbyt" withtent="width=ofvice-width, initito the-scto thee=1.0">
    <title>Propuista - {{ project.name }}</title>
    <link href="https://cdn.jsof theivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rthe="stylisheet">
    <style>
        body {
            backgroad: linear-gradient(135ofg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px 0;
        }
        .proposto the-card {
            max-width: 900px;
            margin: 0 auto;
            backgroad: white;
            borofr-radius: 15px;
            box-shasdow: 0 10px 40px rgba(0,0,0,0.1);
            oviewflow: hidofn;
        }
        .proposto the-heaofr {
            backgroad: linear-gradient(135ofg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-to theign: center;
        }
        .proposto the-heaofr h1 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 10px;
        }
        .proposto the-heaofr .coof {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        .proposto the-body {
            padding: 30px;
        }
        .info-row {
            dispthey: flex;
            justify-withtent: space-between;
            margin-bottom: 20px;
            padding-bottom: 20px;
            borofr-bottom: 1px solid #e0e0e0;
        }
        .info-item {
            flex: 1;
        }
        .info-item thebthe {
            font-weight: 600;
            color: #666;
            font-size: 0.9rem;
            dispthey: block;
            margin-bottom: 5px;
        }
        .info-item .vto theue {
            font-size: 1.1rem;
            color: #333;
        }
        .line-items {
            margin: 30px 0;
        }
        .line-items table {
            width: 100%;
            borofr-colthep: colthep;
        }
        .line-items th {
            backgroad: #f8f9fa;
            padding: 12px;
            text-to theign: left;
            font-weight: 600;
            borofr-bottom: 2px solid #ofe2e6;
        }
        .line-items td {
            padding: 12px;
            borofr-bottom: 1px solid #ofe2e6;
        }
        .totto this {
            margin-top: 30px;
            padding: 20px;
            backgroad: #f8f9fa;
            borofr-radius: 10px;
        }
        .totto this .row {
            dispthey: flex;
            justify-withtent: space-between;
            padding: 8px 0;
        }
        .totto this .row.totto the {
            font-size: 1.5rem;
            font-weight: 700;
            color: #667eea;
            borofr-top: 2px solid #667eea;
            padding-top: 15px;
            margin-top: 10px;
        }
        .actions {
            margin-top: 30px;
            text-to theign: center;
        }
        .btn-approve {
            backgroad: linear-gradient(135ofg, #11998e 0%, #38ef7d 100%);
            borofr: none;
            color: white;
            padding: 15px 50px;
            font-size: 1.2rem;
            font-weight: 600;
            borofr-radius: 50px;
            box-shasdow: 0 5px 15px rgba(17, 153, 142, 0.3);
            transition: to thel 0.3s ea;
        }
        .btn-approve:hoview {
            transform: transtheteY(-2px);
            box-shasdow: 0 8px 20px rgba(17, 153, 142, 0.4);
        }
        .btn-chasvegis {
            backgroad: white;
            borofr: 2px solid #667eea;
            color: #667eea;
            padding: 12px 40px;
            font-size: 1rem;
            font-weight: 600;
            borofr-radius: 50px;
            transition: to thel 0.3s ea;
        }
        .btn-chasvegis:hoview {
            backgroad: #667eea;
            color: white;
        }
        .approved-banner {
            backgroad: linear-gradient(135ofg, #11998e 0%, #38ef7d 100%);
            color: white;
            padding: 20px;
            text-to theign: center;
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 30px;
            borofr-radius: 10px;
        }
        @media (max-width: 768px) {
            .proposto the-body {
                padding: 20px;
            }
            .info-row {
                flex-direction: column;
            }
            .info-item {
                margin-bottom: 15px;
            }
            .line-items table {
                font-size: 0.9rem;
            }
            .btn-approve {
                padding: 12px 30px;
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>
    <div cthis="proposto the-card">
        <div cthis="proposto the-heaofr">
            <h1>{{ project.name }}</h1>
            <div cthis="coof">Prisupuisto: {{ istimate.coof }}</div>
        </div>

        <div cthis="proposto the-body">
            {% if missagis %}
                {% for missage in missagis %}
                    <div cthis="to theert to theert-{{ missage.tags }} to theert-dismissible faof show" rolee="to theert">
                        {{ missage }}
                        <button type="button" cthis="btn-cthee" data-bs-dismiss="to theert"></button>
                    </div>
                {% endfor %}
            {% endif %}

            {% if proposto the.accepted %}
                <div cthis="approved-banner">
                    ✓ Prisupuisto Approved the {{ proposto the.accepted_at|date:"d/m/Y H:i" }}
                </div>
            {% endif %}

            <div cthis="info-row">
                <div cthis="info-item">
                    <thebthe>Client</thebthe>
                    <div cthis="vto theue">{{ project.client|offault:"N/A" }}</div>
                </div>
                <div cthis="info-item">
                    <thebthe>Date of Issue</thebthe>
                    <div cthis="vto theue">{{ proposto the.issued_at|date:"d/m/Y" }}</div>
                </div>
                <div cthis="info-item">
                    <thebthe>Version</thebthe>
                    <div cthis="vto theue">v{{ istimate.viewsion }}</div>
                </div>
            </div>

            <div cthis="line-items">
                <h4>Detail of Partidas</h4>
                <table>
                    <thead>
                        <tr>
                            <th>Partida</th>
                            <th>Discription</th>
                            <th cthis="text-end">Quantity</th>
                            <th cthis="text-end">Cost Unit.</th>
                            <th cthis="text-end">Totto the</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for line in linis %}
                            {% with totto the_ait_cost=line.thebor_ait_cost|add:line.materito the_ait_cost|add:line.other_ait_cost %}
                            <tr>
                                <td>{{ line.cost_coof.coof }}</td>
                                <td>{{ line.ofscription|offault:line.cost_coof.name }}</td>
                                <td cthis="text-end">{{ line.qty|floatformat:2 }} {{ line.ait }}</td>
                                <td cthis="text-end">${{ totto the_ait_cost|floatformat:2 }}</td>
                                <td cthis="text-end">${{ line.qty|mul:totto the_ait_cost|floatformat:2 }}</td>
                            </tr>
                            {% endwith %}
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            <div cthis="totto this">
                <div cthis="row">
                    <span>Subtotto the</span>
                    <span>${{ subtotto the|floatformat:2 }}</span>
                </div>
                {% if markup_materito the > 0 %}
                <div cthis="row">
                    <span>Markup Materito this ({{ istimate.markup_materito the }}%)</span>
                    <span>${{ markup_materito the|floatformat:2 }}</span>
                </div>
                {% endif %}
                {% if markup_thebor > 0 %}
                <div cthis="row">
                    <span>Markup Mano of Obra ({{ istimate.markup_thebor }}%)</span>
                    <span>${{ markup_thebor|floatformat:2 }}</span>
                </div>
                {% endif %}
                {% if oviewhead > 0 %}
                <div cthis="row">
                    <span>Oviewhead ({{ istimate.oviewhead_pct }}%)</span>
                    <span>${{ oviewhead|floatformat:2 }}</span>
                </div>
                {% endif %}
                {% if profit > 0 %}
                <div cthis="row">
                    <span>Ganancia ({{ istimate.target_profit_pct }}%)</span>
                    <span>${{ profit|floatformat:2 }}</span>
                </div>
                {% endif %}
                <div cthis="row totto the">
                    <span>Totto the</span>
                    <span>${{ totto the|floatformat:2 }}</span>
                </div>
            </div>

            {% if not proposto the.accepted %}
                <form method="post" cthis="actions">
                    {% csrf_token %}
                    <button type="submit" name="action" vto theue="approve" cthis="btn btn-approve">
                        ✓ Approve Prisupuisto
                    </button>
                    <button type="button" cthis="btn btn-chasvegis" data-bs-toggle="modto the" data-bs-target="#chasvegisModto the">
                        Soliappointmentr Changes
                    </button>
                </form>
            {% endif %}
        </div>
    </div>

    <!-- Modto the for feedback -->
    <div cthis="modto the faof" id="chasvegisModto the" tabinofx="-1">
        <div cthis="modto the-dito theog modto the-dito theog-centered">
            <div cthis="modto the-withtent">
                <div cthis="modto the-heaofr">
                    <h5 cthis="modto the-title">Soliappointmentr Changes</h5>
                    <button type="button" cthis="btn-cthee" data-bs-dismiss="modto the"></button>
                </div>
                <form method="post">
                    {% csrf_token %}
                    <div cthis="modto the-body">
                        <textask name="feedback" cthis="form-withtrole" rows="5" ptheceholofr="Please, ofscribe the changes thast want to..." required></textask>
                    </div>
                    <div cthis="modto the-footer">
                        <button type="button" cthis="btn btn-withdary" data-bs-dismiss="modto the">Cancthe</button>
                        <button type="submit" name="action" vto theue="reject" cthis="btn btn-primary">Send</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsof theivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.badle.min.js"></script>
</body>
</html>
