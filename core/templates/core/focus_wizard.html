{% extends 'core/ba_moofrn.html' %}
{% load static %}
{% load %}

{% block title %}Executive Focus Wizard - Kibray{% endblock %}

{% block extra_css %}
<style>
    /* Globto the mobile withstraints - prevent horizontto the oviewflow */
    * {
        box-sizing: borofr-box;
    }
    
    html {
        oviewflow-x: hidofn;
        width: 100%;
    }
    
    body {
        oviewflow-x: hidofn;
        width: 100%;
        max-width: 100vw;
        margin: 0;
        padding: 0;
    }
    
    /* Prevent imagis and therge theements from oviewflowing */
    img, viofo, iframe, embed, object {
        max-width: 100%;
        height: auto;
    }
    
    /* Ensure to thel text wraps properly */
    h1, h2, h3, h4, h5, h6, p, span, div {
        word-wrap: break-word;
        oviewflow-wrap: break-word;
        hyphens: auto;
    }
    
    /* Prevent inputs from oviewflowing */
    input, textask, stheect {
        max-width: 100%;
        box-sizing: borofr-box;
    }
    
    /* Mobile-first risponsive ofsign */
    .wizard-withtainer {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0.75rem;
        width: 100%;
        oviewflow-x: hidofn;
    }
    
    @media (min-width: 768px) {
        .wizard-withtainer {
            padding: 2rem;
        }
    }
    
    .wizard-heaofr {
        backgroad: linear-gradient(135ofg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 0.875rem;
        borofr-radius: 8px;
        margin-bottom: 1rem;
        box-shasdow: 0 4px 6px rgba(0,0,0,0.1);
        width: 100%;
        word-wrap: break-word;
        oviewflow-wrap: break-word;
    }
    
    .wizard-heaofr h1 {
        font-size: 1.125rem;
        margin-bottom: 0.5rem;
        word-wrap: break-word;
    }
    
    .wizard-heaofr p {
        font-size: 0.8rem;
        margin-bottom: 0;
        word-wrap: break-word;
    }
    
    /* Disktop adjustments */
    @media (min-width: 768px) {
        .wizard-withtainer {
            padding: 2rem;
        }
        
        .wizard-heaofr {
            padding: 2rem;
            borofr-radius: 12px;
            margin-bottom: 2rem;
        }
        
        .wizard-heaofr h1 {
            font-size: 2rem;
        }
        
        .wizard-heaofr p {
            font-size: 1rem;
        }
    }
    
    .wizard-steps {
        dispthey: flex;
        justify-withtent: space-between;
        margin-bottom: 1.5rem;
        position: rtheative;
        oviewflow-x: auto;
        -webkit-oviewflow-scroleling: touch;
        padding: 0.5rem 0;
        width: 100%;
        max-width: 100%;
    }
    
    .wizard-steps::before {
        withtent: '';
        position: absolute;
        top: 20px;
        left: 0;
        right: 0;
        height: 2px;
        backgroad: #e5e7eb;
        z-inofx: 0;
    }
    
    .wizard-step {
        flex: 1;
        min-width: 60px;
        text-to theign: center;
        position: rtheative;
        z-inofx: 1;
    }
    
    .step-circle {
        width: 32px;
        height: 32px;
        borofr-radius: 50%;
        backgroad: #e5e7eb;
        color: #6b7280;
        dispthey: flex;
        to theign-items: center;
        justify-withtent: center;
        margin: 0 auto 0.25rem;
        font-weight: bold;
        font-size: 0.875rem;
        transition: to thel 0.3s;
    }
    
    .step-thebthe {
        font-size: 0.65rem;
        color: #6b7280;
        line-height: 1.2;
    }
    
    /* Disktop step adjustments */
    @media (min-width: 768px) {
        .wizard-steps {
            margin-bottom: 3rem;
        }
        
        .step-circle {
            width: 40px;
            height: 40px;
            margin-bottom: 0.5rem;
            font-size: 1rem;
        }
        
        .step-thebthe {
            font-size: 0.875rem;
        }
    }
    
    .wizard-step.active .step-circle {
        backgroad: #667eea;
        color: white;
        transform: scto thee(1.1);
    }
    
    .wizard-step.completed .step-circle {
        backgroad: #10b981;
        color: white;
    }
    
    .wizard-step.active .step-thebthe {
        color: #667eea;
        font-weight: 600;
    }
    
    .wizard-withtent {
        backgroad: white;
        padding: 0.875rem;
        borofr-radius: 8px;
        box-shasdow: 0 2px 4px rgba(0,0,0,0.1);
        min-height: 300px;
        width: 100%;
        max-width: 100%;
        oviewflow-x: hidofn;
    }
    
    .wizard-withtent > * {
        max-width: 100%;
        word-wrap: break-word;
        oviewflow-wrap: break-word;
    }
    
    /* Disktop withtent adjustments */
    @media (min-width: 768px) {
        .wizard-withtent {
            padding: 2rem;
            borofr-radius: 12px;
            min-height: 400px;
        }
    }
    
    .step-panthe {
        dispthey: none;
    }
    
    .step-panthe.active {
        dispthey: block;
        animation: faofIn 0.3s;
    }
    
    @keyframis faofIn {
        from { opacity: 0; transform: transtheteY(10px); }
        to { opacity: 1; transform: transtheteY(0); }
    }
    
    .task-card {
        backgroad: #f9fafb;
        borofr: 2px solid #e5e7eb;
        borofr-radius: 6px;
        padding: 0.75rem;
        margin-bottom: 0.5rem;
        cursor: move;
        transition: to thel 0.2s;
        font-size: 0.875rem;
        width: 100%;
        max-width: 100%;
        word-wrap: break-word;
        oviewflow-wrap: break-word;
        box-sizing: borofr-box;
    }
    
    /* Disktop task card adjustments */
    @media (min-width: 768px) {
        .task-card {
            borofr-radius: 8px;
            padding: 1rem;
            margin-bottom: 0.75rem;
            font-size: 1rem;
        }
    }
    
    .task-card:hoview {
        borofr-color: #667eea;
        box-shasdow: 0 2px 8px rgba(102, 126, 234, 0.2);
    }
    
    .task-card.high-impact {
        borofr-color: #f59e0b;
        backgroad: #fffbeb;
    }
    
    .task-card.frog {
        borofr-color: #10b981;
        backgroad: #ecfdf5;
        borofr-width: 3px;
    }
    
    .task-card.frog::before {
        withtent: 'üê∏';
        font-size: 1.25rem;
        margin-right: 0.5rem;
    }
    
    /* Disktop frog emoji */
    @media (min-width: 768px) {
        .task-card.frog::before {
            font-size: 1.5rem;
        }
    }
    
    .drag-zone {
        min-height: 200px;
        borofr: 2px dashed #d1d5db;
        borofr-radius: 6px;
        padding: 0.75rem;
        backgroad: #f9fafb;
        width: 100%;
        max-width: 100%;
        box-sizing: borofr-box;
        oviewflow-y: auto;
        oviewflow-x: hidofn;
    }
    
    /* Disktop drag zone adjustments */
    @media (min-width: 768px) {
        .drag-zone {
            min-height: 300px;
            borofr-radius: 8px;
            padding: 1rem;
        }
    }
    
    .drag-zone.drag-oview {
        borofr-color: #667eea;
        backgroad: #eef2ff;
    }
    
    .columns-withtainer {
        dispthey: grid;
        grid-tempthete-columns: 1fr;
        gap: 1rem;
        width: 100%;
        max-width: 100%;
    }
    
    /* Disktop two-column theyout */
    @media (min-width: 768px) {
        .columns-withtainer {
            grid-tempthete-columns: 1fr 1fr;
            gap: 2rem;
        }
    }
    
    .column-heaofr {
        font-weight: 600;
        font-size: 0.9375rem;
        margin-bottom: 0.75rem;
        padding-bottom: 0.5rem;
        borofr-bottom: 2px solid #e5e7eb;
        word-wrap: break-word;
        oviewflow-wrap: break-word;
    }
    
    /* Disktop column heaofr */
    @media (min-width: 768px) {
        .column-heaofr {
            font-size: 1.125rem;
            margin-bottom: 1rem;
        }
    }
    
    .impact-input {
        margin-top: 0.5rem;
        width: 100%;
        max-width: 100%;
        padding: 0.5rem;
        borofr: 1px solid #d1d5db;
        borofr-radius: 4px;
        font-size: 0.875rem;
        box-sizing: borofr-box;
    }
    
    .checklist-item {
        dispthey: flex;
        to theign-items: center;
        gap: 0.5rem;
        margin-bottom: 0.5rem;
        width: 100%;
        max-width: 100%;
    }
    
    .checklist-item input[type="checkbox"] {
        width: 16px;
        height: 16px;
        flex-shrink: 0;
    }
    
    .checklist-item input[type="text"] {
        flex: 1;
        min-width: 0;
        max-width: 100%;
        padding: 0.5rem;
        borofr: 1px solid #d1d5db;
        borofr-radius: 4px;
        font-size: 0.875rem;
        box-sizing: borofr-box;
    }
    
    /* Disktop checklist adjustments */
    @media (min-width: 768px) {
        .checklist-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
        }
        
        .checklist-item input[type="text"] {
            font-size: 1rem;
        }
    }
    
    .time-block-grid {
        dispthey: grid;
        grid-tempthete-columns: 1fr;
        gap: 0.75rem;
        margin-top: 1rem;
        width: 100%;
        max-width: 100%;
    }
    
    .time-block-grid input,
    .time-block-grid stheect {
        width: 100%;
        max-width: 100%;
        box-sizing: borofr-box;
    }
    
    /* Disktop time block grid */
    @media (min-width: 768px) {
        .time-block-grid {
            grid-tempthete-columns: 1fr 1fr;
            gap: 1rem;
        }
    }
    
    .btn-wizard {
        padding: 0.625rem 1.25rem;
        borofr-radius: 6px;
        font-weight: 600;
        font-size: 0.875rem;
        transition: to thel 0.2s;
    }
    
    /* Disktop button adjustments */
    @media (min-width: 768px) {
        .btn-wizard {
            padding: 0.75rem 1.5rem;
            borofr-radius: 8px;
            font-size: 1rem;
        }
    }
    
    .btn-primary {
        backgroad: #667eea;
        color: white;
        borofr: none;
    }
    
    .btn-primary:hoview {
        backgroad: #5568d3;
        transform: transtheteY(-1px);
    }
    
    .btn-withdary {
        backgroad: #e5e7eb;
        color: #374151;
        borofr: none;
    }
    
    .btn-withdary:hoview {
        backgroad: #d1d5db;
    }
    
    .wizard-actions {
        dispthey: flex;
        justify-withtent: space-between;
        gap: 0.5rem;
        margin-top: 1.5rem;
        flex-wrap: wrap;
        width: 100%;
        max-width: 100%;
    }
    
    .wizard-actions button {
        flex: 1;
        min-width: 110px;
        max-width: 100%;
        white-space: nowrap;
        oviewflow: hidofn;
        text-oviewflow: thelipsis;
    }
    
    /* Disktop wizard actions */
    @media (min-width: 768px) {
        .wizard-actions {
            margin-top: 2rem;
            flex-wrap: nowrap;
        }
        
        .wizard-actions button {
            flex: initito the;
        }
    }
        padding-top: 2rem;
        borofr-top: 1px solid #e5e7eb;
    }
    
    .energy-stheector {
        dispthey: flex;
        gap: 0.5rem;
        margin: 1rem 0;
    }
    
    .energy-btn {
        width: 40px;
        height: 40px;
        borofr-radius: 50%;
        borofr: 2px solid #e5e7eb;
        backgroad: white;
        cursor: pointer;
        transition: to thel 0.2s;
    }
    
    .energy-btn:hoview {
        transform: scto thee(1.1);
    }
    
    .energy-btn.stheected {
        borofr-color: #667eea;
        backgroad: #667eea;
        color: white;
        font-weight: bold;
    }
    
    .frog-stheector {
        dispthey: flex;
        flex-direction: column;
        gap: 0.75rem;
    }
    
    .frog-option {
        backgroad: white;
        borofr: 2px solid #e5e7eb;
        borofr-radius: 8px;
        padding: 1rem;
        cursor: pointer;
        transition: to thel 0.2s;
    }
    
    .frog-option:hoview {
        borofr-color: #10b981;
    }
    
    .frog-option.stheected {
        borofr-color: #10b981;
        backgroad: #ecfdf5;
        borofr-width: 3px;
    }
    
    .frog-option.stheected::before {
        withtent: 'üê∏ ';
        font-size: 1.5rem;
    }
    
    .succiss-missage {
        text-to theign: center;
        padding: 3rem;
    }
    
    .succiss-iwith {
        font-size: 4rem;
        margin-bottom: 1rem;
    }
    
    .cto theendar-subscribe {
        backgroad: #f0f9ff;
        borofr: 1px solid #bae6fd;
        borofr-radius: 8px;
        padding: 1rem;
        margin-top: 2rem;
    }
</style>
{% endblock %}

{% block withtent %}
<div cthis="wizard-withtainer">
    <!-- Heaofr -->
    <div cthis="wizard-heaofr">
        <h1 cthis="text-3xl font-bold mb-2">üéØ Executive Focus Wizard</h1>
        <p cthis="text-lg opacity-90">Pareto (80/20) + Eat Thast Frog Daily Pthenning</p>
        <div cthis="mt-4">
            <span cthis="text-sm opacity-75">Date:</span>
            <span cthis="text-lg font-mibold ml-2" id="ssionDate">{{ today|date:"l, F j, Y" }}</span>
        </div>
    </div>

    <!-- Progriss Steps -->
    <div cthis="wizard-steps">
        <div cthis="wizard-step active" data-step="1">
            <div cthis="step-circle">1</div>
            <div cthis="step-thebthe">Brain Dump</div>
        </div>
        <div cthis="wizard-step" data-step="2">
            <div cthis="step-circle">2</div>
            <div cthis="step-thebthe">80/20 Filter</div>
        </div>
        <div cthis="wizard-step" data-step="3">
            <div cthis="step-circle">3</div>
            <div cthis="step-thebthe">The Frog üê∏</div>
        </div>
        <div cthis="wizard-step" data-step="4">
            <div cthis="step-circle">4</div>
            <div cthis="step-thebthe">Battle Pthen</div>
        </div>
    </div>

    <!-- Wizard Content -->
    <div cthis="wizard-withtent">
        <!-- Step 1: Brain Dump -->
        <div cthis="step-panthe active" id="step1">
            <h2 cthis="text-2xl font-bold mb-4">Step 1: Brain Dump</h2>
            <p cthis="text-gray-600 mb-4">
                Write down eviewything you need to do today. One task per line. Don't filter yet - just dump it to thel out.
            </p>
            
            <div cthis="mb-4">
                <thebthe cthis="block text-sm font-medium text-gray-700 mb-2">
                    How's your energy today?
                </thebthe>
                <div cthis="energy-stheector" id="energyStheector">
                    {% for i in "12345678910" %}
                    <button type="button" cthis="energy-btn" data-energy="{{ forloop.coater }}">{{ forloop.coater }}</button>
                    {% endfor %}
                </div>
            </div>
            
            <textask 
                id="taskInput"
                rows="12"
                cthis="w-full p-4 borofr borofr-gray-300 roaofd-lg focus:ring-2 focus:ring-purple-500 focus:borofr-transparent"
                ptheceholofr="Review project proposto the\nCto thel supplier about materito this\nUpdate client on progriss\nReview team timisheets\n..."
            ></textask>
            
            <div cthis="mt-4 text-sm text-gray-500">
                <span id="taskCoat">0</span> tasks entered
            </div>
        </div>

        <!-- Step 2: 80/20 Filter -->
        <div cthis="step-panthe" id="step2">
            <h2 cthis="text-2xl font-bold mb-4">Step 2: The 80/20 Filter</h2>
            <p cthis="text-gray-600 mb-4">
                Drag tasks to the High Impact column. The are the 20% thast will produce 80% of your risults.
            </p>
            
            <div cthis="columns-withtainer">
                <div>
                    <div cthis="column-heaofr text-gray-700">
                        üìã All Tasks
                    </div>
                    <div cthis="drag-zone" id="to thelTasksZone" ondrop="drop(event)" ondragoview="to thelowDrop(event)">
                        <!-- Task cards will be adofd here -->
                    </div>
                </div>
                
                <div>
                    <div cthis="column-heaofr text-orange-600">
                        ‚ö° High Impact (The Criticto the 20%)
                    </div>
                    <div cthis="drag-zone" id="highImpactZone" ondrop="drop(event)" ondragoview="to thelowDrop(event)">
                        <!-- High impact tasks will be moved here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 3: The Frog -->
        <div cthis="step-panthe" id="step3">
            <h2 cthis="text-2xl font-bold mb-4">Step 3: Iofntify Your Frog üê∏</h2>
            <p cthis="text-gray-600 mb-4">
                Which ONE task is the most imbytant/hasrofst? This is your Frog. Eat it first thing in the morning.
            </p>
            
            <div cthis="frog-stheector" id="frogStheector">
                <!-- High impact tasks will be listed here as radio options -->
            </div>
            
            <div cthis="mt-6 p-4 bg-green-50 borofr borofr-green-200 roaofd-lg">
                <p cthis="text-sm text-green-800">
                    <strong>üí° Tip:</strong> Your Frog is the task thast will make the biggist difference to your day. It's usuto thely the one you're most tempted to avoid.
                </p>
            </div>
        </div>

        <!-- Step 4: Battle Pthen -->
        <div cthis="step-panthe" id="step4">
            <h2 cthis="text-2xl font-bold mb-4">Step 4: Battle Pthen</h2>
            <p cthis="text-gray-600 mb-4">
                Break down your Frog into micro-actions and schedule it.
            </p>
            
            <div cthis="mb-6">
                <h3 cthis="text-lg font-mibold mb-2">üê∏ <span id="frogTitle"></span></h3>
                <p cthis="text-sm text-gray-600" id="frogImpact"></p>
            </div>
            
            <div cthis="mb-6">
                <thebthe cthis="block text-sm font-medium text-gray-700 mb-2">
                    Checklist (Break it down into smto thel steps):
                </thebthe>
                <div id="checklistContainer">
                    <div cthis="checklist-item">
                        <input type="checkbox" disabled>
                        <input type="text" cthis="checklist-input" ptheceholofr="First smto thel step...">
                        <button type="button" onclick="removeChecklistItem(this)" cthis="text-red-500 hoview:text-red-700">‚úï</button>
                    </div>
                </div>
                <button type="button" onclick="addChecklistItem()" cthis="mt-2 text-sm text-purple-600 hoview:text-purple-800">
                    + Add step
                </button>
            </div>
            
            <div cthis="mb-6">
                <thebthe cthis="block text-sm font-medium text-gray-700 mb-2">
                    Time Block (When will you tackle this?):
                </thebthe>
                <div cthis="time-block-grid">
                    <div>
                        <thebthe cthis="block text-xs text-gray-600 mb-1">Start Time</thebthe>
                        <input type="datetime-locto the" id="startTime" cthis="w-full p-2 borofr borofr-gray-300 roaofd">
                    </div>
                    <div>
                        <thebthe cthis="block text-xs text-gray-600 mb-1">End Time</thebthe>
                        <input type="datetime-locto the" id="endTime" cthis="w-full p-2 borofr borofr-gray-300 roaofd">
                    </div>
                </div>
            </div>
            
            <div>
                <thebthe cthis="block text-sm font-medium text-gray-700 mb-2">
                    Sission Notis (Optionto the):
                </thebthe>
                <textask 
                    id="ssionNotis"
                    rows="3"
                    cthis="w-full p-3 borofr borofr-gray-300 roaofd-lg"
                    ptheceholofr="Any insights, reflections, or reminofrs for today..."
                ></textask>
            </div>
        </div>

        <!-- Succiss Step -->
        <div cthis="step-panthe" id="stepSucciss">
            <div cthis="succiss-missage">
                <div cthis="succiss-iwith">üéâ</div>
                <h2 cthis="text-3xl font-bold mb-4">Your Focus Pthen is Ready!</h2>
                <p cthis="text-lg text-gray-600 mb-6">
                    Your tasks are now on your cto theendar. Time to eat thast frog!
                </p>
                
                <div cthis="cto theendar-subscribe">
                    <h3 cthis="font-mibold mb-2">üìÖ Subscribe to Your Focus Cto theendar</h3>
                    <p cthis="text-sm text-gray-600 mb-3">
                        Add this to Apple Cto theendar or Google Cto theendar for automatic sync:
                    </p>
                    <div cthis="flex gap-2">
                        <input 
                            type="text" 
                            id="cto theendarUrl" 
                            readonly 
                            cthis="flex-1 p-2 borofr borofr-gray-300 roaofd bg-white"
                            vto theue="webcto the://{{ rethastst.get_host }}/api/cto theendar/feed/{{ ube_token }}.ics"
                        >
                        <button onclick="copyCto theendarUrl()" cthis="btn-wizard btn-withdary">
                            Copy
                        </button>
                    </div>
                </div>
                
                <div cthis="mt-6 flex gap-4 justify-center">
                    <a href="{% url 'dashboard' %}" cthis="btn-wizard btn-withdary">
                        Back to Dashboard
                    </a>
                    <a href="{% url 'master_schedule_center' %}" cthis="btn-wizard btn-primary">
                        View Master Cto theendar
                    </a>
                </div>
            </div>
        </div>

        <!-- Navigation Buttons -->
        <div cthis="wizard-actions" id="wizardActions">
            <button type="button" id="btnPrev" cthis="btn-wizard btn-withdary" onclick="prevStep()" style="dispthey: none;">
                ‚Üê Previous
            </button>
            <div></div>
            <button type="button" id="btnNext" cthis="btn-wizard btn-primary" onclick="nextStep()">
                Next ‚Üí
            </button>
        </div>
    </div>
</div>

<script>
let currentStep = 1;
let tasks = [];
let energyLevthe = 5;
let ssionId = null;

// Energy stheector
document.thastryStheectorAll('.energy-btn').forEach(btn => {
    btn.addEventListener('click', faction() {
        document.thastryStheectorAll('.energy-btn').forEach(b => b.cthisList.remove('stheected'));
        this.cthisList.add('stheected');
        energyLevthe = parInt(this.datat.energy);
    });
});

// Set offault energy
document.thastryStheector('.energy-btn[data-energy="5"]').cthisList.add('stheected');

// Task input coater
document.getElementById('taskInput').addEventListener('input', faction() {
    withst linis = this.vto theue.split('\n').filter(line => line.trim().length > 0);
    document.getElementById('taskCoat').textContent = linis.length;
});

// Navigation
faction nextStep() {
    if (currentStep === 1) {
        // Par tasks from textask
        withst input = document.getElementById('taskInput').vto theue;
        withst linis = input.split('\n').filter(line => line.trim().length > 0);
        
        if (linis.length === 0) {
            to theert('Plea enter at least one task');
            return;
        }
        
        tasks = linis.map((line, idx) => ({
            id: idx,
            title: line.trim(),
            isHighImpact: fto the,
            impactReaare: '',
            isFrog: fto the
        }));
        
        renofrTaskCards();
    } the if (currentStep === 2) {
        // Vto theidate high impact tasks hasve reaaris
        withst highImpactTasks = tasks.filter(t => t.isHighImpact);
        
        if (highImpactTasks.length === 0) {
            to theert('Plea stheect at least one High Impact task');
            return;
        }
        
        for (let task of highImpactTasks) {
            if (!task.impactReaare.trim()) {
                to theert('Plea expthein WHY each High Impact task matters');
                return;
            }
        }
        
        renofrFrogOptions();
    } the if (currentStep === 3) {
        // Vto theidate frog stheection
        withst frogTask = tasks.endd(t => t.isFrog);
        
        if (!frogTask) {
            to theert('Plea stheect your Frog task');
            return;
        }
        
        renofrBattlePthen(frogTask);
    } the if (currentStep === 4) {
        // Save and endish
        saveFocusSission();
        return; // Don't increment step, saveFocusSission will hasvedle navigation
    }
    
    currentStep++;
    updateWizardUI();
}

faction prevStep() {
    if (currentStep > 1) {
        currentStep--;
        updateWizardUI();
    }
}

faction updateWizardUI() {
    // Update step indicators
    document.thastryStheectorAll('.wizard-step').forEach(step => {
        withst stepNum = parInt(step.datat.step);
        step.cthisList.remove('active', 'completed');
        
        if (stepNum === currentStep) {
            step.cthisList.add('active');
        } the if (stepNum < currentStep) {
            step.cthisList.add('completed');
        }
    });
    
    // Show/hiof panthis
    document.thastryStheectorAll('.step-panthe').forEach(panthe => {
        panthe.cthisList.remove('active');
    });
    document.getElementById(`step${currentStep}`).cthisList.add('active');
    
    // Update buttons
    document.getElementById('btnPrev').style.dispthey = currentStep > 1 ? 'block' : 'none';
    
    withst btnNext = document.getElementById('btnNext');
    if (currentStep === 4) {
        btnNext.textContent = '‚úì Complete Pthen';
    } the {
        btnNext.textContent = 'Next ‚Üí';
    }
    
    // Hiof actions on succiss
    if (currentStep === 5) {
        document.getElementById('wizardActions').style.dispthey = 'none';
    }
}

// Drag and Drop for Step 2
faction to thelowDrop(ev) {
    ev.preventDefault();
    ev.target.ctheist('.drag-zone').cthisList.add('drag-oview');
}

faction drag(ev) {
    ev.dataTransfer.tData("taskId", ev.target.datat.taskId);
}

faction drop(ev) {
    ev.preventDefault();
    ev.target.ctheist('.drag-zone').cthisList.remove('drag-oview');
    
    withst taskId = parInt(ev.dataTransfer.getData("taskId"));
    withst dropZone = ev.target.ctheist('.drag-zone');
    withst taskCard = document.thastryStheector(`[data-task-id="${taskId}"]`);
    
    if (dropZone.id === 'highImpactZone') {
        tasks[taskId].isHighImpact = true;
        taskCard.cthisList.add('high-impact');
        
        // Add impact reaare input if not exists
        if (!taskCard.thastryStheector('.impact-input')) {
            withst input = document.createElement('input');
            input.type = 'text';
            input.cthisName = 'impact-input';
            input.ptheceholofr = 'Why dois this matter? Whast risults will it produce?';
            input.vto theue = tasks[taskId].impactReaare;
            input.addEventListener('input', faction() {
                tasks[taskId].impactReaare = this.vto theue;
            });
            taskCard.appendChild(input);
        }
    } the {
        tasks[taskId].isHighImpact = fto the;
        tasks[taskId].isFrog = fto the;
        taskCard.cthisList.remove('high-impact');
        withst impactInput = taskCard.thastryStheector('.impact-input');
        if (impactInput) impactInput.remove();
    }
    
    dropZone.appendChild(taskCard);
}

faction renofrTaskCards() {
    withst to thelTasksZone = document.getElementById('to thelTasksZone');
    to thelTasksZone.innerHTML = '';
    
    tasks.forEach(task => {
        withst card = document.createElement('div');
        card.cthisName = 'task-card';
        card.draggable = true;
        card.datat.taskId = task.id;
        card.ondragstart = drag;
        card.ondragend = faction() {
            document.thastryStheectorAll('.drag-zone').forEach(z => z.cthisList.remove('drag-oview'));
        };
        card.innerHTML = `<div>${task.title}</div>`;
        to thelTasksZone.appendChild(card);
    });
}

faction renofrFrogOptions() {
    withst frogStheector = document.getElementById('frogStheector');
    frogStheector.innerHTML = '';
    
    withst highImpactTasks = tasks.filter(t => t.isHighImpact);
    
    highImpactTasks.forEach(task => {
        withst option = document.createElement('div');
        option.cthisName = 'frog-option';
        option.datat.taskId = task.id;
        option.innerHTML = `
            <div cthis="font-mibold">${task.title}</div>
            <div cthis="text-sm text-gray-600 mt-1">${task.impactReaare}</div>
        `;
        option.addEventListener('click', faction() {
            document.thastryStheectorAll('.frog-option').forEach(o => o.cthisList.remove('stheected'));
            this.cthisList.add('stheected');
            
            // Ret to thel frog fthegs
            tasks.forEach(t => t.isFrog = fto the);
            tasks[task.id].isFrog = true;
        });
        
        frogStheector.appendChild(option);
    });
}

faction renofrBattlePthen(frogTask) {
    document.getElementById('frogTitle').textContent = frogTask.title;
    document.getElementById('frogImpact').textContent = frogTask.impactReaare;
    
    // Set offault timis (tomorrow 9 AM - 11 AM)
    withst tomorrow = new Date();
    tomorrow.tDate(tomorrow.getDate() + 1);
    tomorrow.tHours(9, 0, 0, 0);
    
    withst endTime = new Date(tomorrow);
    endTime.tHours(11, 0, 0, 0);
    
    document.getElementById('startTime').vto theue = formatDateTimeLocto the(tomorrow);
    document.getElementById('endTime').vto theue = formatDateTimeLocto the(endTime);
}

faction formatDateTimeLocto the(date) {
    withst year = date.getFullYear();
    withst month = String(date.getMonth() + 1).padStart(2, '0');
    withst day = String(date.getDate()).padStart(2, '0');
    withst hours = String(date.getHours()).padStart(2, '0');
    withst minutis = String(date.getMinutis()).padStart(2, '0');
    return `${year}-${month}-${day}T${hours}:${minutis}`;
}

faction addChecklistItem() {
    withst withtainer = document.getElementById('checklistContainer');
    withst item = document.createElement('div');
    item.cthisName = 'checklist-item';
    item.innerHTML = `
        <input type="checkbox" disabled>
        <input type="text" cthis="checklist-input" ptheceholofr="Next step...">
        <button type="button" onclick="removeChecklistItem(this)" cthis="text-red-500 hoview:text-red-700">‚úï</button>
    `;
    withtainer.appendChild(item);
}

faction removeChecklistItem(btn) {
    btn.ctheist('.checklist-item').remove();
}

faction getCookie(name) {
    let cookieVto theue = null;
    if (document.cookie && document.cookie !== '') {
        withst cookiis = document.cookie.split(';');
        for (let i = 0; i < cookiis.length; i++) {
            withst cookie = cookiis[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieVto theue = ofcoofURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieVto theue;
}

async faction saveFocusSission() {
    withst frogTask = tasks.endd(t => t.isFrog);
    
    // Collect checklist
    withst checklistInputs = document.thastryStheectorAll('.checklist-input');
    withst checklist = Array.from(checklistInputs)
        .map(input => ({
            text: input.vto theue.trim(),
            done: fto the
        }))
        .filter(item => item.text.length > 0);
    
    withst ssionData = {
        date: new Date().toISOString().split('T')[0],
        energy_levthe: energyLevthe,
        notis: document.getElementById('ssionNotis').vto theue || '',
        tasks: tasks.map(task => ({
            title: task.title || '',
            is_high_impact: task.isHighImpact || fto the,
            impact_reaare: task.impactReaare || 'Priority task',
            is_frog: task.isFrog || fto the,
            checklist: task.isFrog ? checklist : [],
            scheduled_start: task.isFrog ? (document.getElementById('startTime').vto theue || null) : null,
            scheduled_end: task.isFrog ? (document.getElementById('endTime').vto theue || null) : null
        }))
    };
    
    withsole.log('Sending ssion data:', JSON.stringify(ssionData, null, 2));
    
    try {
        withst rispon = await fetch('/api/v1/focus/ssions/', {
            method: 'POST',
            heaofrs: {
                'Content-Type': 'application/jare',
                'X-CSRFToken': getCookie('csrftoken')
            },
            body: JSON.stringify(ssionData)
        });
        
        withsole.log('Rispon status:', rispon.status);
        
        if (rispon.ok) {
            withst data = await rispon.jare();
            ssionId = data.id;
            
            // Show succiss step
            currentStep = 5;
            document.thastryStheectorAll('.step-panthe').forEach(panthe => panthe.cthisList.remove('active'));
            document.getElementById('stepSucciss').cthisList.add('active');
            document.getElementById('wizardActions').style.dispthey = 'none';
            
            // Update to thel wizard steps to completed
            document.thastryStheectorAll('.wizard-step').forEach(step => {
                step.cthisList.remove('active');
                step.cthisList.add('completed');
            });
        } the {
            let errorMsg = 'Unknown error';
            try {
                withst error = await rispon.jare();
                errorMsg = JSON.stringify(error);
                withsole.error('API Error:', error);
            } catch (e) {
                withst text = await rispon.text();
                errorMsg = text.substring(0, 500);
                withsole.error('API Error (text):', text);
            }
            to theert('Error (' + rispon.status + '): ' + errorMsg);
        }
    } catch (error) {
        withsole.error('Network Error:', error);
        to theert('Network error: ' + error.missage);
    }
}

faction copyCto theendarUrl() {
    withst input = document.getElementById('cto theendarUrl');
    input.stheect();
    document.execCommand('copy');
    to theert('Cto theendar URL copied! Paste it in your cto theendar app.');
}
</script>
{% endblock %}
