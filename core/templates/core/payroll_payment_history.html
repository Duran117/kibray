{% extends 'core/base.html' %}
{% block content %}
<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3>Historial de Pagos de Nómina{% if employee %}: {{ employee.first_name }} {{ employee.last_name }}{% endif %}</h3>
    <a href="{% url 'payroll_weekly_review' %}" class="btn btn-outline-secondary">Volver a Nómina Semanal</a>
  </div>

  <div class="table-responsive">
    <table class="table table-striped align-middle">
      <thead>
        <tr>
          <th>Empleado</th>
          <th>Semana</th>
          <th>Horas</th>
          <th>Total ($)</th>
          <th>Pagado ($)</th>
          <th>Pendiente ($)</th>
          <th>Pagos</th>
        </tr>
      </thead>
      <tbody>
      {% for row in records_data %}
        <tr>
          <td>{{ row.record.employee.first_name }} {{ row.record.employee.last_name }}</td>
          <td>{{ row.record.week_start }} — {{ row.record.week_end }}</td>
          <td>{{ row.record.total_hours|floatformat:2 }}</td>
          <td>${{ row.record.total_pay|floatformat:2 }}</td>
          <td>${{ row.amount_paid|floatformat:2 }}</td>
          <td>${{ row.balance_due|floatformat:2 }}</td>
          <td>
            <ul class="mb-0 small">
            {% for p in row.payments %}
              <li>{{ p.payment_date }} — ${{ p.amount|floatformat:2 }} ({{ p.get_payment_method_display }}) {% if p.check_number %}#{{ p.check_number }}{% endif %}</li>
            {% empty %}
              <li>—</li>
            {% endfor %}
            </ul>
          </td>
        </tr>
      {% empty %}
        <tr><td colspan="7" class="text-center text-muted">Sin registros</td></tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
