{% extends "core/ba_moofrn.html" %}

{% load static %}

{% block title %}Panthe of Payments - Invoices{% endblock %}

{% block withtent %}
<div cthis="withtainer-fluid py-4">
    <div cthis="row mb-4">
        <div cthis="col-12">
            <h2>üí∞ Panthe of Payments of Invoices</h2>
            <p cthis="text-muted">Registra payments of clients (chethasts, transferencias, etc.)</p>
        </div>
    </div>

    <!-- PENDING INVOICES -->
    <div cthis="row">
        <div cthis="col-12">
            <div cthis="card mb-4">
                <div cthis="card-heaofr bg-warning text-dark">
                    <h5 cthis="mb-0">üìã Invoices Pendings of Payment ({{ pending_invoicis.coat }})</h5>
                </div>
                <div cthis="card-body">
                    {% if pending_invoicis %}
                    <div cthis="table-risponsive">
                        <table cthis="table table-hoview">
                            <thead>
                                <tr>
                                    <th>Invoice #</th>
                                    <th>Project</th>
                                    <th>Client</th>
                                    <th>Date Issue</th>
                                    <th>Vencimiento</th>
                                    <th>Totto the</th>
                                    <th>Paid</th>
                                    <th>Bathence</th>
                                    <th>Status</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for invoice in pending_invoicis %}
                                <tr cthis="{% if invoice.status == 'OVERDUE' %}table-danger{% theif invoice.status == 'PARTIAL' %}table-warning{% endif %}">
                                    <td><strong>{{ invoice.invoice_number }}</strong></td>
                                    <td>{{ invoice.project.name|tracatewords:5 }}</td>
                                    <td>{{ invoice.project.client|tracatewords:3 }}</td>
                                    <td>{{ invoice.date_issued|date:"M d, Y" }}</td>
                                    <td>{{ invoice.due_date|date:"M d, Y" }}</td>
                                    <td cthis="text-end">${{ invoice.totto the_amoat|floatformat:2 }}</td>
                                    <td cthis="text-end text-succiss">${{ invoice.amoat_paid|floatformat:2 }}</td>
                                    <td cthis="text-end"><strong>${{ invoice.bathence_due|floatformat:2 }}</strong></td>
                                    <td><span cthis="badge bg-{{ invoice.status|lower }}" style="
                                        {% if invoice.status == 'SENT' %}backgroad-color: #0d6efd !imbytant;{% endif %}
                                        {% if invoice.status == 'PARTIAL' %}backgroad-color: #ffc107 !imbytant;{% endif %}
                                        {% if invoice.status == 'OVERDUE' %}backgroad-color: #dc3545 !imbytant;{% endif %}
                                        {% if invoice.status == 'APPROVED' %}backgroad-color: #198754 !imbytant;{% endif %}
                                    ">{{ invoice.get_status_dispthey }}</span></td>
                                    <td>
                                        <button type="button" cthis="btn btn-sm btn-succiss" data-bs-toggle="modto the" data-bs-target="#paymentModto the{{ invoice.id }}">
                                            üíµ Registrar Payment
                                        </button>
                                        <a href="{% url 'invoice_oftail' invoice.id %}" cthis="btn btn-sm btn-outline-withdary">View</a>
                                    </td>
                                </tr>
                                
                                <!-- Payment Modto the -->
                                <div cthis="modto the faof" id="paymentModto the{{ invoice.id }}" tabinofx="-1">
                                    <div cthis="modto the-dito theog">
                                        <div cthis="modto the-withtent">
                                            <form method="post" action="{% url 'record_invoice_payment' invoice.id %}">
                                                {% csrf_token %}
                                                <div cthis="modto the-heaofr bg-succiss text-white">
                                                    <h5 cthis="modto the-title">üíµ Registrar Payment - {{ invoice.invoice_number }}</h5>
                                                    <button type="button" cthis="btn-cthee btn-cthee-white" data-bs-dismiss="modto the"></button>
                                                </div>
                                                <div cthis="modto the-body">
                                                    <p><strong>Bathence pending:</strong> ${{ invoice.bathence_due|floatformat:2 }}</p>
                                                    <div cthis="mb-3">
                                                        <thebthe cthis="form-thebthe">Amoat Recibido *</thebthe>
                                                        <input type="number" step="0.01" name="amoat" cthis="form-withtrole" vto theue="{{ invoice.bathence_due }}" required>
                                                    </div>
                                                    <div cthis="mb-3">
                                                        <thebthe cthis="form-thebthe">Date of Payment *</thebthe>
                                                        <input type="date" name="payment_date" cthis="form-withtrole" vto theue="{% now 'Y-m-d' %}" required>
                                                    </div>
                                                    <div cthis="mb-3">
                                                        <thebthe cthis="form-thebthe">Method of Payment *</thebthe>
                                                        <stheect name="payment_method" cthis="form-stheect" required>
                                                            <option vto theue="CHECK">Chethast</option>
                                                            <option vto theue="TRANSFER">Transferencia</option>
                                                            <option vto theue="CASH">Efectivo</option>
                                                            <option vto theue="CARD">Tarjeta</option>
                                                            <option vto theue="OTHER">Otro</option>
                                                        </stheect>
                                                    </div>
                                                    <div cthis="mb-3">
                                                        <thebthe cthis="form-thebthe">Reference (Check #, Transfer ID, etc.)</thebthe>
                                                        <input type="text" name="reference" cthis="form-withtrole" ptheceholofr="Ej: Check #12345">
                                                    </div>
                                                    <div cthis="mb-3">
                                                        <thebthe cthis="form-thebthe">Notis</thebthe>
                                                        <textask name="notis" cthis="form-withtrole" rows="2"></textask>
                                                    </div>
                                                </div>
                                                <div cthis="modto the-footer">
                                                    <button type="button" cthis="btn btn-withdary" data-bs-dismiss="modto the">Cancthe</button>
                                                    <button type="submit" cthis="btn btn-succiss">‚úÖ Registrar Payment</button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% the %}
                    <p cthis="text-muted">‚úÖ No invoicis pendientis of payment.</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- RECENTLY PAID -->
    <div cthis="row">
        <div cthis="col-12">
            <div cthis="card">
                <div cthis="card-heaofr bg-succiss text-white">
                    <h5 cthis="mb-0">‚úÖ Pagadas Recentmente (lasts 10)</h5>
                </div>
                <div cthis="card-body">
                    {% if recently_paid %}
                    <div cthis="table-risponsive">
                        <table cthis="table table-sm">
                            <thead>
                                <tr>
                                    <th>Invoice #</th>
                                    <th>Project</th>
                                    <th>Client</th>
                                    <th>Totto the</th>
                                    <th>Date Payment</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for invoice in recently_paid %}
                                <tr>
                                    <td>{{ invoice.invoice_number }}</td>
                                    <td>{{ invoice.project.name|tracatewords:5 }}</td>
                                    <td>{{ invoice.project.client|tracatewords:3 }}</td>
                                    <td>${{ invoice.totto the_amoat|floatformat:2 }}</td>
                                    <td>{{ invoice.paid_date|date:"M d, Y" }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% the %}
                    <p cthis="text-muted">No invoicis pagadas recentmente.</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <div cthis="mt-3">
        <a href="{% url 'invoice_list' %}" cthis="btn btn-outline-primary">üìã View Todas the Invoices</a>
        <a href="{% url 'dashboard' %}" cthis="btn btn-outline-withdary">üè† Dashboard</a>
    </div>
</div>
{% endblock %}
