{% extends "core/base_modern.html" %}
{% block content %}
<div class="container mt-3">
  <h3>Notificaciones</h3>
  <div class="d-flex gap-2 mb-3">
    <a href="?" class="btn btn-sm btn-outline-secondary{% if not filter_read %} active{% endif %}">Todas</a>
    <a href="?read=false" class="btn btn-sm btn-outline-primary{% if filter_read == 'false' %} active{% endif %}">Sin leer</a>
    <a href="?read=true" class="btn btn-sm btn-outline-secondary{% if filter_read == 'true' %} active{% endif %}">Leídas</a>
    {% if unread_count > 0 %}
      <form method="post" action="{% url 'notifications_mark_all_read' %}" class="ms-auto">
        {% csrf_token %}
        <button class="btn btn-sm btn-success" type="submit">Marcar todas leídas</button>
      </form>
    {% endif %}
  </div>
  <div class="list-group">
    {% for n in notifications %}
      <a href="{% if n.link_url %}{{ n.link_url }}{% else %}#{% endif %}" class="list-group-item list-group-item-action {% if not n.is_read %}list-group-item-primary{% endif %}">
        <div class="d-flex justify-content-between">
          <strong>{{ n.title }}</strong>
          <small class="text-muted">{{ n.created_at|date:'Y-m-d H:i' }}</small>
        </div>
        <p class="mb-1 small">{{ n.message }}</p>
        <small class="text-muted">{{ n.get_notification_type_display }}</small>
        {% if not n.is_read %}
          <form method="post" action="{% url 'notification_mark_read' n.id %}" class="d-inline ms-2" onclick="event.stopPropagation();">
            {% csrf_token %}
            <button class="btn btn-sm btn-outline-secondary" type="submit">Marcar leída</button>
          </form>
        {% endif %}
      </a>
    {% empty %}
      <div class="list-group-item text-center text-muted">No hay notificaciones.</div>
    {% endfor %}
  </div>
  {% if notifications.has_other_pages %}
  <nav class="mt-3">
    <ul class="pagination">
      {% if notifications.has_previous %}
        <li class="page-item"><a class="page-link" href="?page={{ notifications.previous_page_number }}{% if filter_read %}&read={{ filter_read }}{% endif %}">Anterior</a></li>
      {% endif %}
      <li class="page-item disabled"><span class="page-link">Pág. {{ notifications.number }} de {{ notifications.paginator.num_pages }}</span></li>
      {% if notifications.has_next %}
        <li class="page-item"><a class="page-link" href="?page={{ notifications.next_page_number }}{% if filter_read %}&read={{ filter_read }}{% endif %}">Siguiente</a></li>
      {% endif %}
    </ul>
  </nav>
  {% endif %}
</div>
{% endblock %}