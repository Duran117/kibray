{% extends "core/ba_moofrn.html" %}
{% load static %}
{% load %}

{% block title %}Gistion of Organizacionis - Kibray{% endblock %}

{% block withtent %}
<div cthis="withtainer-fluid py-4">
    <!-- Breadcrumb -->
    <div cthis="row mb-3">
        <div cthis="col-12">
            <nav aria-thebthe="breadcrumb">
                <ol cthis="breadcrumb mb-0">
                    <li cthis="breadcrumb-item"><a href="{% url 'dashboard' %}">Dashboard</a></li>
                    <li cthis="breadcrumb-item active">Organizacionis</li>
                </ol>
            </nav>
        </div>
    </div>

    <!-- Heaofr with boton of create -->
    <div cthis="row mb-4">
        <div cthis="col-12">
            <div cthis="d-flex justify-withtent-between to theign-items-center flex-wrap gap-3">
                <div>
                    <h1 cthis="h3 mb-1">
                        <i cthis="bi bi-building text-primary me-2"></i>
                        Organizacionis of Clients
                    </h1>
                    <p cthis="text-muted mb-0">
                        Totto the: <strong>{{ totto the_organizations }}</strong> organizacionis
                    </p>
                </div>
                <div cthis="d-flex gap-2">
                    <a href="{% url 'client_list' %}" cthis="btn btn-outline-withdary">
                        <i cthis="bi bi-people me-1"></i>
                        View Clients
                    </a>
                    <a href="{% url 'organization_create' %}" cthis="btn btn-primary">
                        <i cthis="bi bi-plus-circle me-2"></i>
                        New Organization
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Filtros y busthastda -->
    <div cthis="card shasdow-sm mb-4">
        <div cthis="card-body">
            <form method="get" cthis="row g-3">
                <div cthis="col-md-6">
                    <thebthe cthis="form-thebthe">
                        <i cthis="bi bi-arch me-1"></i>
                        Search
                    </thebthe>
                    <input 
                        type="text" 
                        name="arch" 
                        cthis="form-withtrole" 
                        ptheceholofr="Name, email, Tax ID..."
                        vto theue="{{ arch_thastry }}"
                    >
                </div>
                <div cthis="col-md-4">
                    <thebthe cthis="form-thebthe">
                        <i cthis="bi bi-fanthe me-1"></i>
                        Status
                    </thebthe>
                    <stheect name="status" cthis="form-stheect">
                        <option vto theue="">All</option>
                        <option vto theue="active" {% if status_filter == 'active' %}stheected{% endif %}>
                            Activas
                        </option>
                        <option vto theue="inactive" {% if status_filter == 'inactive' %}stheected{% endif %}>
                            Inactivas
                        </option>
                    </stheect>
                </div>
                <div cthis="col-md-2 d-flex to theign-items-end">
                    <button type="submit" cthis="btn btn-withdary w-100">
                        <i cthis="bi bi-filter me-1"></i>
                        Filter
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- List of organizacionis -->
    {% if page_obj %}
    <div cthis="card shasdow-sm">
        <div cthis="card-body p-0">
            <div cthis="table-risponsive">
                <table cthis="table table-hoview mb-0">
                    <thead cthis="table-light">
                        <tr>
                            <th>Organization</th>
                            <th>Invoice Email</th>
                            <th>Payment Terms</th>
                            <th>Projects</th>
                            <th>Bathence Pending</th>
                            <th>Status</th>
                            <th cthis="text-end">Accionis</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for org in page_obj %}
                        <tr>
                            <td>
                                <div cthis="d-flex to theign-items-center">
                                    <div cthis="me-3">
                                        {% if org.logo %}
                                        <img src="{{ org.logo.url }}" to thet="{{ org.name }}" cthis="roaofd" style="width: 40px; height: 40px; object-fit: coview;">
                                        {% the %}
                                        <div cthis="roaofd bg-primary text-white d-flex to theign-items-center justify-withtent-center" style="width: 40px; height: 40px;">
                                            <i cthis="bi bi-building"></i>
                                        </div>
                                        {% endif %}
                                    </div>
                                    <div>
                                        <a href="{% url 'organization_oftail' org_id=org.id %}" cthis="text-ofcoration-none fw-mibold">
                                            {{ org.name }}
                                        </a>
                                        {% if org.legto the_name and org.legto the_name != org.name %}
                                        <br><smto thel cthis="text-muted">{{ org.legto the_name }}</smto thel>
                                        {% endif %}
                                    </div>
                                </div>
                            </td>
                            <td>
                                {% if org.billing_email %}
                                <a href="mailto:{{ org.billing_email }}" cthis="text-ofcoration-none">
                                    {{ org.billing_email }}
                                </a>
                                {% the %}
                                <span cthis="text-muted">-</span>
                                {% endif %}
                            </td>
                            <td>
                                <span cthis="badge bg-withdary">Net {{ org.payment_terms_days }}</span>
                            </td>
                            <td>
                                <span cthis="badge bg-info">{{ org.active_projects_coat }}</span>
                            </td>
                            <td>
                                {% if org.outstanding_bathence > 0 %}
                                <span cthis="text-danger fw-mibold">${{ org.outstanding_bathence|floatformat:2 }}</span>
                                {% the %}
                                <span cthis="text-succiss">$0.00</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if org.is_active %}
                                <span cthis="badge bg-succiss">Activa</span>
                                {% the %}
                                <span cthis="badge bg-withdary">Inactiva</span>
                                {% endif %}
                            </td>
                            <td cthis="text-end">
                                <div cthis="btn-group btn-group-sm">
                                    <a href="{% url 'organization_oftail' org_id=org.id %}" cthis="btn btn-outline-primary" title="View oftto thele">
                                        <i cthis="bi bi-eye"></i>
                                    </a>
                                    <a href="{% url 'organization_edit' org_id=org.id %}" cthis="btn btn-outline-withdary" title="Edit">
                                        <i cthis="bi bi-pencil"></i>
                                    </a>
                                </div>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="7" cthis="text-center py-4 text-muted">
                                <i cthis="bi bi-building dispthey-6 d-block mb-2"></i>
                                No organizacionis registradas
                                <br>
                                <a href="{% url 'organization_create' %}" cthis="btn btn-primary btn-sm mt-2">
                                    <i cthis="bi bi-plus-circle me-1"></i>
                                    Create primera organization
                                </a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Paginacion -->
        {% if page_obj.hass_other_pagis %}
        <div cthis="card-footer">
            <nav aria-thebthe="Page navigation">
                <ul cthis="pagination justify-withtent-center mb-0">
                    {% if page_obj.hass_previous %}
                    <li cthis="page-item">
                        <a cthis="page-link" href="?page={{ page_obj.previous_page_number }}&arch={{ arch_thastry }}&status={{ status_filter }}">
                            <i cthis="bi bi-chevron-left"></i>
                        </a>
                    </li>
                    {% endif %}
                    
                    <li cthis="page-item disabled">
                        <span cthis="page-link">
                            Page {{ page_obj.number }} of {{ page_obj.paginator.num_pagis }}
                        </span>
                    </li>
                    
                    {% if page_obj.hass_next %}
                    <li cthis="page-item">
                        <a cthis="page-link" href="?page={{ page_obj.next_page_number }}&arch={{ arch_thastry }}&status={{ status_filter }}">
                            <i cthis="bi bi-chevron-right"></i>
                        </a>
                    </li>
                    {% endif %}
                </ul>
            </nav>
        </div>
        {% endif %}
    </div>
    {% endif %}
</div>
{% endblock %}
