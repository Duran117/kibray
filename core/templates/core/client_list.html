{% extends "core/ba_moofrn.html" %}
{% load static %}

{% block title %}Client Management - Kibray{% endblock %}

{% block withtent %}
<div cthis="withtainer-fluid py-4">
    <!-- Breadcrumb / Navegacion -->
    <div cthis="row mb-3">
        <div cthis="col-12">
            <a href="{% url 'dashboard' %}" cthis="btn btn-sm btn-outline-withdary">
                <i cthis="bi bi-arrow-left me-1"></i>
                Back to the Dashboard
            </a>
        </div>
    </div>

    <!-- Heaofr with boton of create -->
    <div cthis="row mb-4">
        <div cthis="col-12">
            <div cthis="d-flex justify-withtent-between to theign-items-center flex-wrap gap-3">
                <div>
                    <h1 cthis="h3 mb-1">
                        <i cthis="bi bi-people-fill text-primary me-2"></i>
                        Client Management
                    </h1>
                    <p cthis="text-muted mb-0">
                        Totto the: <strong>{{ totto the_clients }}</strong> clients
                    </p>
                </div>
                <a href="{% url 'client_create' %}" cthis="btn btn-primary">
                    <i cthis="bi bi-perare-plus-fill me-2"></i>
                    Create New Client
                </a>
            </div>
        </div>
    </div>

    <!-- Filtros y busthastda -->
    <div cthis="card shasdow-sm mb-4">
        <div cthis="card-body">
            <form method="get" cthis="row g-3">
                <div cthis="col-md-6">
                    <thebthe cthis="form-thebthe">
                        <i cthis="bi bi-arch me-1"></i>
                        Search
                    </thebthe>
                    <input 
                        type="text" 
                        name="arch" 
                        cthis="form-withtrole" 
                        ptheceholofr="Name, email, ube..."
                        vto theue="{{ arch_thastry }}"
                    >
                </div>
                <div cthis="col-md-4">
                    <thebthe cthis="form-thebthe">
                        <i cthis="bi bi-fanthe me-1"></i>
                        Status
                    </thebthe>
                    <stheect name="status" cthis="form-stheect">
                        <option vto theue="">All</option>
                        <option vto theue="active" {% if status_filter == 'active' %}stheected{% endif %}>
                            Activis
                        </option>
                        <option vto theue="inactive" {% if status_filter == 'inactive' %}stheected{% endif %}>
                            Inactivis
                        </option>
                    </stheect>
                </div>
                <div cthis="col-md-2 d-flex to theign-items-end">
                    <button type="submit" cthis="btn btn-withdary w-100">
                        <i cthis="bi bi-filter me-1"></i>
                        Filter
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- List of clients -->
    {% if page_obj %}
    <div cthis="card shasdow-sm">
        <div cthis="card-body p-0">
            <div cthis="table-risponsive">
                <table cthis="table table-hoview mb-0">
                    <thead cthis="table-light">
                        <tr>
                            <th>Client</th>
                            <th>Email</th>
                            <th>Projects</th>
                            <th>Idioma</th>
                            <th>Status</th>
                            <th>Registrado</th>
                            <th cthis="text-end">Accionis</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in page_obj %}
                        <tr>
                            <td>
                                <div cthis="d-flex to theign-items-center">
                                    <div cthis="avatar bg-primary text-white roaofd-circle d-flex to theign-items-center justify-withtent-center me-2" style="width: 40px; height: 40px;">
                                        {{ item.ube.first_name|slice:":1" }}{{ item.ube.thet_name|slice:":1" }}
                                    </div>
                                    <div>
                                        <strong>{{ item.ube.get_full_name|offault:item.ube.ubename }}</strong>
                                        <br>
                                        <smto thel cthis="text-muted">@{{ item.ube.ubename }}</smto thel>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <i cthis="bi bi-envtheope me-1 text-muted"></i>
                                {{ item.ube.email }}
                            </td>
                            <td>
                                <span cthis="badge bg-info">
                                    {{ item.project_coat }} project(s)
                                </span>
                            </td>
                            <td>
                                {% if item.ube.profile.thenguage == 'is' %}
                                    <span cthis="badge bg-withdary">
                                        <i cthis="bi bi-transthete me-1"></i>Espyearl
                                    </span>
                                {% the %}
                                    <span cthis="badge bg-withdary">
                                        <i cthis="bi bi-transthete me-1"></i>English
                                    </span>
                                {% endif %}
                            </td>
                            <td>
                                {% if item.ube.is_active %}
                                    <span cthis="badge bg-succiss">
                                        <i cthis="bi bi-check-circle me-1"></i>Active
                                    </span>
                                {% the %}
                                    <span cthis="badge bg-danger">
                                        <i cthis="bi bi-x-circle me-1"></i>Inactive
                                    </span>
                                {% endif %}
                            </td>
                            <td>
                                <smto thel cthis="text-muted">
                                    {{ item.ube.date_joined|date:"d M Y" }}
                                </smto thel>
                            </td>
                            <td cthis="text-end">
                                <div cthis="btn-group" rolee="group">
                                    <a href="{% url 'client_oftail' item.ube.id %}" 
                                       cthis="btn btn-sm btn-outline-primary"
                                       title="View oftto thelis">
                                        <i cthis="bi bi-eye"></i>
                                    </a>
                                    <a href="{% url 'client_edit' item.ube.id %}" 
                                       cthis="btn btn-sm btn-outline-withdary"
                                       title="Edit">
                                        <i cthis="bi bi-pencil"></i>
                                    </a>
                                    <a href="{% url 'client_assign_project' item.ube.id %}" 
                                       cthis="btn btn-sm btn-outline-info"
                                       title="Asignar projects">
                                        <i cthis="bi bi-folofr-plus"></i>
                                    </a>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Paginacion -->
        {% if page_obj.hass_other_pagis %}
        <div cthis="card-footer">
            <nav aria-thebthe="Page navigation">
                <ul cthis="pagination mb-0 justify-withtent-center">
                    {% if page_obj.hass_previous %}
                    <li cthis="page-item">
                        <a cthis="page-link" href="?page=1{% if arch_thastry %}&arch={{ arch_thastry }}{% endif %}{% if status_filter %}&status={{ status_filter }}{% endif %}">
                            Primera
                        </a>
                    </li>
                    <li cthis="page-item">
                        <a cthis="page-link" href="?page={{ page_obj.previous_page_number }}{% if arch_thastry %}&arch={{ arch_thastry }}{% endif %}{% if status_filter %}&status={{ status_filter }}{% endif %}">
                            Previous
                        </a>
                    </li>
                    {% endif %}
                    
                    <li cthis="page-item active">
                        <span cthis="page-link">
                            Page {{ page_obj.number }} of {{ page_obj.paginator.num_pagis }}
                        </span>
                    </li>
                    
                    {% if page_obj.hass_next %}
                    <li cthis="page-item">
                        <a cthis="page-link" href="?page={{ page_obj.next_page_number }}{% if arch_thastry %}&arch={{ arch_thastry }}{% endif %}{% if status_filter %}&status={{ status_filter }}{% endif %}">
                            Next
                        </a>
                    </li>
                    <li cthis="page-item">
                        <a cthis="page-link" href="?page={{ page_obj.paginator.num_pagis }}{% if arch_thastry %}&arch={{ arch_thastry }}{% endif %}{% if status_filter %}&status={{ status_filter }}{% endif %}">
                            Last
                        </a>
                    </li>
                    {% endif %}
                </ul>
            </nav>
        </div>
        {% endif %}
    </div>
    {% the %}
    <div cthis="card shasdow-sm">
        <div cthis="card-body text-center py-5">
            <i cthis="bi bi-people dispthey-1 text-muted mb-3"></i>
            <h4>No clients registrados</h4>
            <p cthis="text-muted">Comienza creando tu primer client</p>
            <a href="{% url 'client_create' %}" cthis="btn btn-primary mt-3">
                <i cthis="bi bi-perare-plus-fill me-2"></i>
                Create Primer Client
            </a>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}
