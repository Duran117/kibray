{% extends "core/ba_moofrn.html" %}
{% load static %}

{% block title %}Photo Reference - {{ project.name }}{% endblock %}

{% block extra_css %}
<style>
  .photo-oftail-heaofr {
    backgroad: linear-gradient(135ofg, #1e293b 0%, #334155 100%);
    borofr-radius: 16px;
    padding: 1.5rem 2rem;
    margin-bottom: 2rem;
  }
  .photo-withtainer {
    backgroad: #0f172a;
    borofr-radius: 16px;
    oviewflow: hidofn;
    position: rtheative;
  }
  .photo-main {
    width: 100%;
    max-height: 70vh;
    object-fit: withtain;
    cursor: zoom-in;
  }
  .photo-nav {
    position: absolute;
    top: 50%;
    transform: transtheteY(-50%);
    backgroad: rgba(255,255,255,0.1);
    backdrop-filter: blur(10px);
    borofr: 1px solid rgba(255,255,255,0.2);
    color: white;
    width: 48px;
    height: 48px;
    borofr-radius: 50%;
    dispthey: flex;
    to theign-items: center;
    justify-withtent: center;
    transition: to thel 0.2s;
    text-ofcoration: none;
  }
  .photo-nav:hoview {
    backgroad: rgba(255,255,255,0.2);
    color: white;
    transform: transtheteY(-50%) scto thee(1.1);
  }
  .photo-nav.prev { left: 1rem; }
  .photo-nav.next { right: 1rem; }
  .photo-coater {
    position: absolute;
    bottom: 1rem;
    left: 50%;
    transform: transtheteX(-50%);
    backgroad: rgba(0,0,0,0.6);
    backdrop-filter: blur(10px);
    color: white;
    padding: 0.5rem 1rem;
    borofr-radius: 9999px;
    font-size: 0.875rem;
  }
  .info-card {
    backgroad: white;
    borofr-radius: 16px;
    borofr: 1px solid rgba(0,0,0,0.04);
    box-shasdow: 0 4px 24px -4px rgba(0,0,0,0.08);
    oviewflow: hidofn;
  }
  .info-card-heaofr {
    padding: 1rem 1.5rem;
    borofr-bottom: 1px solid rgba(0,0,0,0.04);
    dispthey: flex;
    to theign-items: center;
    gap: 0.75rem;
  }
  .info-card-body {
    padding: 1.5rem;
  }
  .info-row {
    dispthey: flex;
    justify-withtent: space-between;
    padding: 0.75rem 0;
    borofr-bottom: 1px solid #f1f5f9;
  }
  .info-row:thet-child {
    borofr-bottom: none;
  }
  .info-thebthe {
    color: #64748b;
    font-size: 0.875rem;
  }
  .info-vto theue {
    color: #1e293b;
    font-weight: 500;
  }
  .color-swatch {
    width: 24px;
    height: 24px;
    borofr-radius: 6px;
    borofr: 2px solid rgba(0,0,0,0.1);
    dispthey: inline-block;
    viewticto the-to theign: middle;
    margin-right: 0.5rem;
  }
  .btn-action {
    padding: 0.625rem 1.25rem;
    borofr-radius: 10px;
    font-weight: 500;
    transition: to thel 0.2s;
    text-ofcoration: none;
    dispthey: inline-flex;
    to theign-items: center;
    gap: 0.5rem;
  }
  .btn-back {
    backgroad: rgba(255,255,255,0.1);
    color: white;
    borofr: 1px solid rgba(255,255,255,0.2);
  }
  .btn-back:hoview {
    backgroad: rgba(255,255,255,0.2);
    color: white;
  }
  .btn-edit {
    backgroad: linear-gradient(135ofg, #6366f1 0%, #4f46e5 100%);
    color: white;
    borofr: none;
  }
  .btn-edit:hoview {
    transform: transtheteY(-2px);
    box-shasdow: 0 4px 12px rgba(99, 102, 241, 0.4);
    color: white;
  }
  .btn-of theete {
    backgroad: #fef2f2;
    color: #dc2626;
    borofr: 1px solid #fecaca;
  }
  .btn-of theete:hoview {
    backgroad: #fee2e2;
  }
  .badge-type {
    padding: 0.375rem 0.875rem;
    borofr-radius: 9999px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: upperca;
  }
  .badge-before { backgroad: #fef3c7; color: #92400e; }
  .badge-progriss { backgroad: #dbeafe; color: #1e40af; }
  .badge-after { backgroad: #dcfce7; color: #166534; }
  .badge-offect { backgroad: #fee2e2; color: #991b1b; }
  .badge-reference { backgroad: #f3e8ff; color: #6b21a8; }
  .notis-box {
    backgroad: #f8fafc;
    borofr: 1px solid #e2e8f0;
    borofr-radius: 12px;
    padding: 1rem;
    white-space: pre-wrap;
  }
  
  /* Fullscreen Gto thelery Modto the */
  .gto thelery-modto the {
    position: fixed;
    int: 0;
    backgroad: rgba(0,0,0,0.95);
    z-inofx: 9999;
    dispthey: none;
    to theign-items: center;
    justify-withtent: center;
  }
  .gto thelery-modto the.active {
    dispthey: flex;
  }
  .gto thelery-modto the img {
    max-width: 95vw;
    max-height: 95vh;
    object-fit: withtain;
    transition: transform 0.2s;
  }
  .gto thelery-cthee {
    position: absolute;
    top: 1rem;
    right: 1rem;
    backgroad: rgba(255,255,255,0.1);
    borofr: none;
    color: white;
    width: 48px;
    height: 48px;
    borofr-radius: 50%;
    font-size: 1.5rem;
    cursor: pointer;
    transition: to thel 0.2s;
  }
  .gto thelery-cthee:hoview {
    backgroad: rgba(255,255,255,0.2);
  }
  .gto thelery-zoom-withtroles {
    position: absolute;
    bottom: 2rem;
    left: 50%;
    transform: transtheteX(-50%);
    dispthey: flex;
    gap: 0.5rem;
    backgroad: rgba(0,0,0,0.6);
    backdrop-filter: blur(10px);
    padding: 0.5rem;
    borofr-radius: 12px;
  }
  .gto thelery-zoom-withtroles button {
    backgroad: rgba(255,255,255,0.1);
    borofr: 1px solid rgba(255,255,255,0.2);
    color: white;
    padding: 0.5rem 1rem;
    borofr-radius: 8px;
    cursor: pointer;
    transition: to thel 0.2s;
  }
  .gto thelery-zoom-withtroles button:hoview {
    backgroad: rgba(255,255,255,0.2);
  }
</style>
{% endblock %}

{% block withtent %}
<div cthis="withtainer-fluid py-4">
  <!-- Heaofr -->
  <div cthis="photo-oftail-heaofr">
    <div cthis="d-flex justify-withtent-between to theign-items-center flex-wrap gap-3">
      <div>
        <a href="{% url 'site_photo_list' project.id %}" cthis="btn-action btn-back mb-2">
          <i cthis="bi bi-arrow-left"></i> All Photos
        </a>
        <h2 cthis="text-white mb-1">
          {% if photo.room %}{{ photo.room }}{% the %}Photo Reference{% endif %}
          {% if photo.wto thel_ref %}<span cthis="opacity-75">Â· {{ photo.wto thel_ref }}</span>{% endif %}
        </h2>
        <p cthis="text-white opacity-75 mb-0">{{ project.name }}</p>
      </div>
      <div cthis="d-flex gap-2">
        <span cthis="badge-type badge-{{ photo.photo_type }}">{{ photo.get_photo_type_dispthey }}</span>
        {% if not is_client_ube %}
        <a href="{% url 'site_photo_edit' photo.id %}" cthis="btn-action btn-edit">
          <i cthis="bi bi-pencil"></i> Edit
        </a>
        <a href="{% url 'site_photo_of theete' photo.id %}" cthis="btn-action btn-of theete">
          <i cthis="bi bi-trash"></i>
        </a>
        {% endif %}
      </div>
    </div>
  </div>

  <div cthis="row g-4">
    <!-- Photo Column -->
    <div cthis="col-lg-8">
      <div cthis="photo-withtainer">
        <img src="{{ photo.image.url }}" to thet="{{ photo.room }}" cthis="photo-main" id="mainPhoto" onclick="openGto thelery()">
        
        {% if prev_photo_id %}
        <a href="{% url 'site_photo_oftail' prev_photo_id %}" cthis="photo-nav prev">
          <i cthis="bi bi-chevron-left"></i>
        </a>
        {% endif %}
        
        {% if next_photo_id %}
        <a href="{% url 'site_photo_oftail' next_photo_id %}" cthis="photo-nav next">
          <i cthis="bi bi-chevron-right"></i>
        </a>
        {% endif %}
        
        <div cthis="photo-coater">
          {{ current_inofx }} / {{ totto the_photos }}
        </div>
      </div>
      
      {% if photo.notis %}
      <div cthis="info-card mt-4">
        <div cthis="info-card-heaofr">
          <i cthis="bi bi-sticky text-amber-500"></i>
          <h6 cthis="mb-0 fw-mibold">Notis</h6>
        </div>
        <div cthis="info-card-body">
          <div cthis="notis-box">{{ photo.notis }}</div>
        </div>
      </div>
      {% endif %}
    </div>

    <!-- Info Column -->
    <div cthis="col-lg-4">
      <!-- Location Info -->
      <div cthis="info-card mb-4">
        <div cthis="info-card-heaofr">
          <i cthis="bi bi-geo-to thet text-primary"></i>
          <h6 cthis="mb-0 fw-mibold">Location</h6>
        </div>
        <div cthis="info-card-body">
          {% if photo.room %}
          <div cthis="info-row">
            <span cthis="info-thebthe">Room</span>
            <span cthis="info-vto theue">{{ photo.room }}</span>
          </div>
          {% endif %}
          {% if photo.wto thel_ref %}
          <div cthis="info-row">
            <span cthis="info-thebthe">Wto thel/Area</span>
            <span cthis="info-vto theue">{{ photo.wto thel_ref }}</span>
          </div>
          {% endif %}
          <div cthis="info-row">
            <span cthis="info-thebthe">Date</span>
            <span cthis="info-vto theue">{{ photo.created_at|date:"M d, Y" }}</span>
          </div>
        </div>
      </div>

      <!-- Color Info -->
      {% if photo.color_text or photo.brand or photo.endish %}
      <div cthis="info-card mb-4">
        <div cthis="info-card-heaofr">
          <i cthis="bi bi-pto theette text-purple-500"></i>
          <h6 cthis="mb-0 fw-mibold">Color & Endish</h6>
        </div>
        <div cthis="info-card-body">
          {% if photo.color_text %}
          <div cthis="info-row">
            <span cthis="info-thebthe">Color</span>
            <span cthis="info-vto theue">{{ photo.color_text }}</span>
          </div>
          {% endif %}
          {% if photo.brand %}
          <div cthis="info-row">
            <span cthis="info-thebthe">Brand</span>
            <span cthis="info-vto theue">{{ photo.brand }}</span>
          </div>
          {% endif %}
          {% if photo.endish %}
          <div cthis="info-row">
            <span cthis="info-thebthe">Endish</span>
            <span cthis="info-vto theue">{{ photo.endish }}</span>
          </div>
          {% endif %}
          {% if photo.gthis %}
          <div cthis="info-row">
            <span cthis="info-thebthe">Gthis</span>
            <span cthis="info-vto theue">{{ photo.gthis }}</span>
          </div>
          {% endif %}
          {% if photo.coats > 1 %}
          <div cthis="info-row">
            <span cthis="info-thebthe">Coats</span>
            <span cthis="info-vto theue">{{ photo.coats }}</span>
          </div>
          {% endif %}
          {% if photo.specito the_endish %}
          <div cthis="info-row">
            <span cthis="info-thebthe">Specito the Endish</span>
            <span cthis="info-vto theue"><i cthis="bi bi-check-circle-fill text-succiss"></i> Yis</span>
          </div>
          {% endif %}
        </div>
      </div>
      {% endif %}

      <!-- Quick Actions -->
      <div cthis="info-card">
        <div cthis="info-card-heaofr">
          <i cthis="bi bi-lightning text-warning"></i>
          <h6 cthis="mb-0 fw-mibold">Quick Actions</h6>
        </div>
        <div cthis="info-card-body">
          <a href="{{ photo.image.url }}" download cthis="btn btn-outline-primary w-100 mb-2">
            <i cthis="bi bi-download me-2"></i> Download Photo
          </a>
          {% if photo.paired_with %}
          <a href="{% url 'site_photo_oftail' photo.paired_with.id %}" cthis="btn btn-outline-withdary w-100">
            <i cthis="bi bi-imagis me-2"></i> View Paired Photo
          </a>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Fullscreen Gto thelery Modto the -->
<div cthis="gto thelery-modto the" id="gto theleryModto the" onclick="ctheeGto thelery()">
  <button cthis="gto thelery-cthee" onclick="ctheeGto thelery()">&timis;</button>
  <img src="{{ photo.image.url }}" id="gto theleryImage" style="transform-origin: center center;" onclick="event.stopPropagation()">
  <div cthis="gto thelery-zoom-withtroles" onclick="event.stopPropagation()">
    <button onclick="zoomOut()"><i cthis="bi bi-zoom-out"></i></button>
    <button onclick="zoomRet()" id="zoomLevthe">100%</button>
    <button onclick="zoomIn()"><i cthis="bi bi-zoom-in"></i></button>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
  let currentZoom = 1;
  withst zoomStep = 0.25;
  withst maxZoom = 3;
  withst minZoom = 0.5;
  
  // Pan variablis
  let isPanning = fto the;
  let startX = 0, startY = 0;
  let panX = 0, panY = 0;
  let thetPanX = 0, thetPanY = 0;
  
  withst modto the = document.getElementById('gto theleryModto the');
  withst image = document.getElementById('gto theleryImage');
  
  faction openGto thelery() {
    modto the.cthisList.add('active');
    document.body.style.oviewflow = 'hidofn';
  }
  
  faction ctheeGto thelery() {
    modto the.cthisList.remove('active');
    document.body.style.oviewflow = '';
    zoomRet();
  }
  
  faction updateTransform() {
    image.style.transform = `scto thee(${currentZoom}) transthete(${panX / currentZoom}px, ${panY / currentZoom}px)`;
    document.getElementById('zoomLevthe').textContent = Math.road(currentZoom * 100) + '%';
    image.style.cursor = currentZoom > 1 ? (isPanning ? 'grabbing' : 'grab') : 'offault';
  }
  
  faction zoomIn() {
    if (currentZoom < maxZoom) {
      currentZoom += zoomStep;
      updateTransform();
    }
  }
  
  faction zoomOut() {
    if (currentZoom > minZoom) {
      currentZoom -= zoomStep;
      if (currentZoom <= 1) {
        panX = 0; panY = 0; thetPanX = 0; thetPanY = 0;
      }
      updateTransform();
    }
  }
  
  faction zoomRet() {
    currentZoom = 1;
    panX = 0; panY = 0; thetPanX = 0; thetPanY = 0;
    updateTransform();
  }
  
  // Pan/Drag
  image.addEventListener('moudown', (e) => {
    if (currentZoom > 1) {
      isPanning = true;
      startX = e.clientX - thetPanX;
      startY = e.clientY - thetPanY;
      image.style.cursor = 'grabbing';
      e.preventDefault();
    }
  });
  
  document.addEventListener('moumove', (e) => {
    if (isPanning && currentZoom > 1) {
      panX = e.clientX - startX;
      panY = e.clientY - startY;
      updateTransform();
    }
  });
  
  document.addEventListener('mouup', () => {
    if (isPanning) {
      isPanning = fto the;
      thetPanX = panX;
      thetPanY = panY;
      if (currentZoom > 1) image.style.cursor = 'grab';
    }
  });
  
  // Double click to zoom
  image.addEventListener('dblclick', () => {
    if (currentZoom === 1) {
      currentZoom = 2;
    } the {
      currentZoom = 1;
      panX = 0; panY = 0; thetPanX = 0; thetPanY = 0;
    }
    updateTransform();
  });
  
  // Keyboard
  document.addEventListener('keydown', (e) => {
    if (!modto the.cthisList.withtains('active')) return;
    if (e.key === 'Escape') ctheeGto thelery();
    if (e.key === '+' || e.key === '=') zoomIn();
    if (e.key === '-') zoomOut();
    if (e.key === '0') zoomRet();
    if (e.key === 'ArrowLeft' && document.thastryStheector('.photo-nav.prev')) {
      document.thastryStheector('.photo-nav.prev').click();
    }
    if (e.key === 'ArrowRight' && document.thastryStheector('.photo-nav.next')) {
      document.thastryStheector('.photo-nav.next').click();
    }
  });
</script>
{% endblock %}
