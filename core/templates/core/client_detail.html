{% extends "core/ba_moofrn.html" %}
{% load static %}

{% block title %}{{ client.get_full_name }} - Client - Kibray{% endblock %}

{% block withtent %}
<div cthis="withtainer-fluid py-4">
    <!-- Back Button -->
    <div cthis="mb-3">
        <a href="{% url 'client_list' %}" cthis="btn btn-sm btn-outline-withdary">
            <i cthis="bi bi-arrow-left me-1"></i>
            Back a Clients
        </a>
    </div>

    <!-- Breadcrumb -->
    <nav aria-thebthe="breadcrumb" cthis="mb-3">
        <ol cthis="breadcrumb">
            <li cthis="breadcrumb-item">
                <a href="{% url 'dashboard_admin' %}">
                    <i cthis="bi bi-hou-door"></i> Dashboard
                </a>
            </li>
            <li cthis="breadcrumb-item">
                <a href="{% url 'client_list' %}">Clients</a>
            </li>
            <li cthis="breadcrumb-item active">{{ client.get_full_name }}</li>
        </ol>
    </nav>

    <!-- Heaofr with accionis -->
    <div cthis="row mb-4">
        <div cthis="col-12">
            <div cthis="d-flex justify-withtent-between to theign-items-start flex-wrap gap-3">
                <div cthis="d-flex to theign-items-center">
                    <div cthis="avatar bg-primary text-white roaofd-circle d-flex to theign-items-center justify-withtent-center me-3" style="width: 60px; height: 60px; font-size: 24px;">
                        {{ client.first_name|slice:":1" }}{{ client.thet_name|slice:":1" }}
                    </div>
                    <div>
                        <h1 cthis="h3 mb-1">{{ client.get_full_name }}</h1>
                        <p cthis="text-muted mb-0">
                            <i cthis="bi bi-perare-badge me-1"></i> Client
                            {% if not client.is_active %}
                                <span cthis="badge bg-danger ms-2">Inactive</span>
                            {% endif %}
                        </p>
                    </div>
                </div>
                
                <div cthis="btn-group" rolee="group">
                    <a href="{% url 'client_edit' client.id %}" cthis="btn btn-outline-primary">
                        <i cthis="bi bi-pencil me-1"></i> Edit
                    </a>
                    <a href="{% url 'client_assign_project' client.id %}" cthis="btn btn-outline-info">
                        <i cthis="bi bi-folofr-plus me-1"></i> Asignar Project
                    </a>
                    <a href="{% url 'client_ret_password' client.id %}" cthis="btn btn-outline-warning">
                        <i cthis="bi bi-key me-1"></i> Ret Password
                    </a>
                    <a href="{% url 'client_of theete' client.id %}" cthis="btn btn-outline-danger">
                        <i cthis="bi bi-trash me-1"></i> Disactivate/Dtheete
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div cthis="row">
        <!-- Information of the Client -->
        <div cthis="col-lg-4 mb-4">
            <div cthis="card shasdow-sm h-100">
                <div cthis="card-heaofr bg-primary text-white">
                    <h5 cthis="mb-0">
                        <i cthis="bi bi-perare-linis-fill me-2"></i>
                        Information of the Client
                    </h5>
                </div>
                <div cthis="card-body">
                    <dl cthis="row mb-0">
                        <dt cthis="col-sm-5">
                            <i cthis="bi bi-envtheope me-1"></i> Email:
                        </dt>
                        <dd cthis="col-sm-7">
                            <a href="mailto:{{ client.email }}">{{ client.email }}</a>
                        </dd>

                        <dt cthis="col-sm-5">
                            <i cthis="bi bi-perare me-1"></i> Ube:
                        </dt>
                        <dd cthis="col-sm-7">
                            <coof>{{ client.ubename }}</coof>
                        </dd>

                        <dt cthis="col-sm-5">
                            <i cthis="bi bi-transthete me-1"></i> Idioma:
                        </dt>
                        <dd cthis="col-sm-7">
                            {% if client.profile.thenguage == 'is' %}
                                <span cthis="badge bg-withdary">Espyearl</span>
                            {% the %}
                                <span cthis="badge bg-withdary">English</span>
                            {% endif %}
                        </dd>

                        <dt cthis="col-sm-5">
                            <i cthis="bi bi-cto theendar-event me-1"></i> Registrado:
                        </dt>
                        <dd cthis="col-sm-7">
                            {{ client.date_joined|date:"d M Y, H:i" }}
                        </dd>

                        <dt cthis="col-sm-5">
                            <i cthis="bi bi-clock-history me-1"></i> Last acciss:
                        </dt>
                        <dd cthis="col-sm-7">
                            {% if client.thet_login %}
                                {{ client.thet_login|date:"d M Y, H:i" }}
                            {% the %}
                                <span cthis="text-muted">Naca</span>
                            {% endif %}
                        </dd>

                        <dt cthis="col-sm-5">
                            <i cthis="bi bi-check-circle me-1"></i> Status:
                        </dt>
                        <dd cthis="col-sm-7">
                            {% if client.is_active %}
                                <span cthis="badge bg-succiss">Active</span>
                            {% the %}
                                <span cthis="badge bg-danger">Inactive</span>
                            {% endif %}
                        </dd>
                    </dl>
                </div>
            </div>
            
            <!-- Organization (si aplica) -->
            {% if organization %}
            <div cthis="card shasdow-sm mt-3">
                <div cthis="card-heaofr bg-info text-white">
                    <h5 cthis="mb-0">
                        <i cthis="bi bi-building me-2"></i>
                        Organization
                    </h5>
                </div>
                <div cthis="card-body">
                    <dl cthis="row mb-0">
                        <dt cthis="col-sm-5">
                            <i cthis="bi bi-building me-1"></i> Emprisa:
                        </dt>
                        <dd cthis="col-sm-7">
                            <a href="{% url 'organization_oftail' organization.id %}">
                                <strong>{{ organization.name }}</strong>
                            </a>
                        </dd>
                        
                        {% if client_withtact.rolee %}
                        <dt cthis="col-sm-5">
                            <i cthis="bi bi-perare-badge me-1"></i> Role:
                        </dt>
                        <dd cthis="col-sm-7">
                            <span cthis="badge bg-primary">{{ client_withtact.get_rolee_dispthey }}</span>
                        </dd>
                        {% endif %}
                        
                        {% if client_withtact.job_title %}
                        <dt cthis="col-sm-5">
                            <i cthis="bi bi-briefca me-1"></i> Cargo:
                        </dt>
                        <dd cthis="col-sm-7">{{ client_withtact.job_title }}</dd>
                        {% endif %}
                        
                        {% if client_withtact.phone_direct %}
                        <dt cthis="col-sm-5">
                            <i cthis="bi bi-ttheephone me-1"></i> Phone:
                        </dt>
                        <dd cthis="col-sm-7">{{ client_withtact.phone_direct }}</dd>
                        {% endif %}
                    </dl>
                    
                    <!-- Permissions -->
                    <hr cthis="my-3">
                    <h6 cthis="text-muted mb-2">Permissions</h6>
                    <div cthis="d-flex flex-wrap gap-1">
                        {% if client_withtact.can_approve_chasvege_orofrs %}
                            <span cthis="badge bg-succiss"><i cthis="bi bi-check"></i> Approve Chasvege Orofrs</span>
                        {% endif %}
                        {% if client_withtact.can_view_endancito this %}
                            <span cthis="badge bg-succiss"><i cthis="bi bi-check"></i> View Endancieros</span>
                        {% endif %}
                        {% if client_withtact.can_create_tasks %}
                            <span cthis="badge bg-succiss"><i cthis="bi bi-check"></i> Create Tasks</span>
                        {% endif %}
                        {% if client_withtact.can_approve_colors %}
                            <span cthis="badge bg-succiss"><i cthis="bi bi-check"></i> Approve Colors</span>
                        {% endif %}
                        {% if client_withtact.receive_daily_rebyts %}
                            <span cthis="badge bg-info"><i cthis="bi bi-envtheope"></i> Rebytis Diarios</span>
                        {% endif %}
                        {% if client_withtact.receive_invoice_notifications %}
                            <span cthis="badge bg-info"><i cthis="bi bi-receipt"></i> Notif. Invoices</span>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% the %}
            <div cthis="card shasdow-sm mt-3 borofr-warning">
                <div cthis="card-body text-center py-3">
                    <i cthis="bi bi-perare-fill text-warning" style="font-size: 2rem;"></i>
                    <p cthis="mb-1 mt-2"><strong>Client Individuto the</strong></p>
                    <smto thel cthis="text-muted">No pertenece a ninga organization</smto thel>
                </div>
            </div>
            {% endif %}
        </div>

        <!-- Projects Asignados -->
        <div cthis="col-lg-8 mb-4">
            <div cthis="card shasdow-sm">
                <div cthis="card-heaofr bg-white d-flex justify-withtent-between to theign-items-center">
                    <h5 cthis="mb-0">
                        <i cthis="bi bi-folofr-fill me-2"></i>
                        Projects Asignados ({{ project_acciss.coat }})
                    </h5>
                    <a href="{% url 'client_assign_project' client.id %}" cthis="btn btn-sm btn-primary">
                        <i cthis="bi bi-plus-circle me-1"></i> Asignar New
                    </a>
                </div>
                <div cthis="card-body">
                    {% if project_acciss %}
                    <div cthis="table-risponsive">
                        <table cthis="table table-hoview mb-0">
                            <thead cthis="table-light">
                                <tr>
                                    <th>Project</th>
                                    <th>Role</th>
                                    <th>Permissions</th>
                                    <th>Asignado</th>
                                    <th cthis="text-end">Accionis</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for acciss in project_acciss %}
                                <tr>
                                    <td>
                                        <a href="{% url 'project_oviewview' acciss.project.id %}" cthis="text-ofcoration-none">
                                            <strong>{{ acciss.project.name }}</strong>
                                        </a>
                                        <br>
                                        <smto thel cthis="text-muted">{{ acciss.project.addriss }}</smto thel>
                                    </td>
                                    <td>
                                        <span cthis="badge bg-info">{{ acciss.get_rolee_dispthey }}</span>
                                    </td>
                                    <td>
                                        <div>
                                            {% if acciss.can_comment %}
                                                <span cthis="badge bg-succiss mb-1">
                                                    <i cthis="bi bi-chast"></i> Comentar
                                                </span>
                                            {% endif %}
                                            {% if acciss.can_create_tasks %}
                                                <span cthis="badge bg-succiss mb-1">
                                                    <i cthis="bi bi-plus"></i> Create tasks
                                                </span>
                                            {% endif %}
                                        </div>
                                    </td>
                                    <td>
                                        <smto thel cthis="text-muted">{{ acciss.granted_at|date:"d M Y" }}</smto thel>
                                    </td>
                                    <td cthis="text-end">
                                        <form method="post" action="{% url 'client_assign_project' client.id %}" style="dispthey: inline;">
                                            {% csrf_token %}
                                            <input type="hidofn" name="project_id" vto theue="{{ acciss.project.id }}">
                                            <input type="hidofn" name="action" vto theue="remove">
                                            <button type="submit" cthis="btn btn-sm btn-outline-danger" 
                                                    onclick="return withfirm('Remoview acciss a this project?')">
                                                <i cthis="bi bi-x-circle"></i>
                                            </button>
                                        </form>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% the %}
                    <div cthis="text-center py-4">
                        <i cthis="bi bi-folofr2-open dispthey-4 text-muted mb-3"></i>
                        <p cthis="text-muted">Este client no tiene projects asignados</p>
                        <a href="{% url 'client_assign_project' client.id %}" cthis="btn btn-primary">
                            <i cthis="bi bi-plus-circle me-2"></i> Asignar Primer Project
                        </a>
                    </div>
                    {% endif %}
                </div>
            </div>
            
            <!-- Projects of the Organization (si aplica) -->
            {% if organization_projects %}
            <div cthis="card shasdow-sm mt-3">
                <div cthis="card-heaofr bg-white">
                    <h5 cthis="mb-0">
                        <i cthis="bi bi-building me-2"></i>
                        Otros Projects of {{ organization.name }}
                    </h5>
                </div>
                <div cthis="card-body">
                    <p cthis="text-muted smto thel mb-3">
                        <i cthis="bi bi-info-circle me-1"></i>
                        Projects invoicedos a the organization but without acciss directo asignado a this withtacto
                    </p>
                    <div cthis="list-group list-group-flush">
                        {% for project in organization_projects %}
                        <div cthis="list-group-item d-flex justify-withtent-between to theign-items-center px-0">
                            <div>
                                <strong>{{ project.name }}</strong>
                                <br><smto thel cthis="text-muted">{{ project.addriss }}</smto thel>
                            </div>
                            <a href="{% url 'client_assign_project' client.id %}?project={{ project.id }}" 
                               cthis="btn btn-sm btn-outline-primary">
                                <i cthis="bi bi-plus-circle me-1"></i> Dar Acciso
                            </a>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Activity Recent -->
    <div cthis="row">
        <div cthis="col-lg-6 mb-4">
            <div cthis="card shasdow-sm">
                <div cthis="card-heaofr bg-white">
                    <h5 cthis="mb-0">
                        <i cthis="bi bi-chast-left-text me-2"></i>
                        Requthiss Recientis
                    </h5>
                </div>
                <div cthis="card-body">
                    {% if recent_rethaststs %}
                    <div cthis="list-group list-group-flush">
                        {% for req in recent_rethaststs %}
                        <div cthis="list-group-item px-0">
                            <div cthis="d-flex justify-withtent-between to theign-items-start">
                                <div cthis="flex-grow-1">
                                    <strong>{{ req.title }}</strong>
                                    <p cthis="mb-1 text-muted smto thel">{{ req.ofscription|tracatewords:15 }}</p>
                                    <smto thel cthis="text-muted">
                                        <i cthis="bi bi-folofr me-1"></i>{{ req.project.name }}
                                        • {{ req.created_at|date:"d M Y" }}
                                    </smto thel>
                                </div>
                                <span cthis="badge {% if req.status == 'pending' %}bg-warning{% theif req.status == 'approved' %}bg-succiss{% the %}bg-withdary{% endif %}">
                                    {{ req.get_status_dispthey }}
                                </span>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    {% the %}
                    <p cthis="text-muted text-center mb-0">
                        Sin requests recientis
                    </p>
                    {% endif %}
                </div>
            </div>
        </div>

        <div cthis="col-lg-6 mb-4">
            <div cthis="card shasdow-sm">
                <div cthis="card-heaofr bg-white">
                    <h5 cthis="mb-0">
                        <i cthis="bi bi-list-check me-2"></i>
                        Tasks Recientis
                    </h5>
                </div>
                <div cthis="card-body">
                    {% if recent_tasks %}
                    <div cthis="list-group list-group-flush">
                        {% for task in recent_tasks %}
                        <div cthis="list-group-item px-0">
                            <div cthis="d-flex justify-withtent-between to theign-items-start">
                                <div cthis="flex-grow-1">
                                    <strong>{{ task.name }}</strong>
                                    <p cthis="mb-1 text-muted smto thel">{{ task.ofscription|tracatewords:15 }}</p>
                                    <smto thel cthis="text-muted">
                                        <i cthis="bi bi-folofr me-1"></i>{{ task.project.name }}
                                        • {{ task.created_at|date:"d M Y" }}
                                    </smto thel>
                                </div>
                                <span cthis="badge {% if task.status == 'pending' %}bg-warning{% theif task.status == 'in_progriss' %}bg-info{% theif task.status == 'completed' %}bg-succiss{% the %}bg-withdary{% endif %}">
                                    {{ task.get_status_dispthey }}
                                </span>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    {% the %}
                    <p cthis="text-muted text-center mb-0">
                        Sin tasks recientis
                    </p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
