{% load i18n %}{% load i18n %}

{# {# 

Photo Editor Modal ComponentPhoto Editor Modal Component



Full-screen modal with canvas-based photo annotation tools.Full-screen modal with canvas-based photo annotation tools.

Supports drawing, arrows, rectangles, circles, text, color selection, undo/redo/clear.Supports drawing, arrows, text, color selection, undo/clear.



Usage: Include this component and implement the required JavaScript functions.Required JavaScript globals:

- openPhotoEditor(imageUrl, photoId, annotations) 

Required JavaScript globals:- closePhotoEditor()

- openPhotoEditor(imageUrl, photoId, annotations) - setDrawingMode(mode)

- closePhotoEditor()- setDrawingColor(color, element)

- setDrawingMode(mode)- undoDrawing()

- setDrawingColor(color, element)- clearDrawing()

- undoDrawing()- saveAnnotations()

- redoDrawing()

- clearDrawing()These functions should be defined in the parent template's extra_js block.

- saveAnnotations()#}



These functions should be defined in the parent template's extra_js block.<div class="photo-editor-modal hidden" id="photoEditorModal">

#}    <div class="photo-editor-content bg-white flex flex-col h-full">

        <!-- Header -->

<div class="photo-editor-modal hidden" id="photoEditorModal">        <div class="photo-editor-header flex items-center justify-between p-4 border-b border-slate-200 bg-slate-50">

    <div class="photo-editor-content">            <h3 class="text-lg font-semibold text-slate-800 flex items-center gap-2">

        <!-- Header -->                <i class="bi bi-pencil-square text-indigo-600"></i> 

        <div class="photo-editor-header">                {% trans "Editor de Fotos" %}

            <h3>            </h3>

                <i class="bi bi-pencil-square"></i>             <button type="button" 

                Photo Editor                    class="btn-close hover:bg-slate-200 rounded-full p-2 transition"

            </h3>                    onclick="closePhotoEditor()" 

            <button type="button"                     aria-label="{% trans "Cerrar" %}">

                    class="btn-close-editor"                <i class="bi bi-x-lg text-xl text-slate-600"></i>

                    onclick="closePhotoEditor()"             </button>

                    aria-label="Close">        </div>

                <i class="bi bi-x-lg"></i>        

            </button>        <!-- Drawing Tools -->

        </div>        <div class="drawing-tools flex flex-wrap items-center gap-3 p-4 bg-slate-100 border-b border-slate-200">

                    <!-- Mode Buttons -->

        <!-- Drawing Tools -->            <button type="button" 

        <div class="drawing-tools">                    class="tool-btn active bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg font-medium transition flex items-center gap-2" 

            <!-- Tool Mode Buttons -->                    onclick="setDrawingMode('draw')" 

            <div class="tool-group">                    id="drawBtn">

                <span class="tool-label">Tools:</span>                <i class="bi bi-pencil-fill"></i> 

                <button type="button" class="tool-btn active" onclick="setDrawingMode('draw')" id="drawBtn" title="Freehand drawing">                <span class="hidden sm:inline">{% trans "Dibujar" %}</span>

                    <i class="bi bi-pencil-fill"></i>            </button>

                    <span>Pencil</span>            <button type="button" 

                </button>                    class="tool-btn bg-slate-200 hover:bg-slate-300 text-slate-700 px-4 py-2 rounded-lg font-medium transition flex items-center gap-2" 

                <button type="button" class="tool-btn" onclick="setDrawingMode('arrow')" id="arrowBtn" title="Draw arrow">                    onclick="setDrawingMode('arrow')" 

                    <i class="bi bi-arrow-up-right"></i>                    id="arrowBtn">

                    <span>Arrow</span>                <i class="bi bi-arrow-up-right"></i> 

                </button>                <span class="hidden sm:inline">{% trans "Flecha" %}</span>

                <button type="button" class="tool-btn" onclick="setDrawingMode('rectangle')" id="rectangleBtn" title="Draw rectangle">            </button>

                    <i class="bi bi-square"></i>            <button type="button" 

                    <span>Rectangle</span>                    class="tool-btn bg-slate-200 hover:bg-slate-300 text-slate-700 px-4 py-2 rounded-lg font-medium transition flex items-center gap-2" 

                </button>                    onclick="setDrawingMode('text')" 

                <button type="button" class="tool-btn" onclick="setDrawingMode('circle')" id="circleBtn" title="Draw circle">                    id="textBtn">

                    <i class="bi bi-circle"></i>                <i class="bi bi-fonts"></i> 

                    <span>Circle</span>                <span class="hidden sm:inline">{% trans "Texto" %}</span>

                </button>            </button>

                <button type="button" class="tool-btn" onclick="setDrawingMode('text')" id="textBtn" title="Add text">            

                    <i class="bi bi-fonts"></i>            <div class="w-px h-8 bg-slate-300 hidden sm:block"></div>

                    <span>Text</span>            

                </button>            <!-- Action Buttons -->

            </div>            <button type="button" 

                                class="tool-btn bg-slate-200 hover:bg-slate-300 text-slate-700 px-4 py-2 rounded-lg font-medium transition flex items-center gap-2" 

            <div class="tool-divider"></div>                    onclick="undoDrawing()">

                            <i class="bi bi-arrow-counterclockwise"></i> 

            <!-- History Buttons -->                <span class="hidden sm:inline">{% trans "Deshacer" %}</span>

            <div class="tool-group">            </button>

                <span class="tool-label">History:</span>            <button type="button" 

                <button type="button" class="tool-btn tool-btn-secondary" onclick="undoDrawing()" id="undoBtn" title="Undo">                    class="tool-btn bg-red-100 hover:bg-red-200 text-red-700 px-4 py-2 rounded-lg font-medium transition flex items-center gap-2" 

                    <i class="bi bi-arrow-counterclockwise"></i>                    onclick="clearDrawing()">

                    <span>Undo</span>                <i class="bi bi-trash3"></i> 

                </button>                <span class="hidden sm:inline">{% trans "Limpiar" %}</span>

                <button type="button" class="tool-btn tool-btn-secondary" onclick="redoDrawing()" id="redoBtn" title="Redo">            </button>

                    <i class="bi bi-arrow-clockwise"></i>            

                    <span>Redo</span>            <div class="w-px h-8 bg-slate-300 ml-auto hidden sm:block"></div>

                </button>            

                <button type="button" class="tool-btn tool-btn-danger" onclick="clearDrawing()" title="Clear all">            <!-- Color Selector -->

                    <i class="bi bi-trash3"></i>            <div class="color-selector flex items-center gap-2">

                    <span>Clear</span>                <span class="text-sm font-medium text-slate-700 hidden sm:inline">{% trans "Color:" %}</span>

                </button>                <div class="flex gap-1">

            </div>                    <div class="color-swatch active w-8 h-8 rounded-full border-2 border-slate-400 cursor-pointer hover:scale-110 transition" 

                                     style="background:#dc2626;" 

            <div class="tool-divider"></div>                         onclick="setDrawingColor('#dc2626', this)" 

                                     title="{% trans 'Rojo' %}"></div>

            <!-- Color Selector -->                    <div class="color-swatch w-8 h-8 rounded-full border-2 border-transparent cursor-pointer hover:scale-110 transition" 

            <div class="tool-group">                         style="background:#2563eb;" 

                <span class="tool-label">Color:</span>                         onclick="setDrawingColor('#2563eb', this)" 

                <div class="color-palette">                         title="{% trans 'Azul' %}"></div>

                    <div class="color-swatch active" style="background:#dc2626;" onclick="setDrawingColor('#dc2626', this)" title="Red"></div>                    <div class="color-swatch w-8 h-8 rounded-full border-2 border-transparent cursor-pointer hover:scale-110 transition" 

                    <div class="color-swatch" style="background:#2563eb;" onclick="setDrawingColor('#2563eb', this)" title="Blue"></div>                         style="background:#16a34a;" 

                    <div class="color-swatch" style="background:#16a34a;" onclick="setDrawingColor('#16a34a', this)" title="Green"></div>                         onclick="setDrawingColor('#16a34a', this)" 

                    <div class="color-swatch" style="background:#f59e0b;" onclick="setDrawingColor('#f59e0b', this)" title="Yellow"></div>                         title="{% trans 'Verde' %}"></div>

                    <div class="color-swatch" style="background:#a855f7;" onclick="setDrawingColor('#a855f7', this)" title="Purple"></div>                    <div class="color-swatch w-8 h-8 rounded-full border-2 border-transparent cursor-pointer hover:scale-110 transition" 

                    <div class="color-swatch" style="background:#000000;" onclick="setDrawingColor('#000000', this)" title="Black"></div>                         style="background:#f59e0b;" 

                    <div class="color-swatch white" style="background:#ffffff;" onclick="setDrawingColor('#ffffff', this)" title="White"></div>                         onclick="setDrawingColor('#f59e0b', this)" 

                </div>                         title="{% trans 'Amarillo' %}"></div>

            </div>                    <div class="color-swatch w-8 h-8 rounded-full border-2 border-transparent cursor-pointer hover:scale-110 transition" 

                                     style="background:#000000;" 

            <div class="tool-divider"></div>                         onclick="setDrawingColor('#000000', this)" 

                                     title="{% trans 'Negro' %}"></div>

            <!-- Line Width -->                    <div class="color-swatch w-8 h-8 rounded-full border-2 border-slate-300 cursor-pointer hover:scale-110 transition" 

            <div class="tool-group">                         style="background:#ffffff;" 

                <span class="tool-label">Size: <span id="lineWidthDisplay">3px</span></span>                         onclick="setDrawingColor('#ffffff', this)" 

                <input type="range" id="lineWidthSlider" min="1" max="20" value="3" onchange="setLineWidth(this.value)" oninput="updateLineWidthDisplay(this.value)">                         title="{% trans 'Blanco' %}"></div>

            </div>                </div>

        </div>            </div>

                </div>

        <!-- Canvas Container -->        

        <div class="canvas-container" id="canvasContainer">        <!-- Canvas Container -->

            <canvas id="drawingCanvas"></canvas>        <div class="canvas-container flex-1 overflow-auto bg-slate-200 flex items-center justify-center p-4">

        </div>            <canvas id="drawingCanvas" class="max-w-full max-h-full shadow-xl bg-white"></canvas>

                </div>

        <!-- Footer Action Buttons -->        

        <div class="editor-actions">        <!-- Action Buttons -->

            <button type="button" class="btn-editor btn-editor-cancel" onclick="closePhotoEditor()">        <div class="editor-actions flex gap-3 p-4 border-t border-slate-200 bg-slate-50">

                <i class="bi bi-x-circle"></i>             <button type="button" 

                Cancel                    class="btn btn-secondary flex-1 sm:flex-initial bg-white hover:bg-slate-100 text-slate-700 border border-slate-300 px-6 py-3 rounded-lg font-semibold transition flex items-center justify-center gap-2" 

            </button>                    onclick="closePhotoEditor()">

            <button type="button" class="btn-editor btn-editor-save" onclick="saveAnnotations()">                <i class="bi bi-x-circle"></i> 

                <i class="bi bi-check-circle-fill"></i>                 {% trans "Cancelar" %}

                Save Changes            </button>

            </button>            <button type="button" 

        </div>                    class="btn btn-success flex-1 bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-semibold transition flex items-center justify-center gap-2" 

    </div>                    onclick="saveAnnotations()">

</div>                <i class="bi bi-check-circle-fill"></i> 

                {% trans "Guardar" %}

<!-- Text Input Modal for Photo Editor -->            </button>

<div class="editor-text-modal hidden" id="editorTextModal">        </div>

    <div class="editor-text-modal-content">    </div>

        <h4><i class="bi bi-fonts"></i> Add Text</h4></div>

        <input type="text" id="editorTextInput" placeholder="Enter your text..." maxlength="100">

        <div class="editor-text-modal-buttons"><style>

            <button type="button" onclick="cancelTextInput()">Cancel</button>/* Photo Editor Modal Styles */

            <button type="button" class="primary" onclick="confirmTextInput()">Add</button>.photo-editor-modal {

        </div>    position: fixed;

    </div>    top: 0;

</div>    left: 0;

    width: 100%;

<style>    height: 100%;

/* Photo Editor Modal */    background: rgba(0, 0, 0, 0.9);

.photo-editor-modal {    z-index: 10000;

    position: fixed;    display: flex;

    top: 0;    align-items: center;

    left: 0;    justify-content: center;

    width: 100%;    transition: opacity 0.3s ease;

    height: 100%;}

    background: rgba(0, 0, 0, 0.95);

    z-index: 10000;.photo-editor-modal.hidden {

    display: flex;    display: none;

    align-items: center;    opacity: 0;

    justify-content: center;}

    opacity: 1;

    transition: opacity 0.3s ease;.photo-editor-modal:not(.hidden) {

}    opacity: 1;

}

.photo-editor-modal.hidden {

    display: none;.photo-editor-content {

    opacity: 0;    width: 100%;

}    height: 100%;

    max-width: 100%;

.photo-editor-content {    max-height: 100%;

    width: 100%;}

    height: 100%;

    background: white;@media (min-width: 768px) {

    display: flex;    .photo-editor-content {

    flex-direction: column;        width: 95vw;

    overflow: hidden;        height: 95vh;

}        max-width: 1600px;

        border-radius: 1rem;

@media (min-width: 768px) {        overflow: hidden;

    .photo-editor-content {    }

        width: 95vw;}

        height: 95vh;

        max-width: 1600px;/* Tool Button Active State */

        border-radius: 1rem;.tool-btn.active {

    }    background: rgb(79, 70, 229) !important;

}    color: white !important;

}

/* Header */

.photo-editor-header {/* Color Swatch Active State */

    display: flex;.color-swatch.active {

    align-items: center;    border-color: rgb(59, 130, 246) !important;

    justify-content: space-between;    border-width: 3px !important;

    padding: 1rem 1.5rem;    box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.3);

    border-bottom: 1px solid #e2e8f0;}

    background: #f8fafc;

}/* Canvas Cursor */

#drawingCanvas {

.photo-editor-header h3 {    cursor: crosshair;

    font-size: 1.25rem;}

    font-weight: 600;</style>

    color: #1e293b;
    margin: 0;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.photo-editor-header h3 i {
    color: #6366f1;
}

.btn-close-editor {
    width: 40px;
    height: 40px;
    border: none;
    background: #e2e8f0;
    border-radius: 0.5rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
}

.btn-close-editor:hover {
    background: #cbd5e1;
}

.btn-close-editor i {
    font-size: 1.25rem;
    color: #475569;
}

/* Drawing Tools Bar */
.drawing-tools {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: 1rem;
    padding: 0.75rem 1.5rem;
    background: #f1f5f9;
    border-bottom: 1px solid #e2e8f0;
}

.tool-group {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.tool-label {
    font-size: 0.75rem;
    font-weight: 600;
    color: #64748b;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.tool-divider {
    width: 1px;
    height: 32px;
    background: #cbd5e1;
}

.tool-btn {
    padding: 0.5rem 0.75rem;
    border: 2px solid #e2e8f0;
    border-radius: 0.5rem;
    background: white;
    color: #475569;
    font-size: 0.875rem;
    font-weight: 500;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 0.375rem;
    transition: all 0.2s;
}

.tool-btn:hover {
    border-color: #cbd5e1;
    background: #f8fafc;
}

.tool-btn.active {
    background: #6366f1;
    color: white;
    border-color: #6366f1;
}

.tool-btn i {
    font-size: 1rem;
}

.tool-btn span {
    display: none;
}

@media (min-width: 768px) {
    .tool-btn span {
        display: inline;
    }
}

.tool-btn-secondary {
    background: #f1f5f9;
}

.tool-btn-danger:hover {
    border-color: #ef4444;
    color: #ef4444;
    background: #fef2f2;
}

.tool-btn.disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

/* Color Palette */
.color-palette {
    display: flex;
    gap: 0.375rem;
}

.color-swatch {
    width: 28px;
    height: 28px;
    border-radius: 50%;
    border: 2px solid transparent;
    cursor: pointer;
    transition: all 0.2s;
}

.color-swatch:hover {
    transform: scale(1.15);
}

.color-swatch.active {
    border-color: #3b82f6;
    box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.3);
}

.color-swatch.white {
    border: 2px solid #d1d5db;
}

/* Line Width Slider */
#lineWidthSlider {
    width: 100px;
    height: 6px;
    border-radius: 3px;
    background: #e2e8f0;
    outline: none;
    -webkit-appearance: none;
}

#lineWidthSlider::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 16px;
    height: 16px;
    border-radius: 50%;
    background: #6366f1;
    cursor: pointer;
}

/* Canvas Container */
.canvas-container {
    flex: 1;
    overflow: auto;
    background: #1e293b;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 1rem;
}

#drawingCanvas {
    max-width: 100%;
    max-height: 100%;
    background: white;
    cursor: crosshair;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
}

/* Footer Actions */
.editor-actions {
    display: flex;
    gap: 1rem;
    padding: 1rem 1.5rem;
    border-top: 1px solid #e2e8f0;
    background: #f8fafc;
    justify-content: flex-end;
}

.btn-editor {
    padding: 0.75rem 1.5rem;
    border-radius: 0.5rem;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    border: none;
    transition: all 0.2s;
}

.btn-editor-cancel {
    background: white;
    color: #475569;
    border: 1px solid #d1d5db;
}

.btn-editor-cancel:hover {
    background: #f1f5f9;
}

.btn-editor-save {
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    color: white;
}

.btn-editor-save:hover {
    box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
    transform: translateY(-1px);
}

.btn-editor-save:disabled {
    background: #9ca3af;
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
}

/* Text Input Modal */
.editor-text-modal {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10001;
}

.editor-text-modal.hidden {
    display: none;
}

.editor-text-modal-content {
    background: white;
    padding: 1.5rem;
    border-radius: 1rem;
    width: 90%;
    max-width: 400px;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
}

.editor-text-modal-content h4 {
    margin: 0 0 1rem 0;
    color: #1e293b;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.editor-text-modal-content input {
    width: 100%;
    padding: 0.75rem 1rem;
    border: 2px solid #e2e8f0;
    border-radius: 0.5rem;
    font-size: 1rem;
    margin-bottom: 1rem;
}

.editor-text-modal-content input:focus {
    outline: none;
    border-color: #6366f1;
}

.editor-text-modal-buttons {
    display: flex;
    gap: 0.75rem;
    justify-content: flex-end;
}

.editor-text-modal-buttons button {
    padding: 0.5rem 1rem;
    border-radius: 0.5rem;
    font-weight: 600;
    cursor: pointer;
    border: none;
    background: #e2e8f0;
    color: #475569;
}

.editor-text-modal-buttons button.primary {
    background: #6366f1;
    color: white;
}

/* Mobile Responsive */
@media (max-width: 640px) {
    .drawing-tools {
        padding: 0.5rem;
        gap: 0.5rem;
    }
    
    .tool-label {
        display: none;
    }
    
    .tool-divider {
        display: none;
    }
    
    .tool-btn {
        padding: 0.5rem;
    }
    
    .color-swatch {
        width: 24px;
        height: 24px;
    }
    
    .editor-actions {
        flex-direction: column;
    }
    
    .btn-editor {
        width: 100%;
        justify-content: center;
    }
}
</style>
