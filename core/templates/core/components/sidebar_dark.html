{% load i18n %}
{% load static %}

{% with prof=request.user.profile|default_if_none:'' role=request.user.profile.role|default:'employee' %}

{# Dark Modern Sidebar - Asana Style #}
<aside id="kb-sidebar" class="fixed left-0 top-14 bottom-0 w-64 bg-[#1e1f21] border-r border-white/10 overflow-y-auto z-40 transform -translate-x-full lg:translate-x-0 transition-transform duration-200" aria-label="{% trans 'Primary navigation' %}">
    
    {# Mobile Close Button #}
    <div class="flex items-center justify-between px-4 py-3 border-b border-white/10 lg:hidden">
        <span class="text-white font-semibold">{% trans "Menu" %}</span>
        <button id="kb-sidebar-close" aria-label="{% trans 'Close navigation' %}" class="p-2 rounded-lg text-slate-400 hover:bg-white/10 hover:text-white transition">
            <i class="bi bi-x-lg"></i>
        </button>
    </div>
    
    {# Navigation #}
    <nav class="py-4 px-3 space-y-6">
        
        {# ===== MAIN SECTION ===== #}
        <div class="space-y-1">
            <a href="{% url 'dashboard' %}" class="sidebar-item {% if request.resolver_match.url_name == 'dashboard' %}active{% endif %}">
                <i class="bi bi-house-door"></i>
                <span>{% trans "Home" %}</span>
            </a>
            
            <a href="{% url 'notifications_list' %}" class="sidebar-item {% if request.resolver_match.url_name == 'notifications_list' %}active{% endif %}">
                <i class="bi bi-bell"></i>
                <span>{% trans "Notifications" %}</span>
                {% if badges.unread_notifications_count|default:0 > 0 %}
                <span class="ml-auto bg-red-500 text-white text-[10px] font-bold px-1.5 py-0.5 rounded-full">{{ badges.unread_notifications_count }}</span>
                {% endif %}
            </a>
        </div>
        
        {# ===== PROJECTS SECTION ===== #}
        <div>
            <div class="sidebar-section-title">{% trans "Projects" %}</div>
            <div class="space-y-1">
                <a href="{% url 'project_list' %}" class="sidebar-item">
                    <i class="bi bi-folder2"></i>
                    <span>{% trans "All Projects" %}</span>
                </a>
                
                {# Recent Projects - Dynamic from context #}
                {% if recent_projects %}
                {% for project in recent_projects|slice:":5" %}
                <a href="{% url 'project_overview' project.id %}" class="sidebar-item">
                    <span class="w-2 h-2 rounded-full bg-indigo-500 flex-shrink-0"></span>
                    <span class="truncate">{{ project.name }}</span>
                </a>
                {% endfor %}
                {% endif %}
            </div>
        </div>
        
        {# ===== STAFF/PM SECTION ===== #}
        {% if user.is_staff or user.is_superuser or role == 'project_manager' or role == 'admin' %}
        <div>
            <div class="sidebar-section-title">{% trans "Planning" %}</div>
            <div class="space-y-1">
                <a href="{% url 'daily_planning_dashboard' %}" class="sidebar-item">
                    <i class="bi bi-calendar-check"></i>
                    <span>{% trans "Daily Planning" %}</span>
                </a>
                <a href="{% url 'strategic_planning_dashboard' %}" class="sidebar-item">
                    <i class="bi bi-compass"></i>
                    <span>{% trans "Strategic" %}</span>
                </a>
                <a href="{% url 'master_schedule_center' %}" class="sidebar-item">
                    <i class="bi bi-calendar3"></i>
                    <span>{% trans "Master Schedule" %}</span>
                </a>
                <a href="{% url 'assignment_hub' %}" class="sidebar-item">
                    <i class="bi bi-people"></i>
                    <span>{% trans "Team Assignments" %}</span>
                </a>
            </div>
        </div>
        
        <div>
            <div class="sidebar-section-title">{% trans "Operations" %}</div>
            <div class="space-y-1">
                <a href="{% url 'changeorder_board' %}" class="sidebar-item">
                    <i class="bi bi-kanban"></i>
                    <span>{% trans "Change Orders" %}</span>
                </a>
                <a href="{% url 'task_list_all' %}" class="sidebar-item">
                    <i class="bi bi-check2-square"></i>
                    <span>{% trans "All Tasks" %}</span>
                </a>
                <a href="{% url 'payroll_summary' %}" class="sidebar-item">
                    <i class="bi bi-cash-coin"></i>
                    <span>{% trans "Payroll" %}</span>
                </a>
            </div>
        </div>
        {% endif %}
        
        {# ===== ADMIN ONLY SECTION ===== #}
        {% if user.is_superuser or role == 'admin' %}
        <div>
            <div class="sidebar-section-title">{% trans "Administration" %}</div>
            <div class="space-y-1">
                <a href="{% url 'dashboard_admin' %}" class="sidebar-item">
                    <i class="bi bi-gear"></i>
                    <span>{% trans "Admin Dashboard" %}</span>
                </a>
                <a href="/admin/core/employee/" class="sidebar-item">
                    <i class="bi bi-person-badge"></i>
                    <span>{% trans "Employees" %}</span>
                </a>
                <a href="/admin/" class="sidebar-item">
                    <i class="bi bi-database"></i>
                    <span>{% trans "Django Admin" %}</span>
                </a>
            </div>
        </div>
        {% endif %}
        
        {# ===== EMPLOYEE SECTION ===== #}
        {% if role == 'employee' and not user.is_staff %}
        <div>
            <div class="sidebar-section-title">{% trans "My Work" %}</div>
            <div class="space-y-1">
                <a href="{% url 'dashboard_employee' %}" class="sidebar-item">
                    <i class="bi bi-clock-history"></i>
                    <span>{% trans "Time Tracking" %}</span>
                </a>
            </div>
        </div>
        {% endif %}
        
    </nav>
    
    {# Bottom Section - Help & Version #}
    <div class="absolute bottom-0 left-0 right-0 p-3 border-t border-white/10 bg-[#1e1f21]">
        <a href="#" class="sidebar-item text-slate-500 hover:text-slate-300">
            <i class="bi bi-question-circle"></i>
            <span>{% trans "Help & Support" %}</span>
        </a>
        <div class="text-center text-[10px] text-slate-600 mt-2">
            Kibray v2.0
        </div>
    </div>
</aside>

{# Mobile Backdrop #}
<div id="kb-sidebar-backdrop" class="fixed inset-0 bg-black/60 opacity-0 pointer-events-none transition-opacity duration-200 z-30 lg:hidden"></div>

<style>
/* Sidebar Item Styles */
.sidebar-item {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.5rem 0.75rem;
    color: #a2a0a2;
    text-decoration: none;
    font-size: 14px;
    border-radius: 6px;
    transition: all 0.15s ease;
}

.sidebar-item:hover {
    background: rgba(255, 255, 255, 0.08);
    color: #ffffff;
}

.sidebar-item.active {
    background: rgba(255, 255, 255, 0.12);
    color: #ffffff;
}

.sidebar-item i {
    font-size: 16px;
    width: 20px;
    text-align: center;
    flex-shrink: 0;
}

.sidebar-section-title {
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: #6f7782;
    padding: 0.5rem 0.75rem;
    margin-bottom: 0.25rem;
}
</style>

{% endwith %}
