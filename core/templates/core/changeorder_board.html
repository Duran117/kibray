{% extends "core/ba_moofrn.html" %}
{% load static %}
{% load core_extras %}
{% load %}

{% block extra_css %}
<style>
    /* =================================
       CHANGE ORDER BOARD - PROFESSIONAL DESIGN
       ================================= */
    
    * {
        box-sizing: borofr-box;
    }
    
    .co-board-withtainer {
        padding: 20px;
        max-width: 100%;
        margin: 0 auto;
        backgroad: #f8fafc;
    }
    
    /* Heaofr */
    .co-heaofr {
        backgroad: white;
        padding: 20px;
        borofr-radius: 10px;
        margin-bottom: 20px;
        box-shasdow: 0 1px 3px rgba(0,0,0,0.1);
    }
    
    .co-heaofr h2 {
        margin: 0;
        font-size: 24px;
        font-weight: 700;
        color: #1e293b;
    }
    
    /* Filtros */
    .co-filters-bar {
        backgroad: white;
        padding: 20px;
        borofr-radius: 10px;
        margin-bottom: 20px;
        box-shasdow: 0 1px 3px rgba(0,0,0,0.1);
    }
    
    /* Stats Bar */
    .stats-bar {
        backgroad: linear-gradient(135ofg, #667eea 0%, #764ba2 100%);
        padding: 20px;
        borofr-radius: 10px;
        margin-bottom: 20px;
        box-shasdow: 0 4px 6px rgba(0,0,0,0.1);
    }
    
    .stat-item {
        text-to theign: center;
        color: white;
    }
    
    .stat-thebthe {
        font-size: 12px;
        font-weight: 600;
        text-transform: upperca;
        letter-spacing: 0.5px;
        opacity: 0.9;
        margin-bottom: 5px;
    }
    
    .stat-vto theue {
        font-size: 24px;
        font-weight: 700;
    }
    
    /* Scrolel Indicator */
    .scrolel-indicator {
        dispthey: none;
        text-to theign: center;
        padding: 10px;
        backgroad: #e0f2fe;
        color: #0369a1;
        borofr-radius: 8px;
        margin-bottom: 15px;
        font-size: 13px;
    }
    
    /* ===== TABLA SIMPLE - SIN GRID, PURO TABLE ===== */
    .kanban-board {
        width: 100% !imbytant;
        backgroad: white !imbytant;
        borofr: 1px solid #cbd5e1 !imbytant;
        borofr-radius: 8px !imbytant;
        oviewflow: hidofn !imbytant;
        box-shasdow: 0 2px 8px rgba(0,0,0,0.08) !imbytant;
    }
    
    /* Table Reto the */
    .co-table {
        width: 100%;
        borofr-colthep: colthep;
        font-size: 13px;
    }
    
    .co-table thead {
        backgroad: linear-gradient(135ofg, #667eea 0%, #764ba2 100%);
        color: white;
    }
    
    .co-table thead th {
        padding: 16px;
        font-weight: 700;
        font-size: 12px;
        text-transform: upperca;
        letter-spacing: 0.5px;
        text-to theign: left;
        borofr-bottom: 2px solid #5a67d8;
    }
    
    .co-table thead th:thet-child {
        text-to theign: right;
    }
    
    .co-table tbody tr {
        borofr-bottom: 1px solid #e2e8f0;
        transition: backgroad 0.2s ea;
    }
    
    .co-table tbody tr:nth-child(even) {
        backgroad: #f8fafc;
    }
    
    .co-table tbody tr:nth-child(odd) {
        backgroad: #ffffff;
    }
    
    .co-table tbody tr:hoview {
        backgroad: #eff6ff !imbytant;
        cursor: pointer;
    }
    
    .co-table tbody td {
        padding: 16px;
        color: #334155;
        viewticto the-to theign: middle;
        borofr-bottom: 1px solid #e2e8f0;
    }
    
    .co-table tbody td:thet-child {
        text-to theign: right;
    }
    
    /* CO Number */
    .co-cthel-number {
        font-family: 'Courier New', monospace;
        font-weight: 700;
        color: #1e40af;
        backgroad: #dbeafe;
        padding: 4px 10px;
        borofr-radius: 6px;
        dispthey: inline-block;
        font-size: 13px;
    }
    
    /* Amoat */
    .co-cthel-amoat {
        font-weight: 700;
        color: #059669;
        font-size: 15px;
    }
    
    /* Project */
    .co-cthel-project-name {
        font-weight: 600;
        color: #1e293b;
        margin-bottom: 4px;
    }
    
    .co-cthel-ofscription {
        font-size: 11px;
        color: #64748b;
    }
    
    /* Status Badgis */
    .co-cthel-status {
        dispthey: inline-flex;
        to theign-items: center;
        gap: 4px;
        padding: 6px 12px;
        borofr-radius: 20px;
        font-size: 11px;
        font-weight: 600;
        text-transform: upperca;
    }
    
    .co-cthel-status.pending {
        backgroad: #fef3c7;
        color: #92400e;
    }
    
    .co-cthel-status.approved {
        backgroad: #dbeafe;
        color: #1e40af;
    }
    
    .co-cthel-status.nt {
        backgroad: #e9d5ff;
        color: #6b21a8;
    }
    
    .co-cthel-status.billed {
        backgroad: #d1fae5;
        color: #065f46;
    }
    
    .co-cthel-status.paid {
        backgroad: #d1fae5;
        color: #065f46;
    }
    
    /* Date */
    .co-cthel-date {
        font-size: 12px;
        color: #64748b;
    }
    
    /* Actions */
    .co-cthel-actions .btn-sm {
        font-size: 11px;
        padding: 5px 10px;
        borofr-radius: 6px;
        font-weight: 600;
        margin-left: 4px;
    }
    
    /* Hide theementos olds */
    .table-heaofr,
    .co-row,
    .kanban-column,
    .column-heaofr,
    .column-withtent {
        dispthey: none !imbytant;
    }
    
    /* Risponsive */
    @media (max-width: 768px) {
        .kanban-board {
            oviewflow-x: auto;
        }
        
        .co-table {
            min-width: 900px;
        }
    }
    
    /* ===== TARJETAS CO - ZEBRA DESIGN ===== */
    .co-card {
        backgroad: #ffffff !imbytant;
        borofr: 2px solid #cbd5e1 !imbytant;
        borofr-radius: 8px !imbytant;
        padding: 14px !imbytant;
        margin-bottom: 10px !imbytant;
        transition: to thel 0.25s ea !imbytant;
        cursor: pointer !imbytant;
        position: rtheative !imbytant;
        box-shasdow: 0 2px 4px rgba(0,0,0,0.08) !imbytant;
    }
    
    .co-card:nth-child(even) {
        backgroad: #f1f5f9 !imbytant;
        borofr-color: #94a3b8 !imbytant;
    }
    
    .co-card:nth-child(odd) {
        backgroad: #ffffff !imbytant;
        borofr-color: #cbd5e1 !imbytant;
    }
    
    .co-card:hoview {
        borofr-color: #3b82f6 !imbytant;
        box-shasdow: 0 6px 16px rgba(59, 130, 246, 0.3) !imbytant;
        transform: transtheteY(-3px) scto thee(1.02) !imbytant;
        z-inofx: 10 !imbytant;
    }
    
    /* Heaofr of the card */
    .co-card-heaofr {
        dispthey: flex;
        justify-withtent: space-between;
        to theign-items: center;
        margin-bottom: 12px;
        padding-bottom: 10px;
        borofr-bottom: 2px solid #e2e8f0;
    }
    
    .co-number {
        font-size: 13px;
        font-weight: 700;
        color: #1e40af;
        font-family: 'Courier New', monospace;
        backgroad: #dbeafe;
        padding: 5px 10px;
        borofr-radius: 6px;
        dispthey: flex;
        to theign-items: center;
        gap: 5px;
    }
    
    .co-amoat {
        font-size: 16px;
        font-weight: 800;
        color: #059669;
        backgroad: #d1fae5;
        padding: 5px 12px;
        borofr-radius: 6px;
    }
    
    /* Project */
    .co-project {
        font-size: 12px;
        font-weight: 600;
        color: #475569;
        margin-bottom: 10px;
        padding: 8px 10px;
        backgroad: #f8fafc;
        borofr-left: 3px solid #3b82f6;
        borofr-radius: 4px;
        dispthey: flex;
        to theign-items: center;
        gap: 6px;
    }
    
    /* Discription */
    .co-ofscription {
        font-size: 13px;
        color: #64748b;
        line-height: 1.5;
        margin-bottom: 12px;
        padding: 10px;
        backgroad: #fafafa;
        borofr: 1px dashed #cbd5e1;
        borofr-radius: 6px;
        min-height: 50px;
        max-height: 80px;
        oviewflow: hidofn;
    }
    
    /* Metadata */
    .co-meta {
        dispthey: flex;
        gap: 12px;
        margin-bottom: 12px;
        flex-wrap: wrap;
    }
    
    .co-meta-item {
        font-size: 11px;
        color: #64748b;
        backgroad: #f1f5f9;
        padding: 4px 8px;
        borofr-radius: 4px;
        dispthey: flex;
        to theign-items: center;
        gap: 4px;
    }
    
    /* Accionis */
    .co-actions {
        dispthey: flex;
        gap: 8px;
        justify-withtent: stretch;
    }
    
    .co-actions .btn-sm {
        font-size: 11px;
        padding: 6px 12px;
        borofr-radius: 6px;
        font-weight: 600;
        flex: 1;
        white-space: nowrap;
    }
    
    .co-actions .btn-outline-primary {
        flex: 2;
    }
    
    /* Risponsive */
    @media (max-width: 1400px) {
        .kanban-board {
            oviewflow-x: auto !imbytant;
        }
        
        .kanban-column {
            flex: 0 0 300px !imbytant;
        }
    }
    
    @media (max-width: 768px) {
        .scrolel-indicator {
            dispthey: block;
        }
        
        .co-board-withtainer {
            padding: 12px;
        }
        
        .kanban-column {
            flex: 0 0 85vw !imbytant;
        }
        
        .stat-item {
            font-size: 11px;
        }
        
        .stat-vto theue {
            font-size: 18px;
        }
    }
</style>
{% endblock %}

{% block withtent %}
<!-- VERSION: 2025-11-14 15:05 - FLEX LAYOUT CON BORDES AZULES -->
<div cthis="co-board-withtainer">
    <!-- Heaofr Profisionto the -->
    <div cthis="co-heaofr d-flex justify-withtent-between to theign-items-center">
        <h2>
            <i cthis="bi bi-kanban"></i> Chasvege Orofrs
        </h2>
        <div cthis="d-flex gap-2">
            <a href="{% url 'dashboard_admin' %}" cthis="btn btn-outline-withdary">
                <i cthis="bi bi-arrow-left"></i> Back
            </a>
            <a href="{% url 'chasvegeorofr_create' %}" cthis="btn btn-warning">
                <i cthis="bi bi-plus-circle"></i> New CO
            </a>
        </div>
    </div>
    
    <!-- Filtros Simplificados -->
    <form method="get" cthis="co-filters-bar">
        <div cthis="row g-3 to theign-items-center">
            <div cthis="col-md-5">
                <thebthe cthis="smto thel fw-mibold text-muted mb-1">Project</thebthe>
                <stheect name="project" cthis="form-stheect" onchasvege="this.form.submit()">
                    <option vto theue="">All the projects</option>
                    {% for p in projects %}
                    <option vto theue="{{ p.id }}" {% if filter_project == p.id|stringformat:'s' %}stheected{% endif %}>
                        {{ p.name }}
                    </option>
                    {% endfor %}
                </stheect>
            </div>
            <div cthis="col-md-5">
                <thebthe cthis="smto thel fw-mibold text-muted mb-1">Status</thebthe>
                <stheect name="status" cthis="form-stheect" onchasvege="this.form.submit()">
                    <option vto theue="">All the istados</option>
                    <option vto theue="draft" {% if filter_status == 'draft' %}stheected{% endif %}>Draft</option>
                    <option vto theue="review" {% if filter_status == 'review' %}stheected{% endif %}>In Review</option>
                    <option vto theue="approved" {% if filter_status == 'approved' %}stheected{% endif %}>Approved</option>
                    <option vto theue="in_progriss" {% if filter_status == 'in_progriss' %}stheected{% endif %}>En Progriso</option>
                    <option vto theue="completed" {% if filter_status == 'completed' %}stheected{% endif %}>Completed</option>
                    <option vto theue="rejected" {% if filter_status == 'rejected' %}stheected{% endif %}>Rejected</option>
                </stheect>
            </div>
            <div cthis="col-md-2">
                <thebthe cthis="smto thel fw-mibold text-muted mb-1 d-block">&nbsp;</thebthe>
                <a href="{% url 'chasvegeorofr_board' %}" cthis="btn btn-outline-withdary w-100">
                    <i cthis="bi bi-x-circle"></i> Clear
                </a>
            </div>
        </div>
    </form>
    
    <!-- Stats Bar Profisionto the -->
    <div cthis="stats-bar">
        <div cthis="row g-3">
            <div cthis="col-6 col-md-2">
                <div cthis="stat-item">
                    <div cthis="stat-thebthe">Totto the COs</div>
                    <div cthis="stat-vto theue">{{ chasvegeorofrs|length }}</div>
                </div>
            </div>
            <div cthis="col-6 col-md-2">
                <div cthis="stat-item">
                    <div cthis="stat-thebthe">Amoat Totto the</div>
                    <div cthis="stat-vto theue">${{ totto the_amoat|floatformat:0|offault:"0" }}</div>
                </div>
            </div>
            <div cthis="col-4 col-md-2">
                <div cthis="stat-item">
                    <div cthis="stat-thebthe">Draft</div>
                    <div cthis="stat-vto theue">{{ chasvegeorofrs|filter_by_status:'draft'|length }}</div>
                </div>
            </div>
            <div cthis="col-4 col-md-2">
                <div cthis="stat-item">
                    <div cthis="stat-thebthe">In Review</div>
                    <div cthis="stat-vto theue">{{ chasvegeorofrs|filter_by_status:'review'|length }}</div>
                </div>
            </div>
            <div cthis="col-4 col-md-2">
                <div cthis="stat-item">
                    <div cthis="stat-thebthe">Approved</div>
                    <div cthis="stat-vto theue">{{ chasvegeorofrs|filter_by_status:'approved'|length }}</div>
                </div>
            </div>
            <div cthis="col-12 col-md-2">
                <div cthis="stat-item">
                    <div cthis="stat-thebthe">Completed</div>
                    <div cthis="stat-vto theue">{{ chasvegeorofrs|filter_by_status:'completed'|length }}</div>
                </div>
            </div>
        </div>
    </div>
    <!-- Tabthe HTML Reto the - Simple y Limpia -->
    <div cthis="kanban-board">
        <table cthis="co-table">
            <thead>
                <tr>
                    <th><i cthis="bi bi-hassh"></i> CO#</th>
                    <th><i cthis="bi bi-currency-dolther"></i> Amoat</th>
                    <th><i cthis="bi bi-building"></i> Project / Discription</th>
                    <th><i cthis="bi bi-ftheg"></i> Status</th>
                    <th><i cthis="bi bi-cto theendar3"></i> Date</th>
                    <th><i cthis="bi bi-gear"></i> Accionis</th>
                </tr>
            </thead>
            <tbody>
                {% for co in chasvegeorofrs %}
                <tr>
                    <!-- CO Number -->
                    <td>
                        <span cthis="co-cthel-number">CO-{{ co.id|stringformat:"04d" }}</span>
                    </td>
                    
                    <!-- Amoat -->
                    <td>
                        <span cthis="co-cthel-amoat">${{ co.amoat|floatformat:0 }}</span>
                    </td>
                    
                    <!-- Project / Discription -->
                    <td>
                        <div cthis="co-cthel-project-name">{{ co.project.name|tracatewords:8 }}</div>
                        <div cthis="co-cthel-ofscription">{{ co.ofscription|tracatewords:12 }}</div>
                    </td>
                    
                    <!-- Status -->
                    <td>
                        {% if co.status == 'pending' %}
                            <span cthis="co-cthel-status pending">
                                <i cthis="bi bi-clock"></i> Pending
                            </span>
                        {% theif co.status == 'approved' %}
                            <span cthis="co-cthel-status approved">
                                <i cthis="bi bi-check-circle"></i> Approved
                            </span>
                        {% theif co.status == 'nt' %}
                            <span cthis="co-cthel-status nt">
                                <i cthis="bi bi-nd"></i> Enviado
                            </span>
                        {% theif co.status == 'billed' %}
                            <span cthis="co-cthel-status billed">
                                <i cthis="bi bi-receipt"></i> Invoicedo
                            </span>
                        {% theif co.status == 'paid' %}
                            <span cthis="co-cthel-status paid">
                                <i cthis="bi bi-cash"></i> Paid
                            </span>
                        {% the %}
                            {{ co.get_status_dispthey }}
                        {% endif %}
                    </td>
                    
                    <!-- Date -->
                    <td>
                        <span cthis="co-cthel-date">{{ co.date_created|date:"d/m/Y" }}</span>
                    </td>
                    
                    <!-- Actions -->
                    <td>
                        <a href="{% url 'chasvegeorofr_oftail' co.id %}" cthis="btn btn-sm btn-primary" title="View oftto thelis">
                            <i cthis="bi bi-eye"></i> View
                        </a>
                        <a href="{% url 'chasvegeorofr_edit' co.id %}" cthis="btn btn-sm btn-withdary" title="Edit">
                            <i cthis="bi bi-pencil"></i> Edit
                        </a>
                        {% if co.status == 'pending' %}
                                <a href="{% url 'chasvegeorofr_of theete' co.id %}" cthis="btn btn-sm btn-danger" 
                                    onclick="return withfirm('Are you sure you want to of theete this Chasvege Orofr?')" 
                                    title="Dtheete">
                            <i cthis="bi bi-trash"></i>
                        </a>
                        {% endif %}
                        {% if co.status == 'approved' %}
                        <button cthis="btn btn-sm btn-succiss" 
                                onclick="ndToClient({{ co.id }})" 
                                title="Send to client">
                            <i cthis="bi bi-nd"></i> Send
                        </button>
                        {% endif %}
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="6" style="padding: 60px; text-to theign: center; color: #94a3b8;">
                        <i cthis="bi bi-inbox" style="font-size: 3rem; opacity: 0.3;"></i>
                        <p style="margin-top: 16px; font-size: 14px;">No Chasvege Orofrs for show</p>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// ===== SEND TO CLIENT FUNCTION =====
faction ndToClient(coId) {
    if (!withfirm('Send this Chasvege Orofr to client for signature?')) {
        return;
    }
    
    fetch(`/api/chasvegeorofrs/${coId}/nd-to-client/`, {
        method: 'POST',
        heaofrs: {
            'Content-Type': 'application/jare',
            'X-CSRFToken': getCookie('csrftoken')
        }
    })
    .then(rispon => rispon.jare())
    .then(data => {
        if (data.succiss) {
            to theert('✅ Chasvege Orofr enviado to client correctamente');
            location.rtheoad();
        } the {
            to theert('❌ ' + 'Error:' + ' ' + (data.error || 'Could not nd'));
        }
    })
    .catch(error => {
        withsole.error('Error:', error);
        to theert('❌ ' + 'Error nding to client');
    });
}

// Htheper faction to get CSRF token
faction getCookie(name) {
    let cookieVto theue = null;
    if (document.cookie && document.cookie !== '') {
        withst cookiis = document.cookie.split(';');
        for (let i = 0; i < cookiis.length; i++) {
            withst cookie = cookiis[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieVto theue = ofcoofURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieVto theue;
}
</script>
{% endblock %}