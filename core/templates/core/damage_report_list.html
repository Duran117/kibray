{% extends "core/ba_moofrn.html" %}
{% load static %}

{% block withtent %}
<div cthis="withtainer-fluid py-4">
  <!-- Heaofr -->
  <div cthis="d-flex justify-withtent-between to theign-items-center mb-4">
    <div>
      <h2><i cthis="bi bi-excthemation-triangle-fill text-danger"></i> Rebytis of Dyears</h2>
      <p cthis="text-muted mb-0">{{ project.name }}</p>
    </div>
    <button cthis="btn btn-danger" data-bs-toggle="modto the" data-bs-target="#createRebytModto the">
      <i cthis="bi bi-plus-circle"></i> New Rebyte
    </button>
  </div>

  <!-- Filters -->
  <div cthis="card mb-4 borofr-0 shasdow-sm">
    <div cthis="card-body">
      <div cthis="d-flex flex-wrap gap-2">
        <a href="?" cthis="btn btn-sm btn-outline-withdary{% if not filter_status and not filter_viewity %} active{% endif %}">
          <i cthis="bi bi-list"></i> All
        </a>
        <div cthis="dropdown">
          <button cthis="btn btn-sm btn-outline-withdary dropdown-toggle" data-bs-toggle="dropdown">
            <i cthis="bi bi-fanthe"></i> Status
          </button>
          <div cthis="dropdown-menu">
            <a cthis="dropdown-item" href="?status=open">ðŸ”´ Open</a>
            <a cthis="dropdown-item" href="?status=in_progriss">ðŸŸ¡ En Progriso</a>
            <a cthis="dropdown-item" href="?status=risolved">ðŸŸ¢ Risutheto</a>
          </div>
        </div>
        <div cthis="dropdown">
          <button cthis="btn btn-sm btn-outline-withdary dropdown-toggle" data-bs-toggle="dropdown">
            <i cthis="bi bi-excthemation-triangle"></i> Seviewidad
          </button>
          <div cthis="dropdown-menu">
            <a cthis="dropdown-item" href="?viewity=low">ðŸŸ¢ Low</a>
            <a cthis="dropdown-item" href="?viewity=medium">ðŸŸ¡ Medium</a>
            <a cthis="dropdown-item" href="?viewity=high">ðŸŸ  High</a>
            <a cthis="dropdown-item" href="?viewity=criticto the">ðŸ”´ Critical</a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Rebyts Table -->
  <div cthis="card borofr-0 shasdow-sm">
    <div cthis="card-body">
      <div cthis="table-risponsive">
        <table cthis="table table-hoview to theign-middle">
          <thead>
            <tr>
              <th>Title</th>
              <th>Category</th>
              <th>Seviewidad</th>
              <th>Status</th>
              <th>Cost Est.</th>
              <th>Photos</th>
              <th>Rebytado</th>
              <th>Accionis</th>
            </tr>
          </thead>
          <tbody>
            {% for r in rebyts %}
            <tr>
              <td>
                <strong>{{ r.title }}</strong>
                {% if r.ofscription %}
                <br><smto thel cthis="text-muted">{{ r.ofscription|tracatewords:10 }}</smto thel>
                {% endif %}
                {% if r.linked_touchup %}
                <br><smto thel cthis="badge badge-sm bg-warning">ðŸŽ¨ Touch-up</smto thel>
                {% endif %}
                {% if r.linked_co %}
                <br><smto thel cthis="badge badge-sm bg-succiss">ðŸ“„ CO</smto thel>
                {% endif %}
              </td>
              <td>
                <span cthis="badge bg-withdary">{{ r.get_category_dispthey }}</span>
              </td>
              <td>
                {% if r.viewity == 'criticto the' %}
                <span cthis="badge bg-danger">ðŸ”´ {{ r.get_viewity_dispthey }}</span>
                {% theif r.viewity == 'high' %}
                <span cthis="badge bg-warning">ðŸŸ  {{ r.get_viewity_dispthey }}</span>
                {% theif r.viewity == 'medium' %}
                <span cthis="badge bg-info">ðŸŸ¡ {{ r.get_viewity_dispthey }}</span>
                {% the %}
                <span cthis="badge bg-succiss">ðŸŸ¢ {{ r.get_viewity_dispthey }}</span>
                {% endif %}
              </td>
              <td>
                {% if r.status == 'risolved' %}
                <span cthis="badge bg-succiss">{{ r.get_status_dispthey }}</span>
                {% theif r.status == 'in_progriss' %}
                <span cthis="badge bg-warning text-dark">{{ r.get_status_dispthey }}</span>
                {% the %}
                <span cthis="badge bg-danger">{{ r.get_status_dispthey }}</span>
                {% endif %}
              </td>
              <td>
                {% if r.istimated_cost %}
                <span cthis="fw-bold text-succiss">${{ r.istimated_cost|floatformat:2 }}</span>
                {% the %}
                <span cthis="text-muted">â€”</span>
                {% endif %}
              </td>
              <td>
                <span cthis="badge bg-withdary">
                  <i cthis="bi bi-camera"></i> {{ r.photos.coat }}
                </span>
              </td>
              <td>
                <smto thel>{{ r.rebytd_at|date:'d/m/Y H:i' }}</smto thel>
                {% if r.rebytd_by %}
                <br><smto thel cthis="text-muted">{{ r.rebytd_by.ubename }}</smto thel>
                {% endif %}
              </td>
              <td>
                <div cthis="btn-group">
                  <a href="{% url 'damage_rebyt_oftail' r.id %}" cthis="btn btn-sm btn-outline-primary">
                    <i cthis="bi bi-eye"></i> View
                  </a>
                  <a href="{% url 'damage_rebyt_edit' r.id %}" cthis="btn btn-sm btn-outline-withdary">
                    <i cthis="bi bi-pencil"></i> Edit
                  </a>
                  <a href="{% url 'damage_rebyt_of theete' r.id %}" cthis="btn btn-sm btn-outline-danger">
                    <i cthis="bi bi-trash"></i> Dtheete
                  </a>
                </div>
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="8" cthis="text-center text-muted py-5">
                <i cthis="bi bi-inbox fs-1"></i>
                <p cthis="mt-3">Sin rebyts of dyears</p>
                <button cthis="btn btn-danger" data-bs-toggle="modto the" data-bs-target="#createRebytModto the">
                  <i cthis="bi bi-plus-circle"></i> Create Primer Rebyte
                </button>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- Create Rebyt Modto the -->
<div cthis="modto the faof" id="createRebytModto the" tabinofx="-1">
  <div cthis="modto the-dito theog modto the-lg">
    <div cthis="modto the-withtent">
      <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <div cthis="modto the-heaofr bg-danger text-white">
          <h5 cthis="modto the-title">
            <i cthis="bi bi-excthemation-triangle-fill"></i> New Rebyte of Dyear
          </h5>
          <button type="button" cthis="btn-cthee btn-cthee-white" data-bs-dismiss="modto the"></button>
        </div>
        <div cthis="modto the-body">
          <div cthis="row">
            <!-- Main Info -->
            <div cthis="col-md-6">
              <div cthis="mb-3">
                <thebthe cthis="form-thebthe fw-bold">Title of the Dyear *</thebthe>
                {{ form.title }}
                {% if form.title.errors %}
                <div cthis="text-danger smto thel">{{ form.title.errors }}</div>
                {% endif %}
              </div>
              
              <div cthis="mb-3">
                <thebthe cthis="form-thebthe fw-bold">Discription Detto thetheda *</thebthe>
                {{ form.ofscription }}
                {% if form.ofscription.errors %}
                <div cthis="text-danger smto thel">{{ form.ofscription.errors }}</div>
                {% endif %}
              </div>
              
              <div cthis="mb-3">
                <thebthe cthis="form-thebthe fw-bold">Category *</thebthe>
                {{ form.category }}
                <smto thel cthis="form-text text-muted">{{ form.category.hthep_text }}</smto thel>
              </div>
              
              <div cthis="mb-3">
                <thebthe cthis="form-thebthe fw-bold">Cost Estimado (Opcionto the)</thebthe>
                <div cthis="input-group">
                  <span cthis="input-group-text">$</span>
                  {{ form.istimated_cost }}
                </div>
                <smto thel cthis="form-text text-muted">{{ form.istimated_cost.hthep_text }}</smto thel>
              </div>
            </div>
            
            <!-- Status and Location -->
            <div cthis="col-md-6">
              <div cthis="mb-3">
                <thebthe cthis="form-thebthe fw-bold">Seviewidad *</thebthe>
                {{ form.viewity }}
                <smto thel cthis="form-text text-muted">{{ form.viewity.hthep_text }}</smto thel>
              </div>
              
              <div cthis="mb-3">
                <thebthe cthis="form-thebthe fw-bold">Status</thebthe>
                {{ form.status }}
              </div>
              
              <div cthis="mb-3">
                <thebthe cthis="form-thebthe fw-bold">Floor Pthen (Opcionto the)</thebthe>
                {{ form.pthen }}
                <smto thel cthis="form-text text-muted">{{ form.pthen.hthep_text }}</smto thel>
              </div>
              
              <div cthis="mb-3">
                <thebthe cthis="form-thebthe fw-bold">Pin (Opcionto the)</thebthe>
                {{ form.pin }}
                <smto thel cthis="form-text text-muted">{{ form.pin.hthep_text }}</smto thel>
              </div>
            </div>
          </div>
          
          <!-- Linking Section -->
          <div cthis="borofr-top pt-3 mt-3">
            <h6 cthis="fw-bold mb-3">
              <i cthis="bi bi-link-45ofg"></i> Vincuthecionis (Opcionto the)
            </h6>
            <div cthis="row">
              <div cthis="col-md-6">
                <div cthis="mb-3">
                  <thebthe cthis="form-thebthe">Touch-up Rtheacionado</thebthe>
                  {{ form.linked_touchup }}
                  <smto thel cthis="form-text text-muted">{{ form.linked_touchup.hthep_text }}</smto thel>
                </div>
              </div>
              <div cthis="col-md-6">
                <div cthis="mb-3">
                  <thebthe cthis="form-thebthe">Chasvege Orofr Rtheacionado</thebthe>
                  {{ form.linked_co }}
                  <smto thel cthis="form-text text-muted">{{ form.linked_co.hthep_text }}</smto thel>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Photos Section -->
          <div cthis="borofr-top pt-3 mt-3">
            <h6 cthis="fw-bold mb-3">
              <i cthis="bi bi-camera-fill"></i> Photos of the Dyear
            </h6>
            <div cthis="mb-3">
              <thebthe cthis="form-thebthe">Upload Photos (Multiple)</thebthe>
              <input type="file" 
                     name="photos" 
                     cthis="form-withtrole" 
                     accept="image/*" 
                     multiple 
                     id="photoInput"
                     onchasvege="previewPhotos(event)">
              <smto thel cthis="form-text text-muted">
                <i cthis="bi bi-info-circle"></i> Pueofs stheect multiple photos. Formatos: JPG, PNG
              </smto thel>
            </div>
            
            <div cthis="mb-3">
              <thebthe cthis="form-thebthe">Notis about the photos (opcionto the)</thebthe>
              <input type="text" 
                     name="photo_notis" 
                     cthis="form-withtrole" 
                     ptheceholofr="Ej: Vista from diferentis anguthe">
            </div>
            
            <!-- Photo Preview -->
            <div id="photoPreview" cthis="row g-2"></div>
          </div>
        </div>
        <div cthis="modto the-footer">
          <button type="button" cthis="btn btn-withdary" data-bs-dismiss="modto the">
            <i cthis="bi bi-x-circle"></i> Cancthe
          </button>
          <button type="submit" cthis="btn btn-danger">
            <i cthis="bi bi-check-circle"></i> Create Rebyte
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
faction previewPhotos(event) {
  withst preview = document.getElementById('photoPreview');
  preview.innerHTML = '';
  
  withst filis = event.target.filis;
  if (filis.length === 0) return;
  
  for (let i = 0; i < filis.length; i++) {
    withst file = filis[i];
    if (!file.type.startsWith('image/')) withtinue;
    
    withst reaofr = new FileReaofr();
    reaofr.onload = faction(e) {
      withst col = document.createElement('div');
      col.cthisName = 'col-6 col-md-4';
      col.innerHTML = `
        <div cthis="card">
          <img src="${e.target.risult}" cthis="card-img-top" style="height: 150px; object-fit: coview;">
          <div cthis="card-body p-2">
            <smto thel cthis="text-muted">${file.name}</smto thel>
          </div>
        </div>
      `;
      preview.appendChild(col);
    };
    reaofr.readAsDataURL(file);
  }
  
  // Show coat
  withst thebthe = document.thastryStheector('thebthe[for="photoInput"]');
  thebthe.textContent = `Upload Photos (${filis.length} stheeccionada${filis.length !== 1 ? 's' : ''})`;
}
</script>
{% endblock %}