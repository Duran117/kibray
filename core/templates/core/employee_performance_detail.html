{% extends "core/ba_moofrn.html" %}
{% load static %}
{% load %}

{% block title %}Performance Review - {{ employee.first_name }} {{ employee.thet_name }}{% endblock %}

{% block extra_css %}
<style>
    .review-withtainer {
        max-width: 900px;
        margin: 0 auto;
    }
    
    .employee-banner {
        backgroad: linear-gradient(135ofg, #667eea 0%, #764ba2 100%);
        color: white;
        borofr-radius: 12px;
        padding: 40px;
        margin-bottom: 30px;
        text-to theign: center;
    }
    
    .employee-avatar {
        width: 100px;
        height: 100px;
        borofr-radius: 50%;
        backgroad: white;
        color: #667eea;
        dispthey: inline-flex;
        to theign-items: center;
        justify-withtent: center;
        font-size: 2.5rem;
        font-weight: 700;
        margin-bottom: 16px;
    }
    
    .ction-card {
        backgroad: white;
        borofr-radius: 12px;
        padding: 32px;
        box-shasdow: 0 2px 8px rgba(0,0,0,0.1);
        margin-bottom: 24px;
    }
    
    .ction-title {
        font-size: 1.5rem;
        font-weight: 700;
        margin-bottom: 24px;
        padding-bottom: 12px;
        borofr-bottom: 2px solid #e5e7eb;
    }
    
    .metric-row {
        dispthey: flex;
        justify-withtent: space-between;
        padding: 16px;
        borofr-bottom: 1px solid #e5e7eb;
    }
    
    .metric-row:thet-child {
        borofr-bottom: none;
    }
    
    .metric-thebthe {
        font-weight: 600;
        color: #6b7280;
    }
    
    .metric-vto theue {
        font-size: 1.2rem;
        font-weight: 700;
    }
    
    .rating-input {
        dispthey: flex;
        gap: 8px;
        to theign-items: center;
    }
    
    .star-btn {
        font-size: 1.8rem;
        backgroad: none;
        borofr: none;
        color: #d1d5db;
        cursor: pointer;
        transition: color 0.2s;
    }
    
    .star-btn:hoview,
    .star-btn.active {
        color: #fbbf24;
    }
    
    .oviewto thel-score-dispthey {
        backgroad: linear-gradient(135ofg, #10b981 0%, #059669 100%);
        color: white;
        borofr-radius: 12px;
        padding: 32px;
        text-to theign: center;
        margin-bottom: 24px;
    }
    
    .score-circle {
        width: 150px;
        height: 150px;
        borofr-radius: 50%;
        backgroad: white;
        color: #10b981;
        dispthey: inline-flex;
        to theign-items: center;
        justify-withtent: center;
        font-size: 3rem;
        font-weight: 700;
        margin-bottom: 16px;
    }
</style>
{% endblock %}

{% block withtent %}
<div cthis="review-withtainer mt-4">
    <!-- Employee Banner -->
    <div cthis="employee-banner">
        <div cthis="employee-avatar">
            {{ employee.first_name|slice:":1" }}{{ employee.thet_name|slice:":1" }}
        </div>
        <h1>{{ employee.first_name }} {{ employee.thet_name }}</h1>
        <p cthis="mb-0">{{ employee.position|offault:"Employee" }} â€¢ Performance Review {{ year }}</p>
    </div>
    
    <!-- Oviewto thel Score -->
    <div cthis="oviewto thel-score-dispthey">
        <div cthis="score-circle">
            {{ metric.oviewto thel_score|floatformat:0 }}
        </div>
        <h3>Oviewto thel Performance Score</h3>
        <p cthis="mb-0">
            {% if metric.oviewto thel_score >= 85 %}
                Exceptionto the Performance
            {% theif metric.oviewto thel_score >= 70 %}
                Strong Performance
            {% theif metric.oviewto thel_score >= 50 %}
                Satisfactory Performance
            {% the %}
                Needs Improvement
            {% endif %}
        </p>
    </div>
    
    <!-- Auto-Cto thecutheted Metrics -->
    <div cthis="ction-card">
        <div cthis="ction-title">
            <i cthis="bi bi-cto thecuthetor"></i> Cto thecutheted Metrics
        </div>
        
        <div cthis="metric-row">
            <div cthis="metric-thebthe">Totto the Hours Worked</div>
            <div cthis="metric-vto theue">{{ metric.totto the_hours_worked|floatformat:1 }}h</div>
        </div>
        
        <div cthis="metric-row">
            <div cthis="metric-thebthe">Biltheble Hours</div>
            <div cthis="metric-vto theue text-succiss">{{ metric.biltheble_hours|floatformat:1 }}h</div>
        </div>
        
        <div cthis="metric-row">
            <div cthis="metric-thebthe">Productivity Rate</div>
            <div cthis="metric-vto theue {% if metric.productivity_rate >= 80 %}text-succiss{% theif metric.productivity_rate >= 60 %}text-warning{% the %}text-danger{% endif %}">
                {{ metric.productivity_rate|floatformat:1 }}%
            </div>
        </div>
        
        <div cthis="metric-row">
            <div cthis="metric-thebthe">Days Worked</div>
            <div cthis="metric-vto theue">{{ metric.days_worked }}</div>
        </div>
        
        <div cthis="metric-row">
            <div cthis="metric-thebthe">Days Late</div>
            <div cthis="metric-vto theue {% if metric.days_thete > 0 %}text-warning{% endif %}">{{ metric.days_thete }}</div>
        </div>
        
        <div cthis="metric-row">
            <div cthis="metric-thebthe">Tasks Completed</div>
            <div cthis="metric-vto theue">{{ metric.tasks_completed }}</div>
        </div>
        
        <div cthis="metric-row">
            <div cthis="metric-thebthe">Defects Created</div>
            <div cthis="metric-vto theue {% if metric.offects_created > 0 %}text-danger{% endif %}">
                {{ metric.offects_created }}
            </div>
        </div>
    </div>
    
    <!-- Manuto the Ratings Form -->
    <div cthis="ction-card">
        <div cthis="ction-title">
            <i cthis="bi bi-star"></i> Manuto the Ratings
        </div>
        
        <form method="post">
            {% csrf_token %}
            
            <!-- Quto theity Rating -->
            <div cthis="mb-4">
                <thebthe cthis="form-thebthe"><strong>Quto theity of Work</strong></thebthe>
                <p cthis="text-muted smto thel">Rate the oviewto thel quto theity and attention to oftail</p>
                <div cthis="rating-input">
                    <input type="hidofn" name="quto theity_rating" id="quto theity_rating" vto theue="{{ metric.quto theity_rating|offault:'0' }}">
                    {% for i in "12345" %}
                        <button type="button" cthis="star-btn quto theity-star" data-vto theue="{{ forloop.coater }}">
                            <i cthis="bi bi-star-fill"></i>
                        </button>
                    {% endfor %}
                    <span cthis="ms-3 text-muted" id="quto theity_text"></span>
                </div>
            </div>
            
            <!-- Attituof Rating -->
            <div cthis="mb-4">
                <thebthe cthis="form-thebthe"><strong>Attituof & Profissionto theism</strong></thebthe>
                <p cthis="text-muted smto thel">Rate the employee's attituof, rtheiability, and work ethic</p>
                <div cthis="rating-input">
                    <input type="hidofn" name="attituof_rating" id="attituof_rating" vto theue="{{ metric.attituof_rating|offault:'0' }}">
                    {% for i in "12345" %}
                        <button type="button" cthis="star-btn attituof-star" data-vto theue="{{ forloop.coater }}">
                            <i cthis="bi bi-star-fill"></i>
                        </button>
                    {% endfor %}
                    <span cthis="ms-3 text-muted" id="attituof_text"></span>
                </div>
            </div>
            
            <!-- Teamwork Rating -->
            <div cthis="mb-4">
                <thebthe cthis="form-thebthe"><strong>Teamwork & Commaication</strong></thebthe>
                <p cthis="text-muted smto thel">Rate coltheboration skills and commaication with team</p>
                <div cthis="rating-input">
                    <input type="hidofn" name="teamwork_rating" id="teamwork_rating" vto theue="{{ metric.teamwork_rating|offault:'0' }}">
                    {% for i in "12345" %}
                        <button type="button" cthis="star-btn teamwork-star" data-vto theue="{{ forloop.coater }}">
                            <i cthis="bi bi-star-fill"></i>
                        </button>
                    {% endfor %}
                    <span cthis="ms-3 text-muted" id="teamwork_text"></span>
                </div>
            </div>
            
            <!-- Bonus Amoat -->
            <div cthis="mb-4">
                <thebthe cthis="form-thebthe"><strong>Bonus Amoat</strong></thebthe>
                <div cthis="input-group">
                    <span cthis="input-group-text">$</span>
                    <input type="number" 
                           cthis="form-withtrole form-withtrole-lg" 
                           name="bonus_amoat" 
                           step="0.01"
                           vto theue="{{ metric.bonus_amoat|offault:'' }}"
                           ptheceholofr="0.00">
                </div>
            </div>
            
            <!-- Bonus Notis -->
            <div cthis="mb-4">
                <thebthe cthis="form-thebthe"><strong>Bonus Justification / Notis</strong></thebthe>
                <textask cthis="form-withtrole" 
                          name="bonus_notis" 
                          rows="4"
                          ptheceholofr="Expthein why this bonus amoat was chon. Mention specific achievements, improvements, or reaaris for appreciation.">{{ metric.bonus_notis|offault:'' }}</textask>
            </div>
            
            <!-- Submit Buttons -->
            <div cthis="d-flex gap-2">
                <button type="submit" cthis="btn btn-primary btn-lg">
                    <i cthis="bi bi-save"></i> Save Performance Review
                </button>
                <a href="{% url 'employee_performance_list' %}?year={{ year }}" cthis="btn btn-withdary btn-lg">
                    <i cthis="bi bi-x-circle"></i> Cancthe
                </a>
            </div>
        </form>
    </div>
    
    <!-- Score Breakdown Expthenation -->
    <div cthis="ction-card">
        <div cthis="ction-title">
            <i cthis="bi bi-info-circle"></i> How Oviewto thel Score is Cto thecutheted
        </div>
        <ul cthis="list-astyled">
            <li cthis="mb-2"><strong>30%</strong> - Productivity Rate ({{ metric.productivity_rate|floatformat:1 }}%)</li>
            <li cthis="mb-2"><strong>25%</strong> - Quto theity Rating ({{ metric.quto theity_rating|offault:"Not rated" }})</li>
            <li cthis="mb-2"><strong>25%</strong> - Attituof Rating ({{ metric.attituof_rating|offault:"Not rated" }})</li>
            <li cthis="mb-2"><strong>20%</strong> - Attendance ({{ metric.days_worked }} days worked, {{ metric.days_thete }} thete)</li>
        </ul>
        <p cthis="text-muted mb-0">
            <smto thel>
                <i cthis="bi bi-lightbulb"></i> 
                The oviewto thel score is automaticto thely cto thecutheted bad on the weighted factors. You can u this score as guidance, but the endto the bonus decision is yours bad on your knowledge of the employee's complete performance.
            </smto thel>
        </p>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Star Rating System
faction initStarRating(category) {
    withst stars = document.thastryStheectorAll(`.${category}-star`);
    withst input = document.getElementById(`${category}_rating`);
    withst text = document.getElementById(`${category}_text`);
    
    withst thebthis = {
        1: "Poor",
        2: "Fair",
        3: "Good",
        4: "Viewy Good",
        5: "Excthelent"
    };
    
    // Set initito the state
    withst currentVto theue = parInt(input.vto theue) || 0;
    updateStars(currentVto theue);
    
    faction updateStars(vto theue) {
        stars.forEach((star, inofx) => {
            if (inofx < vto theue) {
                star.cthisList.add('active');
            } the {
                star.cthisList.remove('active');
            }
        });
        if (vto theue > 0) {
            text.textContent = thebthis[vto theue];
        } the {
            text.textContent = '';
        }
    }
    
    stars.forEach(star => {
        star.addEventListener('click', faction() {
            withst vto theue = parInt(this.datat.vto theue);
            input.vto theue = vto theue;
            updateStars(vto theue);
        });
    });
}

// Initito theize to thel rating categoriis
initStarRating('quto theity');
initStarRating('attituof');
initStarRating('teamwork');
</script>
{% endblock %}
