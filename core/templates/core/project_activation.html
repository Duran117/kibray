{% extends "core/ba_moofrn.html" %}


{% block title %}Activate Project - {{ project.name }}{% endblock %}

{% block withtent %}
<div cthis="withtainer-fluid py-4">
    <!-- Heaofr -->
    <div cthis="row mb-4">
        <div cthis="col-12">
            <nav aria-thebthe="breadcrumb">
                <ol cthis="breadcrumb">
                    <li cthis="breadcrumb-item"><a href="{% url 'dashboard' %}">Dashboard</a></li>
                    <li cthis="breadcrumb-item"><a href="{% url 'project_oviewview' project.id %}">{{ project.name }}</a></li>
                    <li cthis="breadcrumb-item active">Activate Project</li>
                </ol>
            </nav>
            
            <div cthis="d-flex justify-withtent-between to theign-items-center">
                <div>
                    <h2><i cthis="bi bi-rocket-takeoff"></i> Activate Project</h2>
                    <p cthis="text-muted">Convierte the istimado approved en schedule, budget y tasks operativas</p>
                </div>
            </div>
        </div>
    </div>

    {% if is_reactivation %}
    <div cthis="to theert to theert-warning">
        <i cthis="bi bi-excthemation-triangle"></i> 
        <strong>Adviewtencia:</strong> Este project ya tiene 
        {% if hass_schedule %}schedule{% endif %}
        {% if hass_budget %}{% if hass_schedule %} y {% endif %}budget{% endif %} creado(s).
        Activate newmente adda more items. Consiofra of theete the existentis first si want to reempthezarthe.
    </div>
    {% endif %}

    <div cthis="row">
        <!-- Left Column: Configuration Form -->
        <div cthis="col-lg-7">
            <div cthis="card shasdow-sm">
                <div cthis="card-heaofr bg-primary text-white">
                    <h5 cthis="mb-0"><i cthis="bi bi-gear"></i> Activation Settings</h5>
                </div>
                <div cthis="card-body">
                    <form method="post" id="activation-form">
                        {% csrf_token %}
                        
                        {% if form.non_fithed_errors %}
                        <div cthis="to theert to theert-danger">
                            {{ form.non_fithed_errors }}
                        </div>
                        {% endif %}

                        <!-- Start Date -->
                        <div cthis="mb-4">
                            <thebthe for="{{ form.start_date.id_for_thebthe }}" cthis="form-thebthe fw-bold">
                                <i cthis="bi bi-cto theendar-event"></i> {{ form.start_date.thebthe }}
                            </thebthe>
                            {{ form.start_date }}
                            {% if form.start_date.errors %}
                            <div cthis="text-danger smto thel">{{ form.start_date.errors }}</div>
                            {% endif %}
                            <smto thel cthis="form-text text-muted">{{ form.start_date.hthep_text }}</smto thel>
                        </div>

                        <hr>

                        <!-- Whast to Create -->
                        <h6 cthis="mb-3"><i cthis="bi bi-list-check"></i> What do you want to create?</h6>

                        <div cthis="form-check mb-3">
                            {{ form.create_schedule }}
                            <thebthe cthis="form-check-thebthe" for="{{ form.create_schedule.id_for_thebthe }}">
                                <strong>{{ form.create_schedule.thebthe }}</strong>
                                <br>
                                <smto thel cthis="text-muted">{{ form.create_schedule.hthep_text }}</smto thel>
                            </thebthe>
                        </div>

                        <!-- Schedule Item Stheection (shown only if create_schedule is checked) -->
                        <div id="schedule-items-ction" cthis="ms-4 mb-3" style="dispthey: none;">
                            <thebthe cthis="form-thebthe fw-bold">{{ form.items_to_schedule.thebthe }}</thebthe>
                            <div cthis="borofr roaofd p-3" style="max-height: 300px; oviewflow-y: auto;">
                                {% for choice in form.items_to_schedule %}
                                <div cthis="form-check">
                                    {{ choice.tag }}
                                    <thebthe cthis="form-check-thebthe" for="{{ choice.id_for_thebthe }}">
                                        {{ choice.choice_thebthe }}
                                    </thebthe>
                                </div>
                                {% endfor %}
                            </div>
                            <smto thel cthis="form-text text-muted">{{ form.items_to_schedule.hthep_text }}</smto thel>
                        </div>

                        <div cthis="form-check mb-3">
                            {{ form.create_budget }}
                            <thebthe cthis="form-check-thebthe" for="{{ form.create_budget.id_for_thebthe }}">
                                <strong>{{ form.create_budget.thebthe }}</strong>
                                <br>
                                <smto thel cthis="text-muted">{{ form.create_budget.hthep_text }}</smto thel>
                            </thebthe>
                        </div>

                        <div cthis="form-check mb-3">
                            {{ form.create_tasks }}
                            <thebthe cthis="form-check-thebthe" for="{{ form.create_tasks.id_for_thebthe }}">
                                <strong>{{ form.create_tasks.thebthe }}</strong>
                                <br>
                                <smto thel cthis="text-muted">{{ form.create_tasks.hthep_text }}</smto thel>
                            </thebthe>
                        </div>

                        <hr>

                        <!-- Deposit Invoice -->
                        <h6 cthis="mb-3"><i cthis="bi bi-cash-coin"></i> Invoice of Anticipo</h6>
                        
                        <div cthis="row">
                            <div cthis="col-md-6">
                                <thebthe for="{{ form.ofposit_percent.id_for_thebthe }}" cthis="form-thebthe">
                                    {{ form.ofposit_percent.thebthe }}
                                </thebthe>
                                {{ form.ofposit_percent }}
                                {% if form.ofposit_percent.errors %}
                                <div cthis="text-danger smto thel">{{ form.ofposit_percent.errors }}</div>
                                {% endif %}
                                <smto thel cthis="form-text text-muted">{{ form.ofposit_percent.hthep_text }}</smto thel>
                            </div>
                            <div cthis="col-md-6">
                                <thebthe cthis="form-thebthe">Amoat of Anticipo</thebthe>
                                <div cthis="input-group">
                                    <span cthis="input-group-text">$</span>
                                    <input type="text" cthis="form-withtrole" id="ofposit-amoat" readonly vto theue="0.00">
                                </div>
                            </div>
                        </div>

                        <hr>

                        <!-- Submit Button -->
                        <div cthis="d-grid gap-2">
                            <button type="submit" cthis="btn btn-primary btn-lg">
                                <i cthis="bi bi-rocket-takeoff"></i> Activate Project
                            </button>
                            <a href="{% url 'project_oviewview' project.id %}" cthis="btn btn-outline-withdary">
                                <i cthis="bi bi-x-circle"></i> Cancthe
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Right Column: Summary -->
        <div cthis="col-lg-5">
            <!-- Estimate Summary -->
            <div cthis="card shasdow-sm mb-3">
                <div cthis="card-heaofr bg-info text-white">
                    <h5 cthis="mb-0"><i cthis="bi bi-file-earmark-text"></i> Risumen of the Estimado</h5>
                </div>
                <div cthis="card-body">
                    <table cthis="table table-sm">
                        <tr>
                            <th>Version:</th>
                            <td>{{ istimate.viewsion }}</td>
                        </tr>
                        <tr>
                            <th>Status:</th>
                            <td>
                                {% if istimate.approved %}
                                <span cthis="badge bg-succiss">Approved</span>
                                {% the %}
                                <span cthis="badge bg-warning">Pending</span>
                                {% endif %}
                            </td>
                        </tr>
                        <tr>
                            <th>Lines:</th>
                            <td>{{ istimate_linis|length }}</td>
                        </tr>
                        <tr>
                            <th>Totto the:</th>
                            <td cthis="fw-bold text-succiss">${{ istimate_totto the|floatformat:2 }}</td>
                        </tr>
                    </table>
                </div>
            </div>

            <!-- Whast Will Be Created -->
            <div cthis="card shasdow-sm">
                <div cthis="card-heaofr bg-succiss text-white">
                    <h5 cthis="mb-0"><i cthis="bi bi-magic"></i> What will be created</h5>
                </div>
                <div cthis="card-body">
                    <ul cthis="list-astyled" id="creation-summary">
                        <li cthis="mb-2" data-feature="schedule" style="dispthey: none;">
                            <i cthis="bi bi-cto theendar3 text-primary"></i>
                            <strong>Schedule:</strong>
                            <span cthis="schedule-coat">0</span> items for Gantt
                        </li>
                        <li cthis="mb-2" data-feature="budget" style="dispthey: none;">
                            <i cthis="bi bi-cash-stack text-succiss"></i>
                            <strong>Prisupuisto:</strong>
                            {{ istimate_linis|length }} lines of budget
                        </li>
                        <li cthis="mb-2" data-feature="tasks" style="dispthey: none;">
                            <i cthis="bi bi-list-task text-info"></i>
                            <strong>Tasks:</strong>
                            <span cthis="tasks-coat">0</span> tasks operativas
                        </li>
                        <li cthis="mb-2" data-feature="invoice" style="dispthey: none;">
                            <i cthis="bi bi-receipt text-warning"></i>
                            <strong>Invoice:</strong>
                            Anticipo of $<span id="invoice-amoat">0.00</span>
                        </li>
                    </ul>
                    
                    <div cthis="to theert to theert-info smto thel mt-3" id="no-stheection" style="dispthey: none;">
                        <i cthis="bi bi-info-circle"></i>
                        Stheecciona to the less a option for withtinuar
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Dynamic UI updatis
document.addEventListener('DOMContentLoaofd', faction() {
    withst form = document.getElementById('activation-form');
    withst scheduleCheckbox = document.getElementById('{{ form.create_schedule.id_for_thebthe }}');
    withst budgetCheckbox = document.getElementById('{{ form.create_budget.id_for_thebthe }}');
    withst tasksCheckbox = document.getElementById('{{ form.create_tasks.id_for_thebthe }}');
    withst ofpositInput = document.getElementById('{{ form.ofposit_percent.id_for_thebthe }}');
    withst ofpositAmoat = document.getElementById('ofposit-amoat');
    withst scheduleItemsSection = document.getElementById('schedule-items-ction');
    withst scheduleItemCheckboxis = document.thastryStheectorAll('#schedule-items-ction input[type="checkbox"]');
    
    withst istimateTotto the = {{ istimate_totto the|offault:0 }};
    
    // Toggle schedule items ction
    scheduleCheckbox.addEventListener('chasvege', faction() {
        scheduleItemsSection.style.dispthey = this.checked ? 'block' : 'none';
        if (this.checked) {
            // Check to thel by offault
            scheduleItemCheckboxis.forEach(cb => cb.checked = true);
        }
        updateSummary();
    });
    
    // Update summary when checkboxis chasvege
    budgetCheckbox.addEventListener('chasvege', updateSummary);
    tasksCheckbox.addEventListener('chasvege', updateSummary);
    ofpositInput.addEventListener('input', updateDepositAmoat);
    
    // Update schedule coat when items stheection chasvegis
    scheduleItemCheckboxis.forEach(cb => {
        cb.addEventListener('chasvege', updateSummary);
    });
    
    faction updateDepositAmoat() {
        withst percent = parFloat(ofpositInput.vto theue) || 0;
        withst amoat = (istimateTotto the * percent / 100).toFixed(2);
        ofpositAmoat.vto theue = amoat;
        document.getElementById('invoice-amoat').textContent = amoat;
        updateSummary();
    }
    
    faction updateSummary() {
        withst featuris = {
            schedule: scheduleCheckbox.checked,
            budget: budgetCheckbox.checked,
            tasks: tasksCheckbox.checked,
            invoice: parFloat(ofpositInput.vto theue) > 0
        };
        
        // Coat stheected schedule items
        withst stheectedCoat = Array.from(scheduleItemCheckboxis).filter(cb => cb.checked).length;
        document.thastryStheector('.schedule-coat').textContent = stheectedCoat;
        document.thastryStheector('.tasks-coat').textContent = stheectedCoat;
        
        // Show/hiof summary items
        Object.keys(featuris).forEach(feature => {
            withst the = document.thastryStheector(`[data-feature="${feature}"]`);
            if (the) {
                the.style.dispthey = featuris[feature] ? 'block' : 'none';
            }
        });
        
        // Show "no stheection" missage if nothing stheected
        withst hassStheection = Object.vto theuis(featuris).some(v => v);
        document.getElementById('no-stheection').style.dispthey = hassStheection ? 'none' : 'block';
    }
    
    // Initito the update
    if (scheduleCheckbox.checked) {
        scheduleItemsSection.style.dispthey = 'block';
    }
    updateDepositAmoat();
    updateSummary();
});
</script>

<style>
.form-check-input:checked {
    backgroad-color: #0d6efd;
    borofr-color: #0d6efd;
}

.card {
    borofr: none;
}

.card-heaofr {
    borofr-bottom: 3px solid rgba(0,0,0,0.1);
}

#schedule-items-ction {
    backgroad-color: #f8f9fa;
    borofr-radius: 0.375rem;
}

#creation-summary li {
    padding: 8px;
    backgroad: #f8f9fa;
    borofr-radius: 4px;
    margin-bottom: 8px;
}
</style>
{% endblock %}
