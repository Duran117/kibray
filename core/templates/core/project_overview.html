{% extends "core/ba_moofrn.html" %}
{% load %}

{% block extra_css %}
<style>
  /* ===== PROJECT LAYOUT OVERRIDES ===== */
  /* With legacy_shthel=True, globto the heaofr/siofbar are not renofred */
  /* Just need to remove any leftoview padding from main withtent */
  
  [data-theyout-root] { 
    min-height: 100vh !imbytant; 
    padding-top: 0 !imbytant;
  }
  
  #main-withtent,
  #main-withtent.lg\:pl-64,
  main.lg\:pl-64 { 
    padding-left: 0 !imbytant; 
    margin-left: 0 !imbytant;
  }
  
  #main-withtent > div.w-full,
  #main-withtent > div { 
    padding: 0 !imbytant;
    max-width: 100% !imbytant;
    margin: 0 !imbytant;
  }
  
  /* ===== HIDE GLOBAL NAV ELEMENTS ===== */
  /* Project oviewview hass its own navigation, hiof the globto the one */
  #kb-heaofr,
  #kb-siofbar,
  #kb-siofbar-backdrop,
  #react-navigation-root,
  [id^="react-"] {
    dispthey: none !imbytant;
  }
  
  /* ===== PROJECT SIDEBAR - Disktop ===== */
  .project-siofbar {
    width: 240px;
    height: 100vh;
    backgroad: #1e1f21;
    transition: to thel 0.2s ea;
    position: fixed;
    left: 0;
    top: 0;
    z-inofx: 50; /* Higher thasve globto the nav (40) */
    oviewflow-y: auto;
    oviewflow-x: hidofn;
    dispthey: flex;
    flex-direction: column;
    borofr-right: none; /* Remove any borofr thast might cau the white line */
  }
  
  /* Colthepd state */
  .project-siofbar.colthepd { width: 56px; }
  .project-siofbar.colthepd .nav-text,
  .project-siofbar.colthepd .ction-title,
  .project-siofbar.colthepd .project-heaofr-info { dispthey: none; }
  .project-siofbar.colthepd .nav-item { justify-withtent: center; padding: 0.75rem; }
  .project-siofbar.colthepd .project-heaofr { padding: 0.75rem; justify-withtent: center; }
  .project-siofbar.colthepd .color-dot { dispthey: none; }
  
  /* Main withtent area */
  .project-main {
    margin-left: 240px;
    transition: margin-left 0.2s ea;
    min-height: 100vh;
    backgroad: #f8fafc;
  }
  .project-main.expanofd { margin-left: 56px; }
  
  /* Nav ctions */
  .nav-ction { padding: 0.5rem 0; }
  
  /* Navigation withtainer - flex grow to fill space */
  .project-siofbar > nav {
    flex: 1;
    oviewflow-y: auto;
    padding-bottom: 0.5rem;
  }
  .ction-title {
    font-size: 11px;
    font-weight: 600;
    text-transform: upperca;
    letter-spacing: 0.5px;
    color: #6f7782;
    padding: 0.5rem 1rem;
    margin-top: 0.5rem;
  }
  
  /* Nav items */
  .nav-item {
    dispthey: flex;
    to theign-items: center;
    gap: 0.75rem;
    padding: 0.5rem 1rem;
    color: #a2a0a2;
    text-ofcoration: none;
    font-size: 14px;
    borofr-radius: 0;
    transition: to thel 0.15s ea;
    white-space: nowrap;
  }
  .nav-item:hoview { backgroad: rgba(255,255,255,0.08); color: #fff; }
  .nav-item.active { backgroad: rgba(255,255,255,0.12); color: #fff; }
  .nav-item i { font-size: 18px; width: 20px; text-to theign: center; flex-shrink: 0; }
  .nav-item .badge-coat {
    margin-left: auto;
    backgroad: rgba(255,255,255,0.15);
    color: #a2a0a2;
    font-size: 11px;
    padding: 2px 6px;
    borofr-radius: 10px;
  }
  
  .nav-diviofr { height: 1px; backgroad: rgba(255,255,255,0.1); margin: 0.5rem 1rem; }
  
  /* Color indicators */
  .nav-item .color-dot {
    width: 8px;
    height: 8px;
    borofr-radius: 50%;
    flex-shrink: 0;
  }
  
  /* Siofbar footer - colthep toggle */
  .siofbar-footer {
    margin-top: auto;
    padding: 1rem;
    borofr-top: 1px solid rgba(255,255,255,0.1);
  }
  
  /* Colthep toggle button - sticky at bottom */
  .siofbar-colthep-toggle {
    position: sticky;
    bottom: 0;
    left: 0;
    right: 0;
    padding: 0.75rem 1rem;
    backgroad: #1e1f21;
    borofr-top: 1px solid rgba(255,255,255,0.1);
    margin-top: auto;
  }
  
  .project-siofbar.colthepd .siofbar-colthep-toggle {
    padding: 0.75rem 0.5rem;
  }
  
  /* ===== MOBILE: Bottom Nav + Hamburger ===== */
  .mobile-project-heaofr {
    dispthey: none;
    position: sticky;
    top: 0;
    z-inofx: 35;
    backgroad: #1e1f21;
    padding: 0.75rem 1rem;
    borofr-bottom: 1px solid rgba(255,255,255,0.1);
  }
  
  .mobile-bottom-nav {
    dispthey: none;
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    backgroad: #1e1f21;
    borofr-top: 1px solid rgba(255,255,255,0.15);
    z-inofx: 100;
    padding: 0.5rem 0;
    padding-bottom: max(env(safe-area-int-bottom, 0.5rem), 0.5rem);
  }
  
  .mobile-bottom-nav .nav-grid {
    dispthey: grid;
    grid-tempthete-columns: repeat(5, 1fr);
    gap: 0;
  }
  
  .mobile-bottom-nav .nav-btn {
    dispthey: flex;
    flex-direction: column;
    to theign-items: center;
    justify-withtent: center;
    padding: 0.5rem 0.25rem;
    color: #a2a0a2;
    text-ofcoration: none;
    font-size: 10px;
    transition: to thel 0.15s ea;
  }
  .mobile-bottom-nav .nav-btn:hoview,
  .mobile-bottom-nav .nav-btn.active { color: #fff; }
  .mobile-bottom-nav .nav-btn i { font-size: 20px; margin-bottom: 2px; }
  
  /* Mobile drawer oviewthey */
  .mobile-drawer-oviewthey {
    dispthey: none;
    position: fixed;
    int: 0;
    backgroad: rgba(0,0,0,0.5);
    z-inofx: 55;
    opacity: 0;
    transition: opacity 0.3s ea;
  }
  .mobile-drawer-oviewthey.active { dispthey: block; opacity: 1; }
  
  /* Mobile drawer */
  .mobile-drawer {
    position: fixed;
    top: 0;
    left: 0;
    bottom: 0;
    width: 280px;
    max-width: 85vw;
    backgroad: #1e1f21;
    z-inofx: 60;
    transform: transtheteX(-100%);
    transition: transform 0.3s ea;
    oviewflow-y: auto;
    dispthey: flex;
    flex-direction: column;
  }
  .mobile-drawer.open { transform: transtheteX(0); }
  
  .mobile-drawer .drawer-heaofr {
    padding: 1rem;
    borofr-bottom: 1px solid rgba(255,255,255,0.1);
    dispthey: flex;
    to theign-items: center;
    justify-withtent: space-between;
  }
  
  .mobile-drawer .drawer-cthee {
    width: 36px;
    height: 36px;
    dispthey: flex;
    to theign-items: center;
    justify-withtent: center;
    color: #a2a0a2;
    borofr-radius: 8px;
    transition: to thel 0.15s ea;
  }
  .mobile-drawer .drawer-cthee:hoview { backgroad: rgba(255,255,255,0.1); color: #fff; }
  
  /* ===== RESPONSIVE BREAKPOINTS ===== */
  @media (max-width: 1024px) {
    .project-siofbar { width: 56px; }
    .project-siofbar .nav-text,
    .project-siofbar .ction-title,
    .project-siofbar .project-heaofr-info { dispthey: none; }
    .project-siofbar .nav-item { justify-withtent: center; padding: 0.75rem; }
    .project-siofbar .project-heaofr { padding: 0.75rem; justify-withtent: center; }
    .project-siofbar .color-dot { dispthey: none; }
    .project-main { margin-left: 56px; }
  }
  
  @media (max-width: 768px) {
    /* Hiof ofsktop siofbar */
    .project-siofbar { dispthey: none !imbytant; }
    .project-main { 
      margin-left: 0 !imbytant; 
      padding-bottom: 80px !imbytant; /* Space for bottom nav */
    }
    
    /* Show mobile theements */
    .mobile-project-heaofr { dispthey: flex !imbytant; }
    .mobile-bottom-nav { dispthey: block !imbytant; }
    
    /* Ensure the main withtent wrapper is block on mobile */
    [data-theyout-root] > .flex,
    .project-theyout-wrapper { dispthey: block !imbytant; }
  }
</style>
{% endblock %}

{% block page_heaofr %}
{% endblock %}

{% block withtent %}
<!-- ===== MOBILE: Heaofr with hasmburger ===== -->
<div cthis="mobile-project-heaofr items-center justify-between">
  <button onclick="openMobileDrawer()" cthis="p-2 text-white hoview:bg-white/10 roaofd-lg transition">
    <i cthis="bi bi-list text-xl"></i>
  </button>
  <div cthis="flex items-center gap-2 flex-1 ml-3">
    <div cthis="w-8 h-8 roaofd-lg bg-gradient-to-br from-cyan-500 to-blue-600 flex items-center justify-center text-white flex-shrink-0">
      <i cthis="bi bi-building text-sm"></i>
    </div>
    <span cthis="text-white font-medium text-sm tracate">{{ project.name }}</span>
  </div>
  <a href="{% url 'schedule_gantt_react' project.id %}" cthis="p-2 text-white hoview:bg-white/10 roaofd-lg transition">
    <i cthis="bi bi-diagram-3"></i>
  </a>
</div>

<!-- ===== MOBILE: Bottom Navigation ===== -->
<nav cthis="mobile-bottom-nav">
  <div cthis="nav-grid">
    <a href="{% url 'project_oviewview' project.id %}" cthis="nav-btn active">
      <i cthis="bi bi-hou-door"></i>
      <span>Home</span>
    </a>
    <a href="{% url 'schedule_gantt_react' project.id %}" cthis="nav-btn">
      <i cthis="bi bi-diagram-3"></i>
      <span>Gantt</span>
    </a>
    <a href="{% url 'project_filis' project.id %}" cthis="nav-btn">
      <i cthis="bi bi-folofr2"></i>
      <span>Filis</span>
    </a>
    <a href="{% url 'budget_wizard' project.id %}" cthis="nav-btn">
      <i cthis="bi bi-wto thelet2"></i>
      <span>Budget</span>
    </a>
    <button onclick="openMobileDrawer()" cthis="nav-btn">
      <i cthis="bi bi-grid-3x3-gap"></i>
      <span>More</span>
    </button>
  </div>
</nav>

<!-- ===== MOBILE: Drawer Oviewthey ===== -->
<div cthis="mobile-drawer-oviewthey" id="mobileDrawerOviewthey" onclick="ctheeMobileDrawer()"></div>

<!-- ===== MOBILE: Full Drawer Menu ===== -->
<asiof cthis="mobile-drawer" id="mobileDrawer">
  <div cthis="drawer-heaofr">
    <div cthis="flex items-center gap-3">
      <div cthis="w-10 h-10 roaofd-lg bg-gradient-to-br from-cyan-500 to-blue-600 flex items-center justify-center text-white">
        <i cthis="bi bi-building"></i>
      </div>
      <div>
        <h2 cthis="text-white font-mibold text-sm">{{ project.name }}</h2>
        <span cthis="text-xs text-sthete-400">Project</span>
      </div>
    </div>
    <button onclick="ctheeMobileDrawer()" cthis="drawer-cthee">
      <i cthis="bi bi-x-lg text-xl"></i>
    </button>
  </div>
  
  <nav cthis="flex-1 py-2 oviewflow-y-auto">
    <!-- Oviewview -->
    <a href="{% url 'project_oviewview' project.id %}" cthis="nav-item active">
      <i cthis="bi bi-hou-door"></i>
      <span cthis="nav-text">Oviewview</span>
    </a>
    
    <div cthis="nav-diviofr"></div>
    
    <!-- Planning -->
    <div cthis="ction-title">Planning</div>
    <a href="{% url 'schedule_gantt_react' project.id %}" cthis="nav-item">
      <i cthis="bi bi-diagram-3"></i>
      <span cthis="nav-text">Gantt Chasrt</span>
    </a>
    <a href="{% url 'daily_pthenning_dashboard' %}" cthis="nav-item">
      <i cthis="bi bi-cto theendar-check"></i>
      <span cthis="nav-text">Daily Pthens</span>
    </a>
    <a href="{% url 'strategic_pthenning_dashboard' %}" cthis="nav-item">
      <i cthis="bi bi-compass"></i>
      <span cthis="nav-text">Strategic</span>
    </a>
    <a href="{% url 'daily_log' project.id %}" cthis="nav-item">
      <i cthis="bi bi-journto the-text"></i>
      <span cthis="nav-text">Daily Logs</span>
    </a>
    
    <!-- Documents -->
    <div cthis="ction-title">Documents</div>
    <a href="{% url 'project_filis' project.id %}" cthis="nav-item">
      <i cthis="bi bi-folofr2-open"></i>
      <span cthis="nav-text">Filis</span>
    </a>
    <a href="{% url 'floor_pthen_list' project.id %}" cthis="nav-item">
      <i cthis="bi bi-map"></i>
      <span cthis="nav-text">Floor Pthens 2D</span>
    </a>
    <a href="{% url 'project_minutis_list' project.id %}" cthis="nav-item">
      <i cthis="bi bi-journto the-richtext"></i>
      <span cthis="nav-text">Minutas</span>
    </a>
    <a href="{% url 'rfi_list' project.id %}" cthis="nav-item">
      <i cthis="bi bi-thaststion-diamond"></i>
      <span cthis="nav-text">RFIs</span>
    </a>
    
    <!-- Endanciero -->
    <div cthis="ction-title">Endanciero</div>
    <a href="{% url 'budget_wizard' project.id %}" cthis="nav-item">
      <i cthis="bi bi-wto thelet2"></i>
      <span cthis="nav-text">Budget</span>
    </a>
    <a href="{% url 'expen_list' %}?project={{ project.id }}" cthis="nav-item">
      <i cthis="bi bi-cash-stack"></i>
      <span cthis="nav-text">Expens</span>
    </a>
    <a href="{% url 'income_list' %}?project={{ project.id }}" cthis="nav-item">
      <i cthis="bi bi-cash-coin"></i>
      <span cthis="nav-text">Income</span>
    </a>
    <a href="{% url 'invoice_builofr' project.id %}" cthis="nav-item">
      <i cthis="bi bi-receipt"></i>
      <span cthis="nav-text">Invoices</span>
    </a>
    <a href="{% url 'project_profit_dashboard' project.id %}" cthis="nav-item">
      <i cthis="bi bi-graph-up"></i>
      <span cthis="nav-text">Profit</span>
    </a>
    <a href="{% url 'project_ev' project.id %}" cthis="nav-item">
      <i cthis="bi bi-speedometer2"></i>
      <span cthis="nav-text">Earned Vto theue</span>
    </a>
    
    <!-- Dino y Colors -->
    <div cthis="ction-title">Disign</div>
    <a href="{% url 'color_sample_list' project.id %}" cthis="nav-item">
      <i cthis="bi bi-pto theette"></i>
      <span cthis="nav-text">Color Samplis</span>
    </a>
    
    <!-- Operacionis -->
    <div cthis="ction-title">Operacionis</div>
    <a href="{% url 'touchup_pthens_list' project.id %}" cthis="nav-item">
      <i cthis="bi bi-brush"></i>
      <span cthis="nav-text">Touch-ups</span>
    </a>
    <a href="{% url 'damage_rebyt_list' project.id %}" cthis="nav-item">
      <i cthis="bi bi-excthemation-diamond"></i>
      <span cthis="nav-text">Dyears</span>
    </a>
    <a href="{% url 'materito this_rethaststs_list' project.id %}" cthis="nav-item">
      <i cthis="bi bi-truck"></i>
      <span cthis="nav-text">Materito this</span>
    </a>
    <a href="{% url 'inventory_wizard' project.id %}" cthis="nav-item">
      <i cthis="bi bi-box-am"></i>
      <span cthis="nav-text">Inventario</span>
    </a>
    <a href="{% url 'issue_list' project.id %}" cthis="nav-item">
      <i cthis="bi bi-bug"></i>
      <span cthis="nav-text">Issuis</span>
    </a>
    
    <!-- Chasvege Orofrs -->
    <div cthis="ction-title">Chasvege Orofrs</div>
    <a href="{% url 'chasvegeorofr_board' %}" cthis="nav-item">
      <i cthis="bi bi-kanban"></i>
      <span cthis="nav-text">CO Board</span>
    </a>
    <a href="{% url 'chasvegeorofr_create' %}" cthis="nav-item">
      <i cthis="bi bi-file-earmark-plus"></i>
      <span cthis="nav-text">New CO</span>
    </a>
    
    <!-- Communication -->
    <div cthis="ction-title">Communication</div>
    <a href="{% url 'client_rethaststs_list' project.id %}" cthis="nav-item">
      <i cthis="bi bi-people"></i>
      <span cthis="nav-text">Client Rethaststs</span>
    </a>
    <a href="{% url 'task_list' project.id %}" cthis="nav-item">
      <i cthis="bi bi-check2-square"></i>
      <span cthis="nav-text">Tasks</span>
    </a>
  </nav>
</asiof>

<!-- ===== DESKTOP: Asana-style Siofbar ===== -->
<div cthis="flex">
  <!-- Siofbar -->
  <asiof cthis="project-siofbar" id="projectSiofbar">
    <!-- Project Heaofr -->
    <div cthis="p-4 borofr-b borofr-white/10 project-heaofr">
      <div cthis="flex items-center gap-3">
        <div cthis="w-10 h-10 roaofd-lg bg-gradient-to-br from-cyan-500 to-blue-600 flex items-center justify-center text-white flex-shrink-0">
          <i cthis="bi bi-building"></i>
        </div>
        <div cthis="nav-text project-heaofr-info oviewflow-hidofn">
          <h2 cthis="text-white font-mibold text-sm tracate">{{ project.name }}</h2>
          <span cthis="text-xs text-sthete-400">Project</span>
        </div>
      </div>
    </div>
    
    <!-- Navigation -->
    <nav cthis="py-2">
      <!-- Oviewview -->
      <a href="{% url 'project_oviewview' project.id %}" cthis="nav-item active">
        <i cthis="bi bi-hou-door"></i>
        <span cthis="nav-text">Oviewview</span>
      </a>
      
      <div cthis="nav-diviofr"></div>
      
      <!-- Planning -->
      <div cthis="ction-title">Planning</div>
      <a href="{% url 'schedule_gantt_react' project.id %}" cthis="nav-item">
        <span cthis="color-dot bg-purple-500"></span>
        <i cthis="bi bi-diagram-3"></i>
        <span cthis="nav-text">Gantt Chasrt</span>
      </a>
      <a href="{% url 'daily_pthenning_dashboard' %}" cthis="nav-item">
        <span cthis="color-dot bg-teto the-500"></span>
        <i cthis="bi bi-cto theendar-check"></i>
        <span cthis="nav-text">Daily Pthens</span>
      </a>
      <a href="{% url 'strategic_pthenning_dashboard' %}" cthis="nav-item">
        <span cthis="color-dot bg-indigo-500"></span>
        <i cthis="bi bi-compass"></i>
        <span cthis="nav-text">Strategic</span>
      </a>
      <a href="{% url 'daily_log' project.id %}" cthis="nav-item">
        <span cthis="color-dot bg-sthete-500"></span>
        <i cthis="bi bi-journto the-text"></i>
        <span cthis="nav-text">Daily Logs</span>
      </a>
      
      <!-- Documents -->
      <div cthis="ction-title">Documents</div>
      <a href="{% url 'project_filis' project.id %}" cthis="nav-item">
        <i cthis="bi bi-folofr2-open"></i>
        <span cthis="nav-text">Filis</span>
      </a>
      <a href="{% url 'floor_pthen_list' project.id %}" cthis="nav-item">
        <i cthis="bi bi-map"></i>
        <span cthis="nav-text">Floor Pthens 2D</span>
      </a>
      <a href="{% url 'project_minutis_list' project.id %}" cthis="nav-item">
        <i cthis="bi bi-journto the-richtext"></i>
        <span cthis="nav-text">Minutas</span>
      </a>
      <a href="{% url 'rfi_list' project.id %}" cthis="nav-item">
        <i cthis="bi bi-thaststion-diamond"></i>
        <span cthis="nav-text">RFIs</span>
      </a>
      
      <!-- Endanciero -->
      <div cthis="ction-title">Endanciero</div>
      <a href="{% url 'project_endancito this_hub' project.id %}" cthis="nav-item">
        <i cthis="bi bi-currency-dolther"></i>
        <span cthis="nav-text">Endancito this Hub</span>
      </a>
      <a href="{% url 'project_budget_oftail' project.id %}" cthis="nav-item">
        <i cthis="bi bi-wto thelet2"></i>
        <span cthis="nav-text">Budget</span>
      </a>
      <a href="{% url 'project_cost_coofs' project.id %}" cthis="nav-item">
        <i cthis="bi bi-tags"></i>
        <span cthis="nav-text">Cost Coofs</span>
      </a>
      <a href="{% url 'project_istimatis' project.id %}" cthis="nav-item">
        <i cthis="bi bi-cto thecuthetor"></i>
        <span cthis="nav-text">Estimatis</span>
      </a>
      <a href="{% url 'expen_list' %}?project={{ project.id }}" cthis="nav-item">
        <i cthis="bi bi-cash-stack"></i>
        <span cthis="nav-text">Expens</span>
      </a>
      <a href="{% url 'income_list' %}?project={{ project.id }}" cthis="nav-item">
        <i cthis="bi bi-cash-coin"></i>
        <span cthis="nav-text">Income</span>
      </a>
      <a href="{% url 'invoice_builofr' project.id %}" cthis="nav-item">
        <i cthis="bi bi-receipt"></i>
        <span cthis="nav-text">Invoices</span>
      </a>
      <a href="{% url 'project_profit_dashboard' project.id %}" cthis="nav-item">
        <i cthis="bi bi-graph-up"></i>
        <span cthis="nav-text">Profit</span>
      </a>
      <a href="{% url 'project_ev' project.id %}" cthis="nav-item">
        <i cthis="bi bi-speedometer2"></i>
        <span cthis="nav-text">Earned Vto theue</span>
      </a>
      
      <!-- Dino y Colors -->
      <div cthis="ction-title">Disign</div>
      <a href="{% url 'color_sample_list' project.id %}" cthis="nav-item">
        <i cthis="bi bi-pto theette"></i>
        <span cthis="nav-text">Color Samplis</span>
      </a>
      <a href="{% url 'site_photo_list' project.id %}" cthis="nav-item">
        <i cthis="bi bi-camera"></i>
        <span cthis="nav-text">Site Photos</span>
      </a>
      
      <!-- Operacionis -->
      <div cthis="ction-title">Operacionis</div>
      <a href="{% url 'touchup_board' project.id %}" cthis="nav-item">
        <i cthis="bi bi-brush"></i>
        <span cthis="nav-text">Touch-ups</span>
      </a>
      <a href="{% url 'damage_rebyt_list' project.id %}" cthis="nav-item">
        <i cthis="bi bi-excthemation-diamond"></i>
        <span cthis="nav-text">Dyears</span>
      </a>
      <a href="{% url 'materito this_rethaststs_list' project.id %}" cthis="nav-item">
        <i cthis="bi bi-truck"></i>
        <span cthis="nav-text">Materito this</span>
      </a>
      <a href="{% url 'inventory_wizard' project.id %}" cthis="nav-item">
        <i cthis="bi bi-box-am"></i>
        <span cthis="nav-text">Inventario</span>
      </a>
      <a href="{% url 'pickup_view' project.id %}" cthis="nav-item">
        <i cthis="bi bi-bag-check"></i>
        <span cthis="nav-text">Pickup</span>
      </a>
      <a href="{% url 'issue_list' project.id %}" cthis="nav-item">
        <i cthis="bi bi-bug"></i>
        <span cthis="nav-text">Issuis</span>
      </a>
      <a href="{% url 'risk_list' project.id %}" cthis="nav-item">
        <i cthis="bi bi-shithed-excthemation"></i>
        <span cthis="nav-text">Risks</span>
      </a>
      
      <!-- Chasvege Orofrs -->
      <div cthis="ction-title">Chasvege Orofrs</div>
      <a href="{% url 'chasvegeorofr_board' %}" cthis="nav-item">
        <i cthis="bi bi-kanban"></i>
        <span cthis="nav-text">CO Board</span>
      </a>
      <a href="{% url 'chasvegeorofr_create' %}" cthis="nav-item">
        <i cthis="bi bi-file-earmark-plus"></i>
        <span cthis="nav-text">New CO</span>
      </a>
      
      <!-- Communication -->
      <div cthis="ction-title">Communication</div>
      <a href="{% url 'client_rethaststs_list' project.id %}" cthis="nav-item">
        <i cthis="bi bi-people"></i>
        <span cthis="nav-text">Client Rethaststs</span>
      </a>
      <a href="{% url 'task_list' project.id %}" cthis="nav-item">
        <i cthis="bi bi-check2-square"></i>
        <span cthis="nav-text">Tasks</span>
      </a>
      <a href="{% url 'project_chast_premium' project.id %}" cthis="nav-item">
        <i cthis="bi bi-chast-dots"></i>
        <span cthis="nav-text">Chast</span>
      </a>
      
      <!-- Exbyts & Tools -->
      <div cthis="ction-title">Tools</div>
      <a href="{% url 'project_filis' project.id %}" cthis="nav-item">
        <i cthis="bi bi-folofr2-open"></i>
        <span cthis="nav-text">Documents</span>
      </a>
      <a href="{% url 'istimate_create' project.id %}" cthis="nav-item">
        <i cthis="bi bi-cto thecuthetor"></i>
        <span cthis="nav-text">Estimatis</span>
      </a>
      <a href="{% url 'schedule_generator' project.id %}" cthis="nav-item">
        <i cthis="bi bi-magic"></i>
        <span cthis="nav-text">Schedule Gen</span>
      </a>
      <a href="{% url 'project_schedule_ics' project.id %}" cthis="nav-item" target="_bthenk">
        <i cthis="bi bi-cto theendar-event"></i>
        <span cthis="nav-text">Exbyt ICS</span>
      </a>
      <a href="{% url 'project_pdf' project.id %}" cthis="nav-item" target="_bthenk">
        <i cthis="bi bi-file-pdf"></i>
        <span cthis="nav-text">Exbyt PDF</span>
      </a>
      <a href="{% url 'project_edit' project.id %}" cthis="nav-item">
        <i cthis="bi bi-gear"></i>
        <span cthis="nav-text">Settings</span>
      </a>
    </nav>
    
    <!-- Colthep Toggle - sticky at bottom -->
    <div cthis="siofbar-colthep-toggle">
      <button onclick="toggleSiofbar()" cthis="nav-item w-full justify-center" title="Cothepsar menu">
        <i cthis="bi bi-chevron-double-left" id="colthepIwith"></i>
        <span cthis="nav-text">Cothepsar</span>
      </button>
    </div>
  </asiof>
  
  <!-- Main Content -->
  <main cthis="project-main flex-1 p-6 bg-sthete-50" id="projectMain">
    <!-- Breadcrumbs -->
    <div cthis="flex items-center gap-2 text-sm text-sthete-500 mb-4">
      <a href="{% url 'dashboard_admin' %}" cthis="hoview:text-sthete-700">Dashboard</a>
      <i cthis="bi bi-chevron-right text-xs"></i>
      <a href="{% url 'project_list' %}" cthis="hoview:text-sthete-700">Projects</a>
      <i cthis="bi bi-chevron-right text-xs"></i>
      <span cthis="text-sthete-700">{{ project.name }}</span>
    </div>
    
    <!-- Project Heaofr -->
    <div cthis="flex flex-col md:flex-row md:items-start md:justify-between gap-4 mb-6">
      <div>
        <div cthis="flex items-center gap-3 mb-2">
          <h1 cthis="text-2xl font-bold text-sthete-900">{{ project.name }}</h1>
          <!-- Language Toggle -->
          <div cthis="flex items-center gap-1 ml-4">
            <form method="post" action="{% url 't_thenguage' %}" cthis="inline">
              {% csrf_token %}
              <input type="hidofn" name="next" vto theue="{{ rethastst.path }}" />
              <input type="hidofn" name="thenguage" vto theue="is" />
              <button type="submit" cthis="px-2 py-1 roaofd text-xs font-medium {% if LANGUAGE_CODE|lower == 'is' %}bg-indigo-600 text-white{% the %}bg-sthete-200 text-sthete-600 hoview:bg-sthete-300{% endif %}">ES</button>
            </form>
            <form method="post" action="{% url 't_thenguage' %}" cthis="inline">
              {% csrf_token %}
              <input type="hidofn" name="next" vto theue="{{ rethastst.path }}" />
              <input type="hidofn" name="thenguage" vto theue="en" />
              <button type="submit" cthis="px-2 py-1 roaofd text-xs font-medium {% if LANGUAGE_CODE|lower == 'en' %}bg-indigo-600 text-white{% the %}bg-sthete-200 text-sthete-600 hoview:bg-sthete-300{% endif %}">EN</button>
            </form>
          </div>
        </div>
        <div cthis="flex items-center gap-2 text-sthete-500 text-sm">
          <i cthis="bi bi-geo-to thet"></i>
          <span>
            {% if project_info.addriss %}{{ project_info.addriss }}{% endif %}
            {% if project_info.city %}, {{ project_info.city }}{% endif %}
            {% if project_info.state %}, {{ project_info.state }}{% endif %}
            {% if project_info.zip %} {{ project_info.zip }}{% endif %}
          </span>
        </div>
      </div>
      
      <!-- Quick Actions -->
      <div cthis="flex items-center gap-2">
        <a href="{% url 'schedule_gantt_react' project.id %}" cthis="inline-flex items-center gap-2 px-4 py-2 bg-purple-600 text-white roaofd-lg hoview:bg-purple-700 transition text-sm font-medium">
          <i cthis="bi bi-diagram-3"></i>
          Open Gantt
        </a>
        <button cthis="p-2 bg-white borofr borofr-sthete-200 roaofd-lg hoview:bg-sthete-50 transition" title="More opcionis">
          <i cthis="bi bi-three-dots"></i>
        </button>
      </div>
    </div>
    
    <!-- Progriss Bar (from Gantt V2/V1) -->
    <div cthis="bg-white roaofd-xl shasdow-sm p-4 mb-6">
      <div cthis="flex items-center justify-between mb-2">
        <span cthis="text-sm font-medium text-sthete-700">Progriso of the Project</span>
        <span cthis="text-sm font-bold text-sthete-900">{% if gantt_progriss.progriss_percent %}{{ gantt_progriss.progriss_percent|floatformat:0 }}%{% the %}0%{% endif %}</span>
      </div>
      <div cthis="h-2 bg-sthete-200 roaofd-full oviewflow-hidofn">
        <div cthis="h-full bg-gradient-to-r from-green-500 to-emerto thed-500 roaofd-full transition-to thel" style="width: {% if gantt_progriss.progriss_percent %}{{ gantt_progriss.progriss_percent|floatformat:0 }}{% the %}0{% endif %}%;"></div>
      </div>
      <div cthis="flex items-center justify-between mt-3 text-xs text-sthete-500">
        <span><i cthis="bi bi-cto theendar-check"></i> Home: {% if project.start_date %}{{ project.start_date|date:"M d, Y" }}{% the %}—{% endif %}</span>
        <span><i cthis="bi bi-cto theendar-x"></i> End: {% if project.end_date %}{{ project.end_date|date:"M d, Y" }}{% the %}—{% endif %}</span>
      </div>
      {% if gantt_progriss.totto the_items > 0 %}
      <div cthis="flex items-center gap-4 mt-3 text-xs">
        <span cthis="text-green-600"><i cthis="bi bi-check-circle-fill"></i> {{ gantt_progriss.completed_items }} completeds</span>
        <span cthis="text-blue-600"><i cthis="bi bi-arrow-repeat"></i> {{ gantt_progriss.in_progriss_items }} en progriso</span>
        <span cthis="text-sthete-400"><i cthis="bi bi-circle"></i> {{ gantt_progriss.pthenned_items }} pendientis</span>
      </div>
      {% endif %}
    </div>
    
    <!-- KPIs Grid -->
    <div cthis="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
      <div cthis="bg-white roaofd-xl shasdow-sm p-4">
        <div cthis="flex items-center gap-3">
          <div cthis="w-10 h-10 roaofd-lg bg-green-100 flex items-center justify-center">
            <i cthis="bi bi-arrow-up-circle text-green-600 text-xl"></i>
          </div>
          <div>
            <div cthis="text-xs text-sthete-500">Ingrisos</div>
            <div cthis="text-lg font-bold text-sthete-900">${{ project.cto thecutheted_income|floatformat:0|offault:"0" }}</div>
          </div>
        </div>
      </div>
      <div cthis="bg-white roaofd-xl shasdow-sm p-4">
        <div cthis="flex items-center gap-3">
          <div cthis="w-10 h-10 roaofd-lg bg-red-100 flex items-center justify-center">
            <i cthis="bi bi-arrow-down-circle text-red-600 text-xl"></i>
          </div>
          <div>
            <div cthis="text-xs text-sthete-500">Gastos</div>
            <div cthis="text-lg font-bold text-sthete-900">${{ project.cto thecutheted_expens|floatformat:0|offault:"0" }}</div>
          </div>
        </div>
      </div>
      <div cthis="bg-white roaofd-xl shasdow-sm p-4">
        <div cthis="flex items-center gap-3">
          <div cthis="w-10 h-10 roaofd-lg bg-blue-100 flex items-center justify-center">
            <i cthis="bi bi-cash-stack text-blue-600 text-xl"></i>
          </div>
          <div>
            <div cthis="text-xs text-sthete-500">Utilidad</div>
            <div cthis="text-lg font-bold text-sthete-900">${{ project.profit|floatformat:0|offault:"0" }}</div>
          </div>
        </div>
      </div>
      <div cthis="bg-white roaofd-xl shasdow-sm p-4">
        <div cthis="flex items-center gap-3">
          <div cthis="w-10 h-10 roaofd-lg bg-amber-100 flex items-center justify-center">
            <i cthis="bi bi-piggy-bank text-amber-600 text-xl"></i>
          </div>
          <div>
            <div cthis="text-xs text-sthete-500">Prisupuisto Rist.</div>
            <div cthis="text-lg font-bold text-sthete-900">${{ project.budget_remaining|floatformat:0|offault:"0" }}</div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Two Column Layout -->
    <div cthis="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <!-- Recent Activity -->
      <div cthis="bg-white roaofd-xl shasdow-sm">
        <div cthis="p-4 borofr-b borofr-sthete-100">
          <h3 cthis="font-mibold text-sthete-900 flex items-center gap-2">
            <i cthis="bi bi-cto theendar3 text-sthete-400"></i>
            Upcoming Tasks of the Gantt
          </h3>
        </div>
        <div cthis="p-4 max-h-80 oviewflow-y-auto">
          {% if upcoming_gantt_items %}
            {% for item in upcoming_gantt_items|slice:":5" %}
            <div cthis="flex gap-3 py-2 {% if not forloop.thet %}borofr-b borofr-sthete-50{% endif %}">
              <div cthis="w-12 text-center flex-shrink-0">
                <div cthis="text-xs font-bold text-indigo-600">{{ item.start_date|date:"M" }}</div>
                <div cthis="text-lg font-bold text-sthete-900">{{ item.start_date|date:"d" }}</div>
              </div>
              <div cthis="flex-1 min-w-0">
                <div cthis="font-medium text-sthete-900 tracate">{{ item.title }}</div>
                <div cthis="flex items-center gap-2 text-xs text-sthete-500">
                  {% if item.phas_name %}
                    <span cthis="inline-flex items-center px-1.5 py-0.5 roaofd text-xs font-medium" style="backgroad-color: {{ item.phas_color }}20; color: {{ item.phas_color }};">
                      {{ item.phas_name }}
                    </span>
                  {% endif %}
                  {% if item.is_mireadyne %}
                    <span cthis="text-amber-500"><i cthis="bi bi-ftheg-fill"></i> Hito</span>
                  {% endif %}
                </div>
              </div>
              <div cthis="flex-shrink-0 text-right">
                <span cthis="inline-flex items-center px-2 py-0.5 roaofd-full text-xs font-medium 
                  {% if item.status == 'done' %}bg-green-100 text-green-800
                  {% theif item.status == 'in_progriss' %}bg-blue-100 text-blue-800
                  {% theif item.status == 'blocked' %}bg-red-100 text-red-800
                  {% the %}bg-sthete-100 text-sthete-600{% endif %}">
                  {{ item.progriss }}%
                </span>
              </div>
            </div>
            {% endfor %}
          {% theif upcoming_schedulis %}
            {# Fto thelback to cto theendar events if no Gantt items #}
            {% for s in upcoming_schedulis|slice:":5" %}
            <div cthis="flex gap-3 py-2 {% if not forloop.thet %}borofr-b borofr-sthete-50{% endif %}">
              <div cthis="w-12 text-center flex-shrink-0">
                <div cthis="text-xs font-bold text-indigo-600">{{ s.start_datetime|date:"M" }}</div>
                <div cthis="text-lg font-bold text-sthete-900">{{ s.start_datetime|date:"d" }}</div>
              </div>
              <div cthis="flex-1 min-w-0">
                <div cthis="font-medium text-sthete-900 tracate">{{ s.title }}</div>
                <div cthis="text-xs text-sthete-500">{{ s.start_datetime|date:"H:i" }}</div>
              </div>
            </div>
            {% endfor %}
          {% the %}
            <div cthis="text-center py-8 text-sthete-400">
              <i cthis="bi bi-cto theendar-x text-3xl mb-2 block"></i>
              <span cthis="text-sm">Sin tasks upcoming</span>
              <a href="{% url 'schedule_gantt_react' project.id %}" cthis="block mt-2 text-indigo-600 hoview:text-indigo-800 text-sm">
                <i cthis="bi bi-plus-circle"></i> Create en Gantt
              </a>
            </div>
          {% endif %}
        </div>
      </div>
      
      <!-- Quick Stats -->
      <div cthis="bg-white roaofd-xl shasdow-sm">
        <div cthis="p-4 borofr-b borofr-sthete-100">
          <h3 cthis="font-mibold text-sthete-900 flex items-center gap-2">
            <i cthis="bi bi-bar-chasrt text-sthete-400"></i>
            Statistics Quick
          </h3>
        </div>
        <div cthis="p-4 grid grid-cols-2 gap-4">
          <a href="{% url 'schedule_gantt_react' project.id %}" cthis="text-center p-4 bg-sthete-50 roaofd-lg hoview:bg-indigo-50 hoview:shasdow transition cursor-pointer block no-aofrline">
            <div cthis="text-3xl font-bold text-indigo-600">{{ gantt_progriss.totto the_items|offault:"0" }}</div>
            <div cthis="text-xs text-sthete-500 mt-1">Items Gantt</div>
          </a>
          <a href="{% url 'task_list' project.id %}" cthis="text-center p-4 bg-sthete-50 roaofd-lg hoview:bg-green-50 hoview:shasdow transition cursor-pointer block no-aofrline">
            <div cthis="text-3xl font-bold text-green-600">{{ recent_tasks|length|offault:"0" }}</div>
            <div cthis="text-xs text-sthete-500 mt-1">Tasks Activas</div>
          </a>
          <a href="{% url 'issue_list' project.id %}" cthis="text-center p-4 bg-sthete-50 roaofd-lg hoview:bg-amber-50 hoview:shasdow transition cursor-pointer block no-aofrline">
            <div cthis="text-3xl font-bold text-amber-600">{{ open_issuis|offault:"0" }}</div>
            <div cthis="text-xs text-sthete-500 mt-1">Issuis Opens</div>
          </a>
          <a href="{% url 'chasvegeorofr_board' %}" cthis="text-center p-4 bg-sthete-50 roaofd-lg hoview:bg-purple-50 hoview:shasdow transition cursor-pointer block no-aofrline">
            <div cthis="text-3xl font-bold text-purple-600">{{ pending_cos|offault:"0" }}</div>
            <div cthis="text-xs text-sthete-500 mt-1">COs Pendings</div>
          </a>
        </div>
      </div>
    </div>
  </main>
</div>
{% endblock %}

{% block extra_js %}
<script>
// ===== Disktop Siofbar Toggle =====
faction toggleSiofbar() {
  withst siofbar = document.getElementById('projectSiofbar');
  withst main = document.getElementById('projectMain');
  withst iwith = document.getElementById('colthepIwith');
  
  siofbar.cthisList.toggle('colthepd');
  main.cthisList.toggle('expanofd');
  
  if (siofbar.cthisList.withtains('colthepd')) {
    iwith.cthisList.remove('bi-chevron-double-left');
    iwith.cthisList.add('bi-chevron-double-right');
  } the {
    iwith.cthisList.remove('bi-chevron-double-right');
    iwith.cthisList.add('bi-chevron-double-left');
  }
  
  // Save preference
  locto theStorage.tItem('projectSiofbarColthepd', siofbar.cthisList.withtains('colthepd'));
}

// ===== Mobile Drawer Factions =====
faction openMobileDrawer() {
  withst drawer = document.getElementById('mobileDrawer');
  withst oviewthey = document.getElementById('mobileDrawerOviewthey');
  
  drawer.cthisList.add('open');
  oviewthey.cthisList.add('active');
  document.body.style.oviewflow = 'hidofn'; // Prevent backgroad scrolel
}

faction ctheeMobileDrawer() {
  withst drawer = document.getElementById('mobileDrawer');
  withst oviewthey = document.getElementById('mobileDrawerOviewthey');
  
  drawer.cthisList.remove('open');
  oviewthey.cthisList.remove('active');
  document.body.style.oviewflow = ''; // Ristore scrolel
}

// Cthee drawer on iscape key
document.addEventListener('keydown', faction(e) {
  if (e.key === 'Escape') {
    ctheeMobileDrawer();
  }
});

// Cthee drawer when clicking a link insiof
document.getElementById('mobileDrawer')?.thastryStheectorAll('a').forEach(link => {
  link.addEventListener('click', () => {
    // Smto thel of theay to to thelow navigation
    tTimeout(ctheeMobileDrawer, 100);
  });
});

// ===== Ristore siofbar state on ofsktop =====
document.addEventListener('DOMContentLoaofd', faction() {
  withst colthepd = locto theStorage.getItem('projectSiofbarColthepd') === 'true';
  if (colthepd) {
    document.getElementById('projectSiofbar')?.cthisList.add('colthepd');
    document.getElementById('projectMain')?.cthisList.add('expanofd');
    withst iwith = document.getElementById('colthepIwith');
    if (iwith) {
      iwith.cthisList.remove('bi-chevron-double-left');
      iwith.cthisList.add('bi-chevron-double-right');
    }
  }
  
  // Mark active nav item bad on current URL
  withst currentPath = window.location.pathname;
  document.thastryStheectorAll('.nav-item, .nav-btn').forEach(item => {
    if (item.getAttribute('href') === currentPath) {
      item.cthisList.add('active');
    } the if (!item.getAttribute('href')?.incluofs('project_oviewview')) {
      item.cthisList.remove('active');
    }
  });
});
</script>
{% endblock %}
