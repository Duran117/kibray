{% extends "core/base.html" %}
{% load static %}
{% load i18n %}

{% block title %}
    {% if is_create %}
        {% trans "Crear Nuevo Proyecto" %}
    {% else %}
        {% trans "Editar Proyecto" %}
    {% endif %} - Kibray
{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <!-- Breadcrumb -->
            <nav aria-label="breadcrumb" class="mb-3">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item">
                        <a href="{% url 'dashboard_admin' %}">
                            <i class="bi bi-house-door"></i> {% trans "Dashboard" %}
                        </a>
                    </li>
                    <li class="breadcrumb-item">
                        <a href="{% url 'project_list' %}">{% trans "Proyectos" %}</a>
                    </li>
                    <li class="breadcrumb-item active">
                        {% if is_create %}{% trans "Crear" %}{% else %}{% trans "Editar" %}{% endif %}
                    </li>
                </ol>
            </nav>

            <!-- Header -->
            <div class="mb-4">
                <h1 class="h3">
                    {% if is_create %}
                        <i class="bi bi-folder-plus text-success me-2"></i>
                        {% trans "Crear Nuevo Proyecto" %}
                    {% else %}
                        <i class="bi bi-pencil text-primary me-2"></i>
                        {% trans "Editar Proyecto" %}: {{ project.name }}
                    {% endif %}
                </h1>
            </div>

            <!-- Formulario -->
            <form method="post" novalidate>
                {% csrf_token %}
                
                <!-- Información Básica -->
                <div class="card shadow-sm mb-4">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">
                            <i class="bi bi-info-circle me-2"></i>
                            {% trans "Información Básica" %}
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-md-8">
                                <label for="{{ form.name.id_for_label }}" class="form-label">
                                    {{ form.name.label }} <span class="text-danger">*</span>
                                </label>
                                {{ form.name }}
                                {% if form.name.errors %}
                                    <div class="invalid-feedback d-block">{{ form.name.errors }}</div>
                                {% endif %}
                            </div>
                            
                            <div class="col-md-4">
                                <label for="{{ form.client.id_for_label }}" class="form-label">
                                    {{ form.client.label }}
                                </label>
                                {{ form.client }}
                                {% if form.client.errors %}
                                    <div class="invalid-feedback d-block">{{ form.client.errors }}</div>
                                {% endif %}
                            </div>
                            
                            <div class="col-12">
                                <label for="{{ form.address.id_for_label }}" class="form-label">
                                    {{ form.address.label }}
                                </label>
                                {{ form.address }}
                                {% if form.address.errors %}
                                    <div class="invalid-feedback d-block">{{ form.address.errors }}</div>
                                {% endif %}
                            </div>
                            
                            <div class="col-md-6">
                                <label for="{{ form.start_date.id_for_label }}" class="form-label">
                                    {{ form.start_date.label }} <span class="text-danger">*</span>
                                </label>
                                {{ form.start_date }}
                                {% if form.start_date.errors %}
                                    <div class="invalid-feedback d-block">{{ form.start_date.errors }}</div>
                                {% endif %}
                            </div>
                            
                            <div class="col-md-6">
                                <label for="{{ form.end_date.id_for_label }}" class="form-label">
                                    {{ form.end_date.label }}
                                </label>
                                {{ form.end_date }}
                                <small class="text-muted d-block">
                                    <i class="bi bi-info-circle me-1"></i>
                                    {% trans "Dejar en blanco para proyectos activos" %}
                                </small>
                                {% if form.end_date.errors %}
                                    <div class="invalid-feedback d-block">{{ form.end_date.errors }}</div>
                                {% endif %}
                            </div>
                            
                            <div class="col-12">
                                <label for="{{ form.description.id_for_label }}" class="form-label">
                                    {{ form.description.label }}
                                </label>
                                {{ form.description }}
                                {% if form.description.errors %}
                                    <div class="invalid-feedback d-block">{{ form.description.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Presupuesto -->
                <div class="card shadow-sm mb-4">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0">
                            <i class="bi bi-currency-dollar me-2"></i>
                            {% trans "Presupuesto" %}
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="{{ form.budget_total.id_for_label }}" class="form-label">
                                    {{ form.budget_total.label }}
                                </label>
                                <div class="input-group">
                                    <span class="input-group-text">$</span>
                                    {{ form.budget_total }}
                                </div>
                                {% if form.budget_total.errors %}
                                    <div class="invalid-feedback d-block">{{ form.budget_total.errors }}</div>
                                {% endif %}
                            </div>
                            
                            <div class="col-md-6">
                                <label for="{{ form.budget_labor.id_for_label }}" class="form-label">
                                    {{ form.budget_labor.label }}
                                </label>
                                <div class="input-group">
                                    <span class="input-group-text">$</span>
                                    {{ form.budget_labor }}
                                </div>
                                {% if form.budget_labor.errors %}
                                    <div class="invalid-feedback d-block">{{ form.budget_labor.errors }}</div>
                                {% endif %}
                            </div>
                            
                            <div class="col-md-6">
                                <label for="{{ form.budget_materials.id_for_label }}" class="form-label">
                                    {{ form.budget_materials.label }}
                                </label>
                                <div class="input-group">
                                    <span class="input-group-text">$</span>
                                    {{ form.budget_materials }}
                                </div>
                                {% if form.budget_materials.errors %}
                                    <div class="invalid-feedback d-block">{{ form.budget_materials.errors }}</div>
                                {% endif %}
                            </div>
                            
                            <div class="col-md-6">
                                <label for="{{ form.budget_other.id_for_label }}" class="form-label">
                                    {{ form.budget_other.label }}
                                </label>
                                <div class="input-group">
                                    <span class="input-group-text">$</span>
                                    {{ form.budget_other }}
                                </div>
                                {% if form.budget_other.errors %}
                                    <div class="invalid-feedback d-block">{{ form.budget_other.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Especificaciones Técnicas -->
                <div class="card shadow-sm mb-4">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0">
                            <i class="bi bi-palette me-2"></i>
                            {% trans "Especificaciones Técnicas" %}
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="{{ form.number_of_rooms_or_areas.id_for_label }}" class="form-label">
                                    {{ form.number_of_rooms_or_areas.label }}
                                </label>
                                {{ form.number_of_rooms_or_areas }}
                                {% if form.number_of_rooms_or_areas.errors %}
                                    <div class="invalid-feedback d-block">{{ form.number_of_rooms_or_areas.errors }}</div>
                                {% endif %}
                            </div>
                            
                            <div class="col-12">
                                <label for="{{ form.paint_colors.id_for_label }}" class="form-label">
                                    {{ form.paint_colors.label }}
                                </label>
                                {{ form.paint_colors }}
                                <small class="text-muted">{{ form.paint_colors.help_text }}</small>
                                {% if form.paint_colors.errors %}
                                    <div class="invalid-feedback d-block">{{ form.paint_colors.errors }}</div>
                                {% endif %}
                            </div>
                            
                            <div class="col-12">
                                <label for="{{ form.paint_codes.id_for_label }}" class="form-label">
                                    {{ form.paint_codes.label }}
                                </label>
                                {{ form.paint_codes }}
                                <small class="text-muted">{{ form.paint_codes.help_text }}</small>
                                {% if form.paint_codes.errors %}
                                    <div class="invalid-feedback d-block">{{ form.paint_codes.errors }}</div>
                                {% endif %}
                            </div>
                            
                            <div class="col-12">
                                <label for="{{ form.stains_or_finishes.id_for_label }}" class="form-label">
                                    {{ form.stains_or_finishes.label }}
                                </label>
                                {{ form.stains_or_finishes }}
                                <small class="text-muted">{{ form.stains_or_finishes.help_text }}</small>
                                {% if form.stains_or_finishes.errors %}
                                    <div class="invalid-feedback d-block">{{ form.stains_or_finishes.errors }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Notas de Reflexión (solo en edición) -->
                {% if not is_create and form.reflection_notes %}
                <div class="card shadow-sm mb-4">
                    <div class="card-header bg-warning">
                        <h5 class="mb-0">
                            <i class="bi bi-journal-text me-2"></i>
                            {% trans "Notas de Reflexión" %}
                        </h5>
                    </div>
                    <div class="card-body">
                        <label for="{{ form.reflection_notes.id_for_label }}" class="form-label">
                            {{ form.reflection_notes.label }}
                        </label>
                        {{ form.reflection_notes }}
                        <small class="text-muted">{{ form.reflection_notes.help_text }}</small>
                        {% if form.reflection_notes.errors %}
                            <div class="invalid-feedback d-block">{{ form.reflection_notes.errors }}</div>
                        {% endif %}
                    </div>
                </div>
                {% endif %}

                <!-- Errores generales del formulario -->
                {% if form.non_field_errors %}
                    <div class="alert alert-danger">
                        {{ form.non_field_errors }}
                    </div>
                {% endif %}

                <!-- Botones de acción -->
                <div class="d-flex justify-content-between align-items-center">
                    <a href="{% if is_create %}{% url 'project_list' %}{% else %}{% url 'project_overview' project.id %}{% endif %}" 
                       class="btn btn-secondary">
                        <i class="bi bi-x-circle me-2"></i>
                        {% trans "Cancelar" %}
                    </a>
                    
                    <button type="submit" class="btn btn-success btn-lg">
                        <i class="bi bi-check-circle me-2"></i>
                        {% if is_create %}
                            {% trans "Crear Proyecto" %}
                        {% else %}
                            {% trans "Guardar Cambios" %}
                        {% endif %}
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}
