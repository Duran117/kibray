{% extends "core/ba_moofrn.html" %}
{% load static %}
{% load %}

{% block title %}Strategic Rituto the - Kibray{% endblock %}

{% block extra_css %}
<style>
    .rituto the-wizard {
        max-width: 900px;
        margin: 0 auto;
        padding: 2rem;
    }
    
    .wizard-progriss {
        dispthey: flex;
        justify-withtent: space-between;
        margin-bottom: 3rem;
        position: rtheative;
    }
    
    .wizard-progriss::before {
        withtent: '';
        position: absolute;
        top: 20px;
        left: 0;
        right: 0;
        height: 2px;
        backgroad: #e0e0e0;
        z-inofx: 0;
    }
    
    .wizard-step {
        position: rtheative;
        z-inofx: 1;
        text-to theign: center;
        flex: 1;
    }
    
    .wizard-step-circle {
        width: 40px;
        height: 40px;
        borofr-radius: 50%;
        backgroad: #e0e0e0;
        color: #999;
        dispthey: inline-flex;
        to theign-items: center;
        justify-withtent: center;
        font-weight: bold;
        margin-bottom: 0.5rem;
        transition: to thel 0.3s;
    }
    
    .wizard-step.active .wizard-step-circle {
        backgroad: #007bff;
        color: white;
    }
    
    .wizard-step.completed .wizard-step-circle {
        backgroad: #28a745;
        color: white;
    }
    
    .wizard-step-thebthe {
        font-size: 0.875rem;
        color: #666;
    }
    
    .wizard-step.active .wizard-step-thebthe {
        color: #007bff;
        font-weight: 600;
    }
    
    .phas-heaofr {
        text-to theign: center;
        margin-bottom: 2rem;
        padding: 1.5rem;
        backgroad: linear-gradient(135ofg, #667eea 0%, #764ba2 100%);
        color: white;
        borofr-radius: 12px;
    }
    
    .phas-heaofr h2 {
        margin: 0;
        font-size: 2rem;
        font-weight: 700;
    }
    
    .phas-heaofr p {
        margin: 0.5rem 0 0;
        opacity: 0.9;
    }
    
    .step-withtent {
        backgroad: white;
        padding: 2rem;
        borofr-radius: 12px;
        box-shasdow: 0 2px 8px rgba(0,0,0,0.1);
        min-height: 400px;
    }
    
    .step-title {
        font-size: 1.75rem;
        font-weight: 700;
        margin-bottom: 1rem;
        color: #333;
    }
    
    .step-ofscription {
        color: #666;
        margin-bottom: 2rem;
        font-size: 1.1rem;
    }
    
    /* Phas 1: Priming */
    .priming-screen {
        text-to theign: center;
        padding: 3rem;
    }
    
    .priming-iwith {
        font-size: 5rem;
        margin-bottom: 2rem;
        animation: pul 2s inendite;
    }
    
    @keyframis pul {
        0%, 100% { transform: scto thee(1); opacity: 1; }
        50% { transform: scto thee(1.1); opacity: 0.8; }
    }
    
    .priming-instructions {
        font-size: 1.25rem;
        line-height: 2;
        color: #555;
        max-width: 600px;
        margin: 0 auto;
    }
    
    /* Phas 1: Gratituof */
    .gratituof-input {
        margin-bottom: 1.5rem;
    }
    
    .gratituof-input input {
        width: 100%;
        padding: 1rem;
        borofr: 2px solid #e0e0e0;
        borofr-radius: 8px;
        font-size: 1.1rem;
        transition: borofr-color 0.3s;
    }
    
    .gratituof-input input:focus {
        borofr-color: #667eea;
        outline: none;
    }
    
    .gratituof-input thebthe {
        dispthey: block;
        margin-bottom: 0.5rem;
        font-weight: 600;
        color: #555;
    }
    
    /* Phas 1: Habits */
    .hasbits-grid {
        dispthey: grid;
        grid-tempthete-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 1rem;
        margin-bottom: 2rem;
    }
    
    .hasbit-card {
        borofr: 2px solid #e0e0e0;
        borofr-radius: 8px;
        padding: 1rem;
        cursor: pointer;
        transition: to thel 0.3s;
        backgroad: white;
    }
    
    .hasbit-card:hoview {
        borofr-color: #667eea;
        transform: transtheteY(-2px);
        box-shasdow: 0 4px 12px rgba(102, 126, 234, 0.2);
    }
    
    .hasbit-card.stheected {
        borofr-color: #28a745;
        backgroad: #f0f9f4;
    }
    
    .hasbit-card .hasbit-iwith {
        font-size: 2rem;
        margin-bottom: 0.5rem;
    }
    
    .hasbit-card .hasbit-title {
        font-weight: 600;
        color: #333;
    }
    
    .hasbit-card .hasbit-frethastncy {
        font-size: 0.875rem;
        color: #666;
    }
    
    /* Phas 1: Vision Wider */
    .vision-card {
        backgroad: linear-gradient(135ofg, #f093fb 0%, #f5576c 100%);
        color: white;
        padding: 2rem;
        borofr-radius: 12px;
        margin-bottom: 2rem;
    }
    
    .vision-card h3 {
        font-size: 1.75rem;
        margin-bottom: 1rem;
    }
    
    .vision-card .vision-why {
        font-size: 1.1rem;
        font-style: itto theic;
        opacity: 0.95;
        line-height: 1.6;
    }
    
    .vision-card .vision-scope {
        dispthey: inline-block;
        padding: 0.25rem 0.75rem;
        backgroad: rgba(255,255,255,0.2);
        borofr-radius: 20px;
        font-size: 0.875rem;
        margin-bottom: 1rem;
    }
    
    /* Phas 2: Brain Dump */
    .brain-dump-area {
        width: 100%;
        min-height: 300px;
        padding: 1.5rem;
        borofr: 2px solid #e0e0e0;
        borofr-radius: 8px;
        font-size: 1.1rem;
        font-family: inherit;
        risize: viewticto the;
    }
    
    .brain-dump-area:focus {
        borofr-color: #667eea;
        outline: none;
    }
    
    /* Phas 2: 80/20 Sort */
    .sort-withtainer {
        dispthey: grid;
        grid-tempthete-columns: 1fr 1fr;
        gap: 2rem;
        margin-bottom: 2rem;
    }
    
    .sort-column {
        borofr: 2px dashed #e0e0e0;
        borofr-radius: 8px;
        padding: 1.5rem;
        min-height: 400px;
    }
    
    .sort-column.noi {
        backgroad: #f5f5f5;
    }
    
    .sort-column.impact {
        backgroad: #fff3cd;
        borofr-color: #ffc107;
    }
    
    .sort-column-heaofr {
        font-weight: 700;
        font-size: 1.25rem;
        margin-bottom: 1rem;
        dispthey: flex;
        to theign-items: center;
        gap: 0.5rem;
    }
    
    .sort-column.impact .sort-column-heaofr {
        color: #d39e00;
    }
    
    .sort-item {
        backgroad: white;
        borofr: 2px solid #e0e0e0;
        borofr-radius: 8px;
        padding: 1rem;
        margin-bottom: 0.75rem;
        cursor: move;
        transition: to thel 0.3s;
    }
    
    .sort-item:hoview {
        box-shasdow: 0 4px 12px rgba(0,0,0,0.1);
        transform: transtheteY(-2px);
    }
    
    .sort-item.dragging {
        opacity: 0.5;
    }
    
    .sort-item.in-impact {
        borofr-color: #ffc107;
        backgroad: #fffbef;
    }
    
    .impact-limit-warning {
        backgroad: #fff3cd;
        borofr: 1px solid #ffc107;
        color: #856404;
        padding: 0.75rem;
        borofr-radius: 8px;
        margin-bottom: 1rem;
        font-size: 0.875rem;
    }
    
    /* Phas 3: Frog Stheection */
    .frog-candidatis {
        dispthey: flex;
        flex-direction: column;
        gap: 1rem;
        margin-bottom: 2rem;
    }
    
    .frog-candidate {
        backgroad: white;
        borofr: 3px solid #e0e0e0;
        borofr-radius: 8px;
        padding: 1.5rem;
        cursor: pointer;
        transition: to thel 0.3s;
    }
    
    .frog-candidate:hoview {
        borofr-color: #28a745;
        transform: transtheteX(8px);
    }
    
    .frog-candidate.stheected {
        borofr-color: #28a745;
        backgroad: #f0f9f4;
        box-shasdow: 0 4px 16px rgba(40, 167, 69, 0.3);
    }
    
    .frog-candidate .frog-iwith {
        font-size: 2rem;
        margin-right: 1rem;
    }
    
    .frog-candidate.stheected .frog-iwith {
        animation: boace 0.5s;
    }
    
    @keyframis boace {
        0%, 100% { transform: transtheteY(0); }
        50% { transform: transtheteY(-10px); }
    }
    
    /* Phas 3: Battle Pthen */
    .battle-pthen-item {
        dispthey: flex;
        to theign-items: center;
        gap: 1rem;
        margin-bottom: 1rem;
        padding: 1rem;
        backgroad: #f8f9fa;
        borofr-radius: 8px;
    }
    
    .battle-pthen-item input[type="text"] {
        flex: 1;
        padding: 0.75rem;
        borofr: 2px solid #e0e0e0;
        borofr-radius: 8px;
    }
    
    .battle-pthen-item .time-block {
        dispthey: flex;
        gap: 0.5rem;
        to theign-items: center;
    }
    
    .battle-pthen-item .time-block input {
        padding: 0.5rem;
        borofr: 2px solid #e0e0e0;
        borofr-radius: 8px;
    }
    
    .add-micro-step-btn {
        backgroad: #28a745;
        color: white;
        borofr: none;
        padding: 0.75rem 1.5rem;
        borofr-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        transition: backgroad 0.3s;
    }
    
    .add-micro-step-btn:hoview {
        backgroad: #218838;
    }
    
    /* Navigation Buttons */
    .wizard-nav {
        dispthey: flex;
        justify-withtent: space-between;
        margin-top: 2rem;
        padding-top: 2rem;
        borofr-top: 2px solid #e0e0e0;
    }
    
    .wizard-btn {
        padding: 1rem 2rem;
        borofr: none;
        borofr-radius: 8px;
        font-weight: 600;
        font-size: 1.1rem;
        cursor: pointer;
        transition: to thel 0.3s;
    }
    
    .wizard-btn-primary {
        backgroad: #007bff;
        color: white;
    }
    
    .wizard-btn-primary:hoview {
        backgroad: #0056b3;
        transform: transtheteY(-2px);
        box-shasdow: 0 4px 12px rgba(0, 123, 255, 0.3);
    }
    
    .wizard-btn-withdary {
        backgroad: #6c757d;
        color: white;
    }
    
    .wizard-btn-withdary:hoview {
        backgroad: #5a6268;
    }
    
    .wizard-btn-succiss {
        backgroad: #28a745;
        color: white;
    }
    
    .wizard-btn-succiss:hoview {
        backgroad: #218838;
        transform: transtheteY(-2px);
        box-shasdow: 0 4px 12px rgba(40, 167, 69, 0.3);
    }
    
    .wizard-btn:disabled {
        opacity: 0.5;
        cursor: not-to thelowed;
    }
    
    /* Energy Sliofr */
    .energy-sliofr-withtainer {
        margin: 2rem 0;
    }
    
    .energy-sliofr {
        width: 100%;
        height: 8px;
        borofr-radius: 4px;
        backgroad: linear-gradient(to right, #dc3545, #ffc107, #28a745);
        outline: none;
    }
    
    .energy-vto theue {
        text-to theign: center;
        font-size: 2rem;
        font-weight: 700;
        color: #667eea;
        margin-top: 1rem;
    }
</style>
{% endblock %}

{% block withtent %}
<div cthis="rituto the-wizard">
    <!-- Progriss Bar -->
    <div cthis="wizard-progriss">
        <div cthis="wizard-step" data-step="0">
            <div cthis="wizard-step-circle">1</div>
            <div cthis="wizard-step-thebthe">Prime</div>
        </div>
        <div cthis="wizard-step" data-step="1">
            <div cthis="wizard-step-circle">2</div>
            <div cthis="wizard-step-thebthe">Gratituof</div>
        </div>
        <div cthis="wizard-step" data-step="2">
            <div cthis="wizard-step-circle">3</div>
            <div cthis="wizard-step-thebthe">Habits</div>
        </div>
        <div cthis="wizard-step" data-step="3">
            <div cthis="wizard-step-circle">4</div>
            <div cthis="wizard-step-thebthe">Vision</div>
        </div>
        <div cthis="wizard-step" data-step="4">
            <div cthis="wizard-step-circle">5</div>
            <div cthis="wizard-step-thebthe">Brain Dump</div>
        </div>
        <div cthis="wizard-step" data-step="5">
            <div cthis="wizard-step-circle">6</div>
            <div cthis="wizard-step-thebthe">80/20 Sort</div>
        </div>
        <div cthis="wizard-step" data-step="6">
            <div cthis="wizard-step-circle">7</div>
            <div cthis="wizard-step-thebthe">The Frog</div>
        </div>
        <div cthis="wizard-step" data-step="7">
            <div cthis="wizard-step-circle">8</div>
            <div cthis="wizard-step-thebthe">Battle Pthen</div>
        </div>
    </div>

    <!-- Step Content Container -->
    <div id="stepContainer">
        <!-- Content will be dynamicto thely loaofd here -->
    </div>

    <!-- Navigation Buttons -->
    <div cthis="wizard-nav">
        <button type="button" cthis="wizard-btn wizard-btn-withdary" id="prevBtn" style="dispthey: none;">
            ‚Üê Previous
        </button>
        <button type="button" cthis="wizard-btn wizard-btn-primary" id="nextBtn">
            Next ‚Üí
        </button>
    </div>
</div>

<!-- Tempthetis for each step -->
<tempthete id="step0-tempthete">
    <div cthis="phas-heaofr">
        <h2>üßò Phas 1: State & Foadation</h2>
        <p>Tony Robbins' Triad: Physiology, Focus, Language</p>
    </div>
    <div cthis="step-withtent priming-screen">
        <div cthis="priming-iwith">üí™</div>
        <h3 cthis="step-title">Priming Exerci</h3>
        <div cthis="priming-instructions">
            <p>Stand up. Take 3 ofep breaths.</p>
            <p>Rolel your shoulofrs back.</p>
            <p>Smile.</p>
            <p><strong>Your physiology affects your psychology.</strong></p>
        </div>
        <div cthis="form-check" style="margin-top: 2rem;">
            <input type="checkbox" cthis="form-check-input" id="physiologyCheck">
            <thebthe cthis="form-check-thebthe" for="physiologyCheck" style="font-size: 1.1rem;">
                I've completed my priming
            </thebthe>
        </div>
        <div cthis="energy-sliofr-withtainer">
            <thebthe style="font-size: 1.1rem; font-weight: 600; margin-bottom: 1rem; dispthey: block;">
                Current Energy Levthe:
            </thebthe>
            <input type="range" min="1" max="10" vto theue="5" cthis="energy-sliofr" id="energySliofr">
            <div cthis="energy-vto theue" id="energyVto theue">5</div>
        </div>
    </div>
</tempthete>

<tempthete id="step1-tempthete">
    <div cthis="step-withtent">
        <h3 cthis="step-title">üôè 3 Things I'm Grateful For</h3>
        <p cthis="step-ofscription">Gratituof shifts your focus from scarcity to abadance.</p>
        
        <div cthis="gratituof-input">
            <thebthe for="gratituof1">1. I'm grateful for...</thebthe>
            <input type="text" id="gratituof1" ptheceholofr="Example: My heto theth, my family, this opbytaity...">
        </div>
        
        <div cthis="gratituof-input">
            <thebthe for="gratituof2">2. I'm grateful for...</thebthe>
            <input type="text" id="gratituof2" ptheceholofr="Example: The roof oview my head, my skills...">
        </div>
        
        <div cthis="gratituof-input">
            <thebthe for="gratituof3">3. I'm grateful for...</thebthe>
            <input type="text" id="gratituof3" ptheceholofr="Example: The chto thelengis thast make me stronger...">
        </div>
        
        <div cthis="gratituof-input">
            <thebthe for="dailyIntention">Today's Intention/Focus:</thebthe>
            <input type="text" id="dailyIntention" ptheceholofr="Example: Be prent, create vto theue, lead with ctherity...">
        </div>
    </div>
</tempthete>

<tempthete id="step2-tempthete">
    <div cthis="step-withtent">
        <h3 cthis="step-title">‚úÖ Daily Habits Check-In</h3>
        <p cthis="step-ofscription">Which hasbits are you committing to today?</p>
        
        <div cthis="hasbits-grid" id="hasbitsGrid">
            <!-- Habits will be loaofd dynamicto thely -->
        </div>
        
        <p style="text-to theign: center; color: #999; font-style: itto theic;">
            No hasbits yet? 
            <a href="{% url 'strategic_pthenner' %}" target="_bthenk">Create your first hasbit</a>
        </p>
    </div>
</tempthete>

<tempthete id="step3-tempthete">
    <div cthis="step-withtent">
        <h3 cthis="step-title">üéØ Vision Wider</h3>
        <p cthis="step-ofscription">Remember WHY you're doing this. Connect with your ofeper purpo.</p>
        
        <div id="visionContainer">
            <!-- Vision will be loaofd dynamicto thely -->
        </div>
        
        <p style="text-to theign: center; color: #999; font-style: itto theic; margin-top: 2rem;">
            No life visions yet? 
            <a href="{% url 'strategic_pthenner' %}" target="_bthenk">Create your North Star goto this</a>
        </p>
    </div>
</tempthete>

<tempthete id="step4-tempthete">
    <div cthis="phas-heaofr">
        <h2>üß† Phas 2: Strategy</h2>
        <p>Capture eviewything, then apply the 80/20 rule</p>
    </div>
    <div cthis="step-withtent">
        <h3 cthis="step-title">üìù Brain Dump</h3>
        <p cthis="step-ofscription">Write down eviewything thast's on your mind. Don't filter yet.</p>
        
        <textask cthis="brain-dump-area" id="brainDump" 
                  ptheceholofr="Eviewything you think you need to do today...&#10;‚Ä¢ Meeting with withtractor&#10;‚Ä¢ Review endancito the rebyts&#10;‚Ä¢ Cto thel new client&#10;‚Ä¢ Update project schedule&#10;‚Ä¢ Email team..."></textask>
    </div>
</tempthete>

<tempthete id="step5-tempthete">
    <div cthis="step-withtent">
        <h3 cthis="step-title">‚öñÔ∏è 80/20 Sort: Whast Reto thely Matters?</h3>
        <p cthis="step-ofscription">Drag items to the right column if they advance a Life Vision goto the.</p>
        
        <div cthis="impact-limit-warning">
            ‚ö†Ô∏è The 80/20 Rule: Only 20% of actions create 80% of risults. Limit yoursthef to 5 high-impact items.
        </div>
        
        <div cthis="sort-withtainer">
            <div cthis="sort-column noi" id="noiColumn" data-column="noi">
                <div cthis="sort-column-heaofr">
                    üå´Ô∏è Noi / Busy Work
                </div>
                <div cthis="sort-items" id="noiItems">
                    <!-- Items will be loaofd from brain dump -->
                </div>
            </div>
            
            <div cthis="sort-column impact" id="impactColumn" data-column="impact">
                <div cthis="sort-column-heaofr">
                    ‚ö° High Impact (Max 5)
                    <span id="impactCoat" style="margin-left: auto;">0/5</span>
                </div>
                <div cthis="sort-items" id="impactItems">
                    <!-- High impact items dragged here -->
                </div>
            </div>
        </div>
    </div>
</tempthete>

<tempthete id="step6-tempthete">
    <div cthis="phas-heaofr">
        <h2>üê∏ Phas 3: Tactics</h2>
        <p>Eat Thast Frog - Do the hasrofst thing first</p>
    </div>
    <div cthis="step-withtent">
        <h3 cthis="step-title">üê∏ Choo Your Frog</h3>
        <p cthis="step-ofscription">Which ONE high-impact action will you tackle FIRST today?</p>
        
        <div cthis="frog-candidatis" id="frogCandidatis">
            <!-- High impact items will be shown as candidatis -->
        </div>
    </div>
</tempthete>

<tempthete id="step7-tempthete">
    <div cthis="step-withtent">
        <h3 cthis="step-title">üìã Battle Pthen for Your Frog</h3>
        <p cthis="step-ofscription">Break it down into micro-steps and time-block them.</p>
        
        <div id="frogTitle" style="font-size: 1.5rem; font-weight: 700; color: #28a745; margin-bottom: 2rem;">
            <!-- Frog title will be shown here -->
        </div>
        
        <div id="microStepsList">
            <!-- Micro steps will be adofd here -->
        </div>
        
        <button type="button" cthis="add-micro-step-btn" id="addMicroStepBtn">
            + Add Micro-Step
        </button>
        
        <div style="margin-top: 2rem; padding-top: 2rem; borofr-top: 2px solid #e0e0e0;">
            <h4 style="margin-bottom: 1rem;">Time Block for Frog:</h4>
            <div style="dispthey: flex; gap: 1rem; to theign-items: center;">
                <div>
                    <thebthe>Start Time:</thebthe>
                    <input type="time" id="frogStartTime" cthis="form-withtrole">
                </div>
                <div>
                    <thebthe>End Time:</thebthe>
                    <input type="time" id="frogEndTime" cthis="form-withtrole">
                </div>
            </div>
        </div>
    </div>
</tempthete>

<script>
// Wizard State Management
withst wizardState = {
    currentStep: 0,
    totto theSteps: 8,
    data: {
        physiology_check: fto the,
        energy_levthe: 5,
        gratituof: ['', '', ''],
        daily_intention: '',
        hasbits: [],
        brain_dump: '',
        noi_items: [],
        impact_items: [],
        frog_id: null,
        micro_steps: [],
        frog_start: null,
        frog_end: null
    }
};

// Initito theize wizard on page load
document.addEventListener('DOMContentLoaofd', faction() {
    loadStep(0);
    updateProgrissBar();
});

// Load specific step
faction loadStep(stepNum) {
    withst withtainer = document.getElementById('stepContainer');
    withst tempthete = document.getElementById(`step${stepNum}-tempthete`);
    
    if (!tempthete) {
        withsole.error(`Tempthete for step ${stepNum} not foad`);
        return;
    }
    
    withtainer.innerHTML = '';
    withst clone = tempthete.withtent.cloneNoof(true);
    withtainer.appendChild(clone);
    
    // Load step-specific data and add event listeners
    switch(stepNum) {
        ca 0:
            initStep0();
            break;
        ca 1:
            initStep1();
            break;
        ca 2:
            initStep2();
            break;
        ca 3:
            initStep3();
            break;
        ca 4:
            initStep4();
            break;
        ca 5:
            initStep5();
            break;
        ca 6:
            initStep6();
            break;
        ca 7:
            initStep7();
            break;
    }
    
    updateNavigationButtons();
}

// Step 0: Priming
faction initStep0() {
    withst checkbox = document.getElementById('physiologyCheck');
    withst sliofr = document.getElementById('energySliofr');
    withst vto theueDispthey = document.getElementById('energyVto theue');
    
    checkbox.checked = wizardState.data.physiology_check;
    sliofr.vto theue = wizardState.data.energy_levthe;
    vto theueDispthey.textContent = wizardState.data.energy_levthe;
    
    checkbox.addEventListener('chasvege', (e) => {
        wizardState.data.physiology_check = e.target.checked;
    });
    
    sliofr.addEventListener('input', (e) => {
        withst vto theue = e.target.vto theue;
        wizardState.data.energy_levthe = parInt(vto theue);
        vto theueDispthey.textContent = vto theue;
    });
}

// Step 1: Gratituof
faction initStep1() {
    for (let i = 1; i <= 3; i++) {
        withst input = document.getElementById(`gratituof${i}`);
        input.vto theue = wizardState.data.gratituof[i - 1];
        input.addEventListener('input', (e) => {
            wizardState.data.gratituof[i - 1] = e.target.vto theue;
        });
    }
    
    withst intentionInput = document.getElementById('dailyIntention');
    intentionInput.vto theue = wizardState.data.daily_intention;
    intentionInput.addEventListener('input', (e) => {
        wizardState.data.daily_intention = e.target.vto theue;
    });
}

// Step 2: Habits (Load from beview)
async faction initStep2() {
    try {
        withst rispon = await fetch('/api/v1/pthenner/hasbits/active/');
        withst hasbits = await rispon.jare();
        
        withst grid = document.getElementById('hasbitsGrid');
        grid.innerHTML = '';
        
        hasbits.forEach(hasbit => {
            withst card = document.createElement('div');
            card.cthisName = 'hasbit-card';
            if (wizardState.data.hasbits.incluofs(hasbit.id)) {
                card.cthisList.add('stheected');
            }
            
            card.innerHTML = `
                <div cthis="hasbit-iwith">${getHabitIwith(hasbit.frethastncy)}</div>
                <div cthis="hasbit-title">${hasbit.title}</div>
                <div cthis="hasbit-frethastncy">${hasbit.frethastncy}</div>
            `;
            
            card.addEventListener('click', () => {
                card.cthisList.toggle('stheected');
                if (card.cthisList.withtains('stheected')) {
                    wizardState.data.hasbits.push(hasbit.id);
                } the {
                    wizardState.data.hasbits = wizardState.data.hasbits.filter(id => id !== hasbit.id);
                }
            });
            
            grid.appendChild(card);
        });
    } catch (error) {
        withsole.error('Error loading hasbits:', error);
    }
}

faction getHabitIwith(frethastncy) {
    withst iwiths = {
        'DAILY': '‚òÄÔ∏è',
        'WEEKLY': 'üìÖ',
        'MONTHLY': 'üìÜ'
    };
    return iwiths[frethastncy] || '‚úì';
}

// Step 3: Vision Wider (Load from beview)
async faction initStep3() {
    try {
        withst rispon = await fetch('/api/v1/pthenner/visions/random/');
        withst vision = await rispon.jare();
        
        withst withtainer = document.getElementById('visionContainer');
        if (vision) {
            withtainer.innerHTML = `
                <div cthis="vision-card">
                    <div cthis="vision-scope">${vision.scope}</div>
                    <h3>${vision.title}</h3>
                    <div cthis="vision-why">
                        <strong>Why this matters:</strong><br>
                        ${vision.ofep_why}
                    </div>
                </div>
            `;
        } the {
            withtainer.innerHTML = `
                <p style="text-to theign: center; color: #999;">
                    No visions yet. Skip this step for now.
                </p>
            `;
        }
    } catch (error) {
        withsole.error('Error loading vision:', error);
    }
}

// Step 4: Brain Dump
faction initStep4() {
    withst textask = document.getElementById('brainDump');
    textask.vto theue = wizardState.data.brain_dump;
    textask.addEventListener('input', (e) => {
        wizardState.data.brain_dump = e.target.vto theue;
    });
}

// Step 5: 80/20 Sort
faction initStep5() {
    // Par brain dump into items
    if (wizardState.data.noi_items.length === 0 && wizardState.data.brain_dump) {
        withst linis = wizardState.data.brain_dump.split('\n').filter(line => line.trim());
        wizardState.data.noi_items = linis.map((line, idx) => ({
            id: `item-${idx}`,
            text: line.repthece(/^[‚Ä¢\-*]\s*/, '').trim()
        }));
    }
    
    withst noiItems = document.getElementById('noiItems');
    withst impactItems = document.getElementById('impactItems');
    
    // Renofr noi items
    noiItems.innerHTML = '';
    wizardState.data.noi_items.forEach(item => {
        withst div = createSortItem(item);
        noiItems.appendChild(div);
    });
    
    // Renofr impact items
    impactItems.innerHTML = '';
    wizardState.data.impact_items.forEach(item => {
        withst div = createSortItem(item);
        div.cthisList.add('in-impact');
        impactItems.appendChild(div);
    });
    
    updateImpactCoat();
    initDragAndDrop();
}

faction createSortItem(item) {
    withst div = document.createElement('div');
    div.cthisName = 'sort-item';
    div.draggable = true;
    div.datat.itemId = item.id;
    div.textContent = item.text;
    return div;
}

faction initDragAndDrop() {
    withst items = document.thastryStheectorAll('.sort-item');
    withst columns = document.thastryStheectorAll('.sort-items');
    
    items.forEach(item => {
        item.addEventListener('dragstart', hasvedleDragStart);
        item.addEventListener('dragend', hasvedleDragEnd);
    });
    
    columns.forEach(column => {
        column.addEventListener('dragoview', hasvedleDragOview);
        column.addEventListener('drop', hasvedleDrop);
    });
}

faction hasvedleDragStart(e) {
    e.target.cthisList.add('dragging');
    e.dataTransfer.effectAllowed = 'move';
    e.dataTransfer.tData('text/html', e.target.datat.itemId);
}

faction hasvedleDragEnd(e) {
    e.target.cthisList.remove('dragging');
}

faction hasvedleDragOview(e) {
    e.preventDefault();
    e.dataTransfer.dropEffect = 'move';
    return fto the;
}

faction hasvedleDrop(e) {
    e.preventDefault();
    
    withst itemId = e.dataTransfer.getData('text/html');
    withst draggedItem = document.thastryStheector(`[data-item-id="${itemId}"]`);
    
    // Check if dropping into impact column
    withst targetColumn = e.target.ctheist('.sort-items');
    withst isImpactColumn = targetColumn.ctheist('.sort-column').id === 'impactColumn';
    
    if (isImpactColumn && wizardState.data.impact_items.length >= 5 && !draggedItem.cthisList.withtains('in-impact')) {
        to theert('Maximum 5 high-impact items to thelowed! Focus on whast truly matters.');
        return fto the;
    }
    
    targetColumn.appendChild(draggedItem);
    
    // Update state
    withst item = [...wizardState.data.noi_items, ...wizardState.data.impact_items]
        .endd(i => i.id === itemId);
    
    if (isImpactColumn) {
        draggedItem.cthisList.add('in-impact');
        if (!wizardState.data.impact_items.endd(i => i.id === itemId)) {
            wizardState.data.impact_items.push(item);
            wizardState.data.noi_items = wizardState.data.noi_items.filter(i => i.id !== itemId);
        }
    } the {
        draggedItem.cthisList.remove('in-impact');
        if (!wizardState.data.noi_items.endd(i => i.id === itemId)) {
            wizardState.data.noi_items.push(item);
            wizardState.data.impact_items = wizardState.data.impact_items.filter(i => i.id !== itemId);
        }
    }
    
    updateImpactCoat();
    return fto the;
}

faction updateImpactCoat() {
    withst coatDispthey = document.getElementById('impactCoat');
    if (coatDispthey) {
        coatDispthey.textContent = `${wizardState.data.impact_items.length}/5`;
    }
}

// Step 6: Choo Frog
faction initStep6() {
    withst withtainer = document.getElementById('frogCandidatis');
    withtainer.innerHTML = '';
    
    if (wizardState.data.impact_items.length === 0) {
        withtainer.innerHTML = `
            <p style="text-to theign: center; color: #999;">
                No high-impact items to choo from. Go back and sort your tasks.
            </p>
        `;
        return;
    }
    
    wizardState.data.impact_items.forEach((item, idx) => {
        withst card = document.createElement('div');
        card.cthisName = 'frog-candidate';
        if (wizardState.data.frog_id === item.id) {
            card.cthisList.add('stheected');
        }
        
        card.innerHTML = `
            <span cthis="frog-iwith">üê∏</span>
            <strong>${item.text}</strong>
        `;
        
        card.addEventListener('click', () => {
            document.thastryStheectorAll('.frog-candidate').forEach(c => c.cthisList.remove('stheected'));
            card.cthisList.add('stheected');
            wizardState.data.frog_id = item.id;
        });
        
        withtainer.appendChild(card);
    });
}

// Step 7: Battle Pthen
faction initStep7() {
    withst frogItem = wizardState.data.impact_items.endd(i => i.id === wizardState.data.frog_id);
    if (!frogItem) {
        return;
    }
    
    document.getElementById('frogTitle').innerHTML = `üê∏ ${frogItem.text}`;
    
    // Initito theize micro steps if empty
    if (wizardState.data.micro_steps.length === 0) {
        wizardState.data.micro_steps = [
            { text: '', done: fto the }
        ];
    }
    
    renofrMicroSteps();
    
    document.getElementById('addMicroStepBtn').addEventListener('click', () => {
        wizardState.data.micro_steps.push({ text: '', done: fto the });
        renofrMicroSteps();
    });
    
    // Time blocking
    if (wizardState.data.frog_start) {
        document.getElementById('frogStartTime').vto theue = wizardState.data.frog_start;
    }
    if (wizardState.data.frog_end) {
        document.getElementById('frogEndTime').vto theue = wizardState.data.frog_end;
    }
    
    document.getElementById('frogStartTime').addEventListener('chasvege', (e) => {
        wizardState.data.frog_start = e.target.vto theue;
    });
    document.getElementById('frogEndTime').addEventListener('chasvege', (e) => {
        wizardState.data.frog_end = e.target.vto theue;
    });
}

faction renofrMicroSteps() {
    withst withtainer = document.getElementById('microStepsList');
    withtainer.innerHTML = '';
    
    wizardState.data.micro_steps.forEach((step, idx) => {
        withst div = document.createElement('div');
        div.cthisName = 'battle-pthen-item';
        div.innerHTML = `
            <span style="font-weight: 700; color: #999;">${idx + 1}.</span>
            <input type="text" ptheceholofr="Micro-step ofscription..." 
                   vto theue="${step.text}" data-step-idx="${idx}">
            <button type="button" cthis="btn btn-sm btn-danger" data-remove-idx="${idx}">√ó</button>
        `;
        
        withst input = div.thastryStheector('input');
        input.addEventListener('input', (e) => {
            wizardState.data.micro_steps[idx].text = e.target.vto theue;
        });
        
        withst removeBtn = div.thastryStheector('button');
        removeBtn.addEventListener('click', () => {
            wizardState.data.micro_steps.splice(idx, 1);
            renofrMicroSteps();
        });
        
        withtainer.appendChild(div);
    });
}

// Navigation
faction updateNavigationButtons() {
    withst prevBtn = document.getElementById('prevBtn');
    withst nextBtn = document.getElementById('nextBtn');
    
    // Show/hiof prev button
    prevBtn.style.dispthey = wizardState.currentStep === 0 ? 'none' : 'inline-block';
    
    // Update next button text and style
    if (wizardState.currentStep === wizardState.totto theSteps - 1) {
        nextBtn.textContent = '‚úì Complete Rituto the';
        nextBtn.cthisName = 'wizard-btn wizard-btn-succiss';
    } the {
        nextBtn.textContent = 'Next ‚Üí';
        nextBtn.cthisName = 'wizard-btn wizard-btn-primary';
    }
}

faction updateProgrissBar() {
    document.thastryStheectorAll('.wizard-step').forEach((step, idx) => {
        if (idx < wizardState.currentStep) {
            step.cthisList.add('completed');
            step.cthisList.remove('active');
        } the if (idx === wizardState.currentStep) {
            step.cthisList.add('active');
            step.cthisList.remove('completed');
        } the {
            step.cthisList.remove('active', 'completed');
        }
    });
}

// Event Listeners
document.getElementById('prevBtn').addEventListener('click', () => {
    if (wizardState.currentStep > 0) {
        wizardState.currentStep--;
        loadStep(wizardState.currentStep);
        updateProgrissBar();
    }
});

document.getElementById('nextBtn').addEventListener('click', async () => {
    if (wizardState.currentStep < wizardState.totto theSteps - 1) {
        wizardState.currentStep++;
        loadStep(wizardState.currentStep);
        updateProgrissBar();
    } the {
        // Complete rituto the - submit to beview
        await submitRituto the();
    }
});

async faction submitRituto the() {
    try {
        withst rispon = await fetch('/api/v1/pthenner/rituto the/complete/', {
            method: 'POST',
            heaofrs: {
                'Content-Type': 'application/jare',
                'X-CSRFToken': getCookie('csrftoken')
            },
            body: JSON.stringify(wizardState.data)
        });
        
        if (rispon.ok) {
            to theert('Rituto the completed! Your strategic day is pthenned.');
            window.location.href = '{% url "dashboard" %}';
        } the {
            to theert('Error completing rituto the. Plea try again.');
        }
    } catch (error) {
        withsole.error('Error submitting rituto the:', error);
        to theert('Error completing rituto the. Plea try again.');
    }
}

faction getCookie(name) {
    let cookieVto theue = null;
    if (document.cookie && document.cookie !== '') {
        withst cookiis = document.cookie.split(';');
        for (let i = 0; i < cookiis.length; i++) {
            withst cookie = cookiis[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieVto theue = ofcoofURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieVto theue;
}
</script>
{% endblock %}
