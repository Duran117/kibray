{% extends "core/base_modern.html" %}
{% load i18n %}

{% block title %}{% trans "PM Dashboard" %} - Kibray{% endblock %}

{% block page_header %}
<div class="flex justify-between items-center">
    <div class="flex items-center gap-4">
        <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-cyan-500 to-blue-600 flex items-center justify-center text-white shadow-lg">
            <i class="bi bi-kanban text-2xl"></i>
        </div>
        <div>
            <h1 class="text-3xl font-bold text-slate-900">{% trans "PM Dashboard" %}</h1>
            <p class="text-slate-600 mt-1">{{ today|date:"D, M d, Y" }}</p>
        </div>
    </div>
    <div class="flex items-center gap-2">
    <a href="/i18n/setlang/?language=es" 
           class="px-3 py-1.5 {% if request.LANGUAGE_CODE == 'es' %}bg-indigo-600 text-white{% else %}bg-slate-100 text-slate-700{% endif %} rounded-lg text-sm font-medium transition">
            ES
        </a>
    <a href="/i18n/setlang/?language=en" 
           class="px-3 py-1.5 {% if request.LANGUAGE_CODE != 'es' %}bg-indigo-600 text-white{% else %}bg-slate-100 text-slate-700{% endif %} rounded-lg text-sm font-medium transition">
            EN
        </a>
    </div>
</div>
{% endblock %}

{% block content %}
{% if not employee %}
<div class="bg-red-50 border border-red-200 text-red-800 rounded-lg p-4 mb-6 text-sm">
    <strong>{% trans "Clock-In unavailable" %}:</strong> {% trans "Your user is not linked to an Employee profile. Ask an admin to link it." %}
</div>
{% endif %}
{% if morning_briefing %}
<!-- Morning Briefing: resumen operativo del d√≠a -->
<div class="bg-white rounded-lg shadow-sm border border-indigo-200 p-4 mb-6">
    <div class="flex items-center gap-2 mb-2">
        <i class="bi bi-sunrise text-indigo-600 text-2xl"></i>
        <h6 class="text-slate-900 font-semibold">{% trans "Morning Briefing" %}</h6>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
            {% for item in morning_briefing %}
            <div class="flex items-center justify-between p-2 border border-slate-200 rounded">
                <div class="flex items-center gap-2">
                    <i class="bi bi-dot text-{% if item.severity == 'danger' %}red-600{% elif item.severity == 'warning' %}yellow-500{% elif item.severity == 'info' %}cyan-600{% else %}indigo-600{% endif %} text-xl"></i>
                    <span class="text-sm text-slate-700">{{ item.text }}</span>
                </div>
                <div class="flex gap-1">
                    <button type="button" class="px-2 py-1 text-xs bg-indigo-600 text-white rounded" onclick="openBriefingModal('{{ item.text|escapejs }}', '{{ item.action_url|escapejs }}', '{{ item.action_label|escapejs }}')">{% trans "Quick View" %}</button>
                    <a href="{{ item.action_url }}" class="px-2 py-1 text-xs bg-slate-100 text-slate-800 rounded border border-slate-300">{{ item.action_label }}</a>
                </div>
            </div>
            {% endfor %}
    </div>
</div>

    <!-- PM Briefing Modal -->
    <div id="pmBriefingModal" class="fixed inset-0 hidden bg-black bg-opacity-40 z-50 items-center justify-center">
        <div class="bg-white rounded-lg shadow-lg w-11/12 max-w-md p-4">
            <div class="flex items-center justify-between mb-3">
                <h6 class="font-semibold text-slate-900">{% trans "Briefing Item" %}</h6>
                <button type="button" class="text-slate-500" onclick="closeBriefingModal()">‚úï</button>
            </div>
            <p id="pmBriefingText" class="text-sm text-slate-700 mb-4"></p>
            <div class="flex justify-end gap-2">
                <a id="pmBriefingAction" href="#" class="px-3 py-1.5 text-sm bg-indigo-600 text-white rounded">{% trans "Go to action" %}</a>
                <button type="button" class="px-3 py-1.5 text-sm bg-slate-100 text-slate-800 rounded border border-slate-300" onclick="closeBriefingModal()">{% trans "Close" %}</button>
            </div>
        </div>
        <script>
            function openBriefingModal(text, url, label) {
                document.getElementById('pmBriefingText').textContent = text;
                var a = document.getElementById('pmBriefingAction');
                a.setAttribute('href', url);
                a.textContent = label || '{{ _('Go to action') }}';
                var modal = document.getElementById('pmBriefingModal');
                modal.classList.remove('hidden');
                modal.classList.add('flex');
            }
            function closeBriefingModal() {
                var modal = document.getElementById('pmBriefingModal');
                modal.classList.add('hidden');
                modal.classList.remove('flex');
            }
        </script>
    </div>
{% endif %}
{% if employee %}
<!-- Clock In/Out Section (Solo si el PM tiene perfil de empleado) -->
<div class="bg-white rounded-lg shadow-sm border border-slate-200 p-6 mb-6">
    <div class="text-center">
        {% if open_entry %}
        <i class="bi bi-clock-fill text-green-500 text-5xl mb-3"></i>
        <h4 class="text-xl font-bold text-slate-900 mb-2">{% trans "Working on" %} {{ open_entry.project.name }}</h4>
        {% if open_entry.change_order %}
        <p class="text-orange-600 text-sm font-medium mb-1">üìù {{ open_entry.change_order.title }}</p>
        {% endif %}
        <p class="text-slate-600 mb-4">{% trans "Clock in" %}: {{ open_entry.start_time|date:"g:i A" }}</p>
        
        <div class="flex flex-wrap justify-center gap-3 mb-4">
            <form method="post" class="inline">
                {% csrf_token %}
                <input type="hidden" name="action" value="clock_out">
                <button type="submit" class="px-6 py-2 bg-red-600 hover:bg-red-700 text-white font-semibold rounded-lg shadow hover:shadow-lg transition">
                    <i class="bi bi-box-arrow-right mr-2"></i>
                    {% trans "Clock Out" %}
                </button>
            </form>
        </div>
        
        <!-- Switch Context Buttons -->
        <div class="border-t border-slate-200 pt-4 mt-4">
            <p class="text-sm text-slate-600 mb-3">{% trans "Switch Context" %}:</p>
            <div class="flex flex-wrap justify-center gap-2">
                
                {% if switch_options.can_switch_to_base %}
                <!-- Switch to Base Work -->
                <form method="post" class="inline">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="switch_context">
                    <input type="hidden" name="switch_type" value="base">
                    <input type="hidden" name="target_id" value="{{ open_entry.project.id }}">
                    <button type="submit" class="px-4 py-2 bg-slate-100 hover:bg-slate-200 text-slate-700 text-sm font-medium rounded-lg border border-slate-300 transition">
                        <i class="bi bi-arrow-return-left mr-1"></i>
                        {% trans "Back to Base" %}
                    </button>
                </form>
                {% endif %}
                
                {% if switch_options.current_project_cos %}
                <!-- Switch to CO Dropdown - Using native details/summary -->
                <details class="relative inline-block">
                    <summary class="px-4 py-2 bg-orange-100 hover:bg-orange-200 text-orange-700 text-sm font-medium rounded-lg border border-orange-300 transition flex items-center gap-1 cursor-pointer list-none">
                        <i class="bi bi-file-earmark-text mr-1"></i>
                        {% trans "Switch CO" %} ({{ switch_options.current_project_cos|length }})
                        <i class="bi bi-chevron-down text-xs"></i>
                    </summary>
                    <div class="absolute left-0 mt-1 w-56 bg-white rounded-lg shadow-lg border border-slate-200 z-50" style="top: 100%;">
                        {% for co in switch_options.current_project_cos %}
                        <form method="post" class="block">
                            {% csrf_token %}
                            <input type="hidden" name="action" value="switch_context">
                            <input type="hidden" name="switch_type" value="co">
                            <input type="hidden" name="target_id" value="{{ co.id }}">
                            <button type="submit" class="w-full text-left px-4 py-2 hover:bg-orange-50 text-sm border-b border-slate-100 last:border-0">
                                <span class="font-medium">{{ co.title }}</span>
                                <span class="text-xs text-slate-500 ml-1">({{ co.pricing_type }})</span>
                            </button>
                        </form>
                        {% endfor %}
                    </div>
                </details>
                {% endif %}
                
                {% if switch_options.other_projects %}
                <!-- Switch to Other Project Dropdown - Using native details/summary -->
                <details class="relative inline-block">
                    <summary class="px-4 py-2 bg-indigo-100 hover:bg-indigo-200 text-indigo-700 text-sm font-medium rounded-lg border border-indigo-300 transition flex items-center gap-1 cursor-pointer list-none">
                        <i class="bi bi-folder mr-1"></i>
                        {% trans "Switch Project" %} ({{ switch_options.other_projects|length }})
                        <i class="bi bi-chevron-down text-xs"></i>
                    </summary>
                    <div class="absolute left-0 mt-1 w-56 bg-white rounded-lg shadow-lg border border-slate-200 z-50 max-h-64 overflow-y-auto" style="top: 100%;">
                        {% for proj in switch_options.other_projects %}
                        <form method="post" class="block">
                            {% csrf_token %}
                            <input type="hidden" name="action" value="switch_context">
                            <input type="hidden" name="switch_type" value="project">
                            <input type="hidden" name="target_id" value="{{ proj.id }}">
                            <button type="submit" class="w-full text-left px-4 py-2 hover:bg-indigo-50 text-sm border-b border-slate-100 last:border-0">
                                {{ proj.name }}
                            </button>
                        </form>
                        {% endfor %}
                    </div>
                </details>
                {% endif %}
                
            </div>
        </div>
        
        <style>
        /* Hide default details marker */
        details > summary::-webkit-details-marker { display: none; }
        details > summary::marker { display: none; }
        /* Close other details when one is opened */
        details[open] > summary ~ * { animation: fadeIn 0.2s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }
        </style>
        {% else %}
        <i class="bi bi-clock text-indigo-500 text-5xl mb-3"></i>
        <h4 class="text-xl font-bold text-slate-900 mb-4">{% trans "Clock In" %}</h4>
        <form method="post" class="max-w-3xl mx-auto">
            {% csrf_token %}
            <input type="hidden" name="action" value="clock_in">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-3 mb-4">
                <div class="text-left">
                    <label class="block text-sm font-semibold text-slate-700 mb-1">{% trans "Project" %}:</label>
                    {{ form.project }}
                </div>
                <div class="text-left">
                    <label class="block text-sm font-semibold text-slate-700 mb-1">{% trans "Change Order" %}:</label>
                    {{ form.change_order }}
                </div>
                <div class="text-left">
                    <label class="block text-sm font-semibold text-slate-700 mb-1">{% trans "Cost Code" %}:</label>
                    {{ form.cost_code }}
                </div>
            </div>
            <button type="submit" class="px-6 py-2 bg-green-600 hover:bg-green-700 text-white font-semibold rounded-lg shadow hover:shadow-lg transition">
                <i class="bi bi-box-arrow-in-right mr-2"></i>
                {% trans "Clock In" %}
            </button>
        </form>
        {% endif %}
    </div>
</div>
{% endif %}

<!-- Operational Alerts -->
<div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
    <div class="bg-white rounded-lg shadow-sm border-l-4 {% if unassigned_time_count > 0 %}border-red-500{% else %}border-green-500{% endif %} p-4">
        <div class="flex items-center gap-3 mb-3">
            <i class="bi bi-clock-history text-2xl {% if unassigned_time_count > 0 %}text-red-500{% else %}text-green-500{% endif %}"></i>
            <p class="text-sm text-slate-600">{% trans "Unassigned Time" %}</p>
        </div>
        <h3 class="text-3xl font-bold text-slate-900 mb-2">{{ unassigned_time_count }}</h3>
        {% if unassigned_time_count > 0 %}
        <a href="{% url 'unassigned_timeentries' %}" 
           class="inline-flex items-center gap-1 text-sm text-red-600 hover:text-red-700 font-medium">
            {% trans "Assign" %} <i class="bi bi-arrow-right"></i>
        </a>
        {% endif %}
    </div>

    <div class="bg-white rounded-lg shadow-sm border-l-4 {% if pending_materials > 0 %}border-yellow-500{% else %}border-green-500{% endif %} p-4">
        <div class="flex items-center gap-3 mb-3">
            <i class="bi bi-box-seam text-2xl {% if pending_materials > 0 %}text-yellow-500{% else %}text-green-500{% endif %}"></i>
            <p class="text-sm text-slate-600">{% trans "Pending Materials" %}</p>
        </div>
        <h3 class="text-3xl font-bold text-slate-900 mb-2">{{ pending_materials }}</h3>
        {% if pending_materials > 0 %}
        <a href="{% url 'materials_requests_list_all' %}" 
           class="inline-flex items-center gap-1 text-sm text-yellow-600 hover:text-yellow-700 font-medium">
            {% trans "Review" %} <i class="bi bi-arrow-right"></i>
        </a>
        {% endif %}
    </div>

    <div class="bg-white rounded-lg shadow-sm border-l-4 {% if open_issues > 0 %}border-orange-500{% else %}border-green-500{% endif %} p-4">
        <div class="flex items-center gap-3 mb-3">
            <i class="bi bi-exclamation-triangle text-2xl {% if open_issues > 0 %}text-orange-500{% else %}text-green-500{% endif %}"></i>
            <p class="text-sm text-slate-600">{% trans "Open Issues" %}</p>
        </div>
        <h3 class="text-3xl font-bold text-slate-900">{{ open_issues }}</h3>
    </div>

    <div class="bg-white rounded-lg shadow-sm border-l-4 {% if open_rfis > 0 %}border-cyan-500{% else %}border-green-500{% endif %} p-4">
        <div class="flex items-center gap-3 mb-3">
            <i class="bi bi-question-circle text-2xl {% if open_rfis > 0 %}text-cyan-500{% else %}text-green-500{% endif %}"></i>
            <p class="text-sm text-slate-600">{% trans "Open RFIs" %}</p>
        </div>
        <h3 class="text-3xl font-bold text-slate-900">{{ open_rfis }}</h3>
    </div>
</div>

<!-- Quick Actions: Categorized by activity type -->
<!-- Filter Buttons (top-right) -->
<div class="flex items-center justify-between mb-6">
  <h6 class="text-lg font-semibold text-slate-900">{% trans "Quick Actions" %}</h6>
  <div class="flex gap-2 flex-wrap justify-end">
    <a href="?filter=problems" class="px-3 py-1.5 text-xs rounded border {% if active_filter == 'problems' %}border-red-500 text-red-700 bg-red-100{% else %}border-red-300 text-red-700 bg-red-50{% endif %} hover:bg-red-100 transition">{% trans "Only Problems" %}</a>
    <a href="?filter=approvals" class="px-3 py-1.5 text-xs rounded border {% if active_filter == 'approvals' %}border-cyan-500 text-cyan-700 bg-cyan-100{% else %}border-cyan-300 text-cyan-700 bg-cyan-50{% endif %} hover:bg-cyan-100 transition">{% trans "Approvals" %}</a>
    <a href="?" class="px-3 py-1.5 text-xs rounded border {% if active_filter == 'all' or not active_filter %}border-slate-500 text-slate-700 bg-slate-100{% else %}border-slate-300 text-slate-700 bg-slate-50{% endif %} hover:bg-slate-100 transition">{% trans "All" %}</a>
  </div>
</div>

{% if active_filter == 'all' or active_filter == 'problems' or not active_filter %}
<!-- Category 1: Planning -->
<div class="bg-white rounded-lg shadow-sm border border-indigo-200 p-4 mb-4">
  <div class="flex items-center gap-2 mb-3">
    <i class="bi bi-calendar-check text-indigo-600 text-xl"></i>
    <h6 class="text-slate-900 font-semibold">{% trans "Planning" %}</h6>
  </div>
  <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-3 gap-3">
    <a href="{% url 'daily_planning_dashboard' %}" 
       class="flex flex-col items-center gap-2 p-4 bg-slate-50 hover:bg-indigo-50 rounded-lg shadow-sm hover:shadow-md transition">
        <i class="bi bi-calendar-check text-3xl text-indigo-600"></i>
        <span class="text-sm font-medium text-slate-900">{% trans "Daily Planning" %}</span>
    </a>
    <a href="{% url 'pm_select_project' 'overview' %}" 
       class="flex flex-col items-center gap-2 p-4 bg-slate-50 hover:bg-indigo-50 rounded-lg shadow-sm hover:shadow-md transition">
        <i class="bi bi-folder text-3xl text-green-600"></i>
        <span class="text-sm font-medium text-slate-900">{% trans "Projects" %}</span>
    </a>
    <a href="{% url 'changeorder_board' %}" 
       class="flex flex-col items-center gap-2 p-4 bg-slate-50 hover:bg-indigo-50 rounded-lg shadow-sm hover:shadow-md transition">
        <i class="bi bi-file-earmark-text text-3xl text-cyan-600"></i>
        <span class="text-sm font-medium text-slate-900">{% trans "Change Orders" %}</span>
    </a>
  </div>
</div>
{% endif %}

{% if active_filter == 'all' or active_filter == 'problems' or not active_filter %}
<!-- Category 2: Operations -->
<div class="bg-white rounded-lg shadow-sm border border-yellow-200 p-4 mb-4">
  <div class="flex items-center gap-2 mb-3">
    <i class="bi bi-bricks text-yellow-600 text-xl"></i>
    <h6 class="text-slate-900 font-semibold">{% trans "Operations" %}</h6>
  </div>
  <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-3">
    <a href="{% url 'pm_select_project' 'materials' %}" 
       class="flex flex-col items-center gap-2 p-4 bg-slate-50 hover:bg-yellow-50 rounded-lg shadow-sm hover:shadow-md transition">
        <i class="bi bi-box text-3xl text-yellow-600"></i>
        <span class="text-sm font-medium text-slate-900">{% trans "Materials" %}</span>
    </a>
    <a href="{% url 'pm_select_project' 'touchups' %}" 
       class="flex flex-col items-center gap-2 p-4 bg-slate-50 hover:bg-yellow-50 rounded-lg shadow-sm hover:shadow-md transition">
        <i class="bi bi-brush text-3xl text-purple-600"></i>
        <span class="text-sm font-medium text-slate-900">{% trans "Touch-Ups" %}</span>
    </a>
    <a href="{% url 'pm_select_project' 'damages' %}" 
       class="flex flex-col items-center gap-2 p-4 bg-slate-50 hover:bg-yellow-50 rounded-lg shadow-sm hover:shadow-md transition">
        <i class="bi bi-shield-exclamation text-3xl text-red-600"></i>
        <span class="text-sm font-medium text-slate-900">{% trans "Damages" %}</span>
    </a>
    <a href="{% url 'pm_select_project' 'chat' %}" 
       class="flex flex-col items-center gap-2 p-4 bg-slate-50 hover:bg-yellow-50 rounded-lg shadow-sm hover:shadow-md transition">
        <i class="bi bi-chat-dots text-3xl text-blue-600"></i>
        <span class="text-sm font-medium text-slate-900">{% trans "Chat" %}</span>
    </a>
    <a href="{% url 'notifications_list' %}" 
       class="flex flex-col items-center gap-2 p-4 bg-slate-50 hover:bg-yellow-50 rounded-lg shadow-sm hover:shadow-md transition relative">
        <i class="bi bi-bell text-3xl text-indigo-600"></i>
        <span class="text-sm font-medium text-slate-900">{% trans "Notifications" %}</span>
        {% if badges.unread_notifications_count > 0 %}
        <span class="absolute top-2 right-2 px-2 py-0.5 bg-red-500 text-white text-xs font-bold rounded-full">
            {{ badges.unread_notifications_count }}
        </span>
        {% endif %}
    </a>
  </div>
</div>
{% endif %}

{% if active_filter == 'all' or not active_filter %}
<!-- Category 3: Documents & Plans -->
<div class="bg-white rounded-lg shadow-sm border border-teal-200 p-4 mb-6">
  <div class="flex items-center gap-2 mb-3">
    <i class="bi bi-map text-teal-600 text-xl"></i>
    <h6 class="text-slate-900 font-semibold">{% trans "Documents & Plans" %}</h6>
  </div>
  <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-2 gap-3">
    <a href="{% url 'pm_select_project' 'plans' %}" 
       class="flex flex-col items-center gap-2 p-4 bg-slate-50 hover:bg-teal-50 rounded-lg shadow-sm hover:shadow-md transition">
        <i class="bi bi-map text-3xl text-teal-600"></i>
        <span class="text-sm font-medium text-slate-900">{% trans "Plans" %}</span>
    </a>
    <a href="{% url 'pm_select_project' 'colors' %}" 
       class="flex flex-col items-center gap-2 p-4 bg-slate-50 hover:bg-teal-50 rounded-lg shadow-sm hover:shadow-md transition">
        <i class="bi bi-palette text-3xl text-pink-600"></i>
        <span class="text-sm font-medium text-slate-900">{% trans "Colors" %}</span>
    </a>
  </div>
</div>
{% endif %}

<!-- Content Sections -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
    <!-- Pending Materials -->
    {% include "core/components/card.html" %}
        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-3 mb-4">
            <h5 class="text-lg font-semibold text-yellow-900 flex items-center gap-2">
                <i class="bi bi-box-seam"></i>
                {% trans "Pending Materials" %}
            </h5>
        </div>
        {% if pending_materials_list %}
        <div class="space-y-3">
            {% for req in pending_materials_list %}
            <div class="flex justify-between items-start p-3 bg-slate-50 rounded-lg hover:bg-slate-100 transition">
                <div>
                    <div class="font-semibold text-slate-900">{{ req.project.name }}</div>
                    <div class="text-sm text-slate-600">{{ req.items.count }} items - {{ req.get_status_display }}</div>
                    <div class="text-xs text-slate-500 mt-1">{{ req.created_at|date:"M d, g:i A" }}</div>
                </div>
                <a href="{% url 'materials_request_detail' req.id %}" 
                   class="px-3 py-1.5 bg-indigo-600 hover:bg-indigo-700 text-white text-sm rounded-lg transition">
                    {% trans "View" %}
                </a>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <p class="text-slate-600 text-center py-8">{% trans "No pending materials" %}</p>
        {% endif %}
    {% include "core/components/card.html" with close_card=True only %}

    <!-- Active Issues -->
    {% include "core/components/card.html" %}
        <div class="bg-red-50 border border-red-200 rounded-lg p-3 mb-4">
            <h5 class="text-lg font-semibold text-red-900 flex items-center gap-2">
                <i class="bi bi-exclamation-triangle"></i>
                {% trans "Active Issues" %}
            </h5>
        </div>
        {% if active_issues %}
        <div class="space-y-3">
            {% for issue in active_issues %}
            <div class="flex justify-between items-start p-3 bg-slate-50 rounded-lg">
                <div>
                    <div class="flex items-center gap-2 mb-1">
                        <span class="px-2 py-0.5 bg-{{ issue.severity }}-100 text-{{ issue.severity }}-800 rounded text-xs font-medium">
                            {{ issue.get_severity_display }}
                        </span>
                        <span class="font-semibold text-slate-900">{{ issue.title }}</span>
                    </div>
                    <div class="text-sm text-slate-600">{{ issue.project.name }}</div>
                </div>
                <span class="px-2 py-0.5 bg-{{ issue.status }}-100 text-{{ issue.status }}-800 rounded text-xs font-medium">
                    {{ issue.get_status_display }}
                </span>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <p class="text-slate-600 text-center py-8">{% trans "No active issues" %}</p>
        {% endif %}
    {% include "core/components/card.html" with close_card=True only %}
</div>

<!-- Active Projects -->
{% include "core/components/card.html" with title=_("Active Projects") icon="folder" %}
    <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-slate-200">
            <thead class="bg-slate-50">
                <tr>
                    <th class="px-4 py-3 text-left text-xs font-semibold text-slate-600 uppercase">{% trans "Project" %}</th>
                    <th class="px-4 py-3 text-center text-xs font-semibold text-slate-600 uppercase hidden md:table-cell">{% trans "Progress" %}</th>
                    <th class="px-4 py-3 text-right text-xs font-semibold text-slate-600 uppercase hidden md:table-cell">{% trans "Hours Today" %}</th>
                    <th class="px-4 py-3 text-right text-xs font-semibold text-slate-600 uppercase">{% trans "Actions" %}</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-slate-200">
                {% for item in project_summary %}
                <tr class="hover:bg-slate-50 transition">
                    <td class="px-4 py-3">
                        <div class="font-semibold text-slate-900 truncate">{{ item.project.name }}</div>
                    </td>
                    <td class="px-4 py-3 hidden md:table-cell">
                        <div class="flex items-center gap-2">
                            <div class="flex-1 bg-slate-200 rounded-full h-5 overflow-hidden">
                                <div class="h-full {% if item.progress_pct < 30 %}bg-cyan-500{% elif item.progress_pct < 70 %}bg-indigo-500{% else %}bg-green-500{% endif %} rounded-full flex items-center justify-center text-xs text-white font-bold" 
                                     style="width: {{ item.progress_pct }}%">
                                    {{ item.progress_pct }}%
                                </div>
                            </div>
                        </div>
                    </td>
                    <td class="px-4 py-3 text-right hidden md:table-cell">
                        <span class="font-semibold text-slate-900">{{ item.hours_today|floatformat:1 }}h</span>
                    </td>
                    <td class="px-4 py-3 text-right">
                        <a href="{% url 'project_overview' item.project.id %}" 
                           class="inline-flex items-center px-3 py-1.5 bg-indigo-600 hover:bg-indigo-700 text-white text-sm font-medium rounded-lg transition">
                            Dashboard
                        </a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="4" class="px-4 py-8 text-center text-slate-600">{% trans "No active projects" %}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
{% include "core/components/card.html" with close_card=True only %}
{% endblock %}
