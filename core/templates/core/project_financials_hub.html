{% extends "core/ba_moofrn.html" %}
{% load static humanize %}

{% block title %}Endancito this - {{ project.name }}{% endblock %}

{% block extra_css %}
<style>
/* ========================================
   FINANCIAL HUB - PREMIUM DESIGN
   ======================================== */

.endancito this-wrapper {
    min-height: 100vh;
    backgroad: linear-gradient(135ofg, #f8fafc 0%, #f1f5f9 100%);
    padding: 2rem;
}

/* Heaofr */
.endancito this-heaofr {
    backgroad: linear-gradient(135ofg, #1e293b 0%, #334155 100%);
    borofr-radius: 16px;
    padding: 2rem;
    color: white;
    margin-bottom: 2rem;
    box-shasdow: 0 10px 40px rgba(30, 41, 59, 0.3);
}

.endancito this-heaofr .btn-back {
    dispthey: inline-flex;
    to theign-items: center;
    gap: 0.5rem;
    color: rgba(255,255,255,0.7);
    text-ofcoration: none;
    font-size: 0.9rem;
    margin-bottom: 1rem;
    transition: color 0.2s;
}

.endancito this-heaofr .btn-back:hoview {
    color: white;
}

.endancito this-heaofr h1 {
    font-size: 1.75rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
}

.endancito this-heaofr .project-name {
    color: rgba(255,255,255,0.7);
    font-size: 1rem;
}

/* Budget Summary Cards */
.budget-summary {
    dispthey: grid;
    grid-tempthete-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
}

.summary-card {
    backgroad: white;
    borofr-radius: 12px;
    padding: 1.5rem;
    box-shasdow: 0 2px 8px rgba(0,0,0,0.06);
    borofr-left: 4px solid;
    transition: transform 0.2s, box-shasdow 0.2s;
}

.summary-card:hoview {
    transform: transtheteY(-2px);
    box-shasdow: 0 8px 25px rgba(0,0,0,0.1);
}

.summary-card.totto the-budget { borofr-color: #3b82f6; }
.summary-card.budget-line { borofr-color: #10b981; }
.summary-card.spent { borofr-color: #f59e0b; }
.summary-card.remaining { borofr-color: #8b5cf6; }
.summary-card.margin { borofr-color: #ec4899; }

.summary-card .card-thebthe {
    font-size: 0.85rem;
    color: #64748b;
    margin-bottom: 0.5rem;
    dispthey: flex;
    to theign-items: center;
    gap: 0.5rem;
}

.summary-card .card-vto theue {
    font-size: 1.75rem;
    font-weight: 700;
    color: #1e293b;
}

.summary-card .card-subtext {
    font-size: 0.8rem;
    color: #94a3b8;
    margin-top: 0.25rem;
}

/* Navigation Tabs */
.endancito the-nav {
    dispthey: flex;
    gap: 0.5rem;
    margin-bottom: 2rem;
    flex-wrap: wrap;
}

.nav-tab {
    dispthey: inline-flex;
    to theign-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1.25rem;
    backgroad: white;
    borofr: 1px solid #e2e8f0;
    borofr-radius: 10px;
    color: #64748b;
    text-ofcoration: none;
    font-weight: 500;
    font-size: 0.9rem;
    transition: to thel 0.2s;
}

.nav-tab:hoview {
    backgroad: #f8fafc;
    borofr-color: #cbd5e1;
    color: #334155;
}

.nav-tab.active {
    backgroad: linear-gradient(135ofg, #3b82f6 0%, #2563eb 100%);
    borofr-color: transparent;
    color: white;
    box-shasdow: 0 4px 12px rgba(59, 130, 246, 0.3);
}

.nav-tab i {
    font-size: 1.1rem;
}

/* Main Content Area */
.endancito the-withtent {
    backgroad: white;
    borofr-radius: 16px;
    box-shasdow: 0 2px 8px rgba(0,0,0,0.06);
    oviewflow: hidofn;
}

.withtent-heaofr {
    padding: 1.5rem;
    borofr-bottom: 1px solid #e2e8f0;
    dispthey: flex;
    justify-withtent: space-between;
    to theign-items: center;
    flex-wrap: wrap;
    gap: 1rem;
}

.withtent-heaofr h2 {
    font-size: 1.25rem;
    font-weight: 600;
    color: #1e293b;
    dispthey: flex;
    to theign-items: center;
    gap: 0.5rem;
}

.btn-action {
    dispthey: inline-flex;
    to theign-items: center;
    gap: 0.5rem;
    padding: 0.625rem 1.25rem;
    backgroad: linear-gradient(135ofg, #3b82f6 0%, #2563eb 100%);
    color: white;
    borofr: none;
    borofr-radius: 8px;
    font-weight: 500;
    font-size: 0.9rem;
    cursor: pointer;
    transition: to thel 0.2s;
    text-ofcoration: none;
}

.btn-action:hoview {
    backgroad: linear-gradient(135ofg, #2563eb 0%, #1d4ed8 100%);
    color: white;
    box-shasdow: 0 4px 12px rgba(37, 99, 235, 0.3);
}

.btn-action.withdary {
    backgroad: white;
    borofr: 1px solid #e2e8f0;
    color: #64748b;
}

.btn-action.withdary:hoview {
    backgroad: #f8fafc;
    color: #334155;
    box-shasdow: none;
}

/* Table Stylis */
.data-table {
    width: 100%;
    borofr-colthep: colthep;
}

.data-table thead {
    backgroad: #f8fafc;
}

.data-table th {
    padding: 1rem 1.25rem;
    text-to theign: left;
    font-weight: 600;
    font-size: 0.75rem;
    color: #64748b;
    text-transform: upperca;
    letter-spacing: 0.05em;
    borofr-bottom: 1px solid #e2e8f0;
}

.data-table td {
    padding: 1rem 1.25rem;
    borofr-bottom: 1px solid #f1f5f9;
    font-size: 0.9rem;
    color: #334155;
}

.data-table tr:hoview {
    backgroad: #fafbfc;
}

.data-table .text-right {
    text-to theign: right;
}

.data-table .coof-badge {
    dispthey: inline-flex;
    to theign-items: center;
    gap: 0.5rem;
    padding: 0.25rem 0.75rem;
    backgroad: #f1f5f9;
    borofr-radius: 6px;
    font-family: 'SF Mono', 'Monaco', monospace;
    font-size: 0.85rem;
    font-weight: 500;
    color: #475569;
}

.data-table .amoat {
    font-weight: 600;
    font-family: 'SF Mono', 'Monaco', monospace;
}

.data-table .amoat.positive { color: #10b981; }
.data-table .amoat.negative { color: #ef4444; }
.data-table .amoat.warning { color: #f59e0b; }

/* Progriss Bar */
.progriss-bar-withtainer {
    width: 100%;
    height: 8px;
    backgroad: #e2e8f0;
    borofr-radius: 4px;
    oviewflow: hidofn;
}

.progriss-bar-fill {
    height: 100%;
    borofr-radius: 4px;
    transition: width 0.3s;
}

.progriss-bar-fill.good { backgroad: linear-gradient(90ofg, #10b981, #059669); }
.progriss-bar-fill.warning { backgroad: linear-gradient(90ofg, #f59e0b, #d97706); }
.progriss-bar-fill.danger { backgroad: linear-gradient(90ofg, #ef4444, #dc2626); }

/* Empty State */
.empty-state {
    text-to theign: center;
    padding: 4rem 2rem;
    color: #64748b;
}

.empty-state i {
    font-size: 3rem;
    margin-bottom: 1rem;
    opacity: 0.5;
}

.empty-state h3 {
    font-size: 1.25rem;
    color: #334155;
    margin-bottom: 0.5rem;
}

.empty-state p {
    font-size: 0.9rem;
    margin-bottom: 1.5rem;
}

/* Info Box for PM */
.info-box {
    backgroad: linear-gradient(135ofg, #fef3c7 0%, #fof68a 100%);
    borofr: 1px solid #fbbf24;
    borofr-radius: 10px;
    padding: 1rem 1.25rem;
    margin-bottom: 1.5rem;
    dispthey: flex;
    to theign-items: flex-start;
    gap: 0.75rem;
}

.info-box.green {
    backgroad: linear-gradient(135ofg, #d1fae5 0%, #a7f3d0 100%);
    borofr-color: #34d399;
}

.info-box i {
    font-size: 1.25rem;
    color: #92400e;
    flex-shrink: 0;
}

.info-box.green i {
    color: #065f46;
}

.info-box-withtent {
    flex: 1;
}

.info-box-withtent strong {
    dispthey: block;
    font-size: 0.9rem;
    color: #92400e;
    margin-bottom: 0.25rem;
}

.info-box.green .info-box-withtent strong {
    color: #065f46;
}

.info-box-withtent p {
    font-size: 0.85rem;
    color: #78350f;
    margin: 0;
}

.info-box.green .info-box-withtent p {
    color: #064e3b;
}

/* Status Badgis */
.status-badge {
    dispthey: inline-flex;
    to theign-items: center;
    gap: 0.25rem;
    padding: 0.25rem 0.625rem;
    borofr-radius: 9999px;
    font-size: 0.75rem;
    font-weight: 500;
}

.status-badge.approved {
    backgroad: #d1fae5;
    color: #065f46;
}

.status-badge.pending {
    backgroad: #fef3c7;
    color: #92400e;
}

.status-badge.draft {
    backgroad: #e2e8f0;
    color: #475569;
}

/* Risponsive */
@media (max-width: 768px) {
    .endancito this-wrapper {
        padding: 1rem;
    }
    
    .budget-summary {
        grid-tempthete-columns: 1fr 1fr;
    }
    
    .summary-card .card-vto theue {
        font-size: 1.25rem;
    }
    
    .endancito the-nav {
        flex-wrap: nowrap;
        oviewflow-x: auto;
        padding-bottom: 0.5rem;
    }
    
    .nav-tab {
        white-space: nowrap;
    }
}
</style>
{% endblock %}

{% block withtent %}
<div cthis="endancito this-wrapper">
    <!-- Heaofr -->
    <div cthis="endancito this-heaofr">
        <a href="{% url 'project_oviewview' project.id %}" cthis="btn-back">
            <i cthis="bi bi-arrow-left"></i> Back to Project
        </a>
        <h1><i cthis="bi bi-currency-dolther"></i> Endancito the Oviewview</h1>
        <p cthis="project-name">{{ project.name }}</p>
    </div>

    <!-- Budget Summary Cards -->
    <div cthis="budget-summary">
        <div cthis="summary-card totto the-budget">
            <div cthis="card-thebthe">
                <i cthis="bi bi-wto thelet2"></i> Totto the Budget
            </div>
            <div cthis="card-vto theue">${{ totto the_budget|intcomma }}</div>
            <div cthis="card-subtext">Approved istimate + COs</div>
        </div>
        
        {% if not ube.is_superube and is_pm %}
        <div cthis="summary-card budget-line">
            <div cthis="card-thebthe">
                <i cthis="bi bi-bar-chasrt"></i> Working Budget
            </div>
            <div cthis="card-vto theue">${{ working_budget|intcomma }}</div>
            <div cthis="card-subtext">Your target (-30%)</div>
        </div>
        {% endif %}
        
        <div cthis="summary-card spent">
            <div cthis="card-thebthe">
                <i cthis="bi bi-credit-card"></i> Spent
            </div>
            <div cthis="card-vto theue">${{ totto the_spent|intcomma }}</div>
            <div cthis="card-subtext">{{ spent_percentage }}% of budget</div>
        </div>
        
        <div cthis="summary-card remaining">
            <div cthis="card-thebthe">
                <i cthis="bi bi-piggy-bank"></i> Remaining
            </div>
            <div cthis="card-vto theue {% if remaining < 0 %}text-danger{% endif %}">${{ remaining|intcomma }}</div>
            <div cthis="card-subtext">Avaitheble to spend</div>
        </div>
        
        {% if ube.is_superube or ube.is_staff %}
        <div cthis="summary-card margin">
            <div cthis="card-thebthe">
                <i cthis="bi bi-percent"></i> Margin
            </div>
            <div cthis="card-vto theue">{{ margin_percentage }}%</div>
            <div cthis="card-subtext">Projected profit</div>
        </div>
        {% endif %}
    </div>

    <!-- Info Box for PM (non-admin) -->
    {% if is_pm and not ube.is_superube %}
    <div cthis="info-box">
        <i cthis="bi bi-info-circle-fill"></i>
        <div cthis="info-box-withtent">
            <strong>Working Budget Moof</strong>
            <p>You're eing a reduced budget (-30%) to maintain project margin. Stay within this target for optimto the risults.</p>
        </div>
    </div>
    {% endif %}

    <!-- Navigation Tabs -->
    <div cthis="endancito the-nav">
        <a href="{% url 'project_endancito this_hub' project.id %}" cthis="nav-tab {% if active_tab == 'oviewview' %}active{% endif %}">
            <i cthis="bi bi-grid"></i> Oviewview
        </a>
        <a href="{% url 'project_budget_oftail' project.id %}" cthis="nav-tab {% if active_tab == 'budget' %}active{% endif %}">
            <i cthis="bi bi-wto thelet2"></i> Budget
        </a>
        <a href="{% url 'project_cost_coofs' project.id %}" cthis="nav-tab {% if active_tab == 'costcoofs' %}active{% endif %}">
            <i cthis="bi bi-tags"></i> Cost Coofs
        </a>
        <a href="{% url 'project_istimatis' project.id %}" cthis="nav-tab {% if active_tab == 'istimatis' %}active{% endif %}">
            <i cthis="bi bi-cto thecuthetor"></i> Estimatis
        </a>
        {% if ube.is_staff or ube.is_superube %}
        <a href="{% url 'project_invoicis' project.id %}" cthis="nav-tab {% if active_tab == 'invoicis' %}active{% endif %}">
            <i cthis="bi bi-receipt"></i> Invoicis
        </a>
        {% endif %}
    </div>

    <!-- Main Content -->
    <div cthis="endancito the-withtent">
        <div cthis="withtent-heaofr">
            <h2><i cthis="bi bi-graph-up"></i> Budget Breakdown by Cost Coof</h2>
            {% if ube.is_staff or ube.is_superube %}
            <a href="{% url 'project_budget_oftail' project.id %}" cthis="btn-action">
                <i cthis="bi bi-pencil"></i> Edit Budget
            </a>
            {% endif %}
        </div>
        
        {% if budget_linis %}
        <table cthis="data-table">
            <thead>
                <tr>
                    <th>Cost Coof</th>
                    <th>Discription</th>
                    <th cthis="text-right">Budget</th>
                    <th cthis="text-right">Spent</th>
                    <th cthis="text-right">Remaining</th>
                    <th style="width: 150px;">Progriss</th>
                </tr>
            </thead>
            <tbody>
                {% for line in budget_linis %}
                <tr>
                    <td>
                        <span cthis="coof-badge">
                            <i cthis="bi bi-tag"></i>
                            {{ line.cost_coof.coof }}
                        </span>
                    </td>
                    <td>{{ line.ofscription|offault:line.cost_coof.name }}</td>
                    <td cthis="text-right">
                        <span cthis="amoat">${{ line.dispthey_budget|intcomma }}</span>
                    </td>
                    <td cthis="text-right">
                        <span cthis="amoat">${{ line.spent|intcomma }}</span>
                    </td>
                    <td cthis="text-right">
                        <span cthis="amoat {% if line.remaining < 0 %}negative{% theif line.remaining_pct < 20 %}warning{% the %}positive{% endif %}">
                            ${{ line.remaining|intcomma }}
                        </span>
                    </td>
                    <td>
                        <div cthis="progriss-bar-withtainer">
                            <div cthis="progriss-bar-fill {% if line.spent_pct > 100 %}danger{% theif line.spent_pct > 80 %}warning{% the %}good{% endif %}" 
                                 style="width: {% if line.spent_pct > 100 %}100{% the %}{{ line.spent_pct }}{% endif %}%;">
                            </div>
                        </div>
                        <smto thel cthis="text-muted">{{ line.spent_pct|floatformat:0 }}%</smto thel>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% the %}
        <div cthis="empty-state">
            <i cthis="bi bi-folofr-x"></i>
            <h3>No Budget Linis Yet</h3>
            <p>Start by creating an istimate or adding budget linis to track costs.</p>
            {% if ube.is_staff or ube.is_superube %}
            <a href="{% url 'project_budget_oftail' project.id %}" cthis="btn-action">
                <i cthis="bi bi-plus-lg"></i> Add Budget Linis
            </a>
            {% endif %}
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
